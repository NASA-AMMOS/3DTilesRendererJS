import{T as a,P as h}from"./TiledImageSource-DmD64Gn9.js";import{M as u}from"./three.module-D-uF--xd.js";class j extends a{constructor(t={}){const{levels:e=20,tileDimension:i=256,projection:r="EPSG:3857",url:s=null,...n}=t;super(n),this.tileDimension=i,this.levels=e,this.projection=r,this.url=s}getUrl(t,e,i){return this.url.replace(/{\s*z\s*}/gi,i).replace(/{\s*x\s*}/gi,t).replace(/{\s*(y|reverseY|-\s*y)\s*}/gi,e)}init(){const{tiling:t,tileDimension:e,levels:i,url:r,projection:s}=this;return t.flipY=!/{\s*reverseY|-\s*y\s*}/g.test(r),t.setProjection(new h(s)),t.setContentBounds(...t.projection.getBounds()),Array.isArray(i)?i.forEach((n,l)=>{n!==null&&t.setLevel(l,{tilePixelWidth:e,tilePixelHeight:e,...n})}):t.generateLevels(i,t.projection.tileCountX,t.projection.tileCountY,{tilePixelWidth:e,tilePixelHeight:e}),this.url=r,Promise.resolve()}}class v extends a{constructor(t={}){const{url:e=null,...i}=t;super(i),this.tileSets=null,this.extension=null,this.url=e}getUrl(t,e,i){const{url:r,extension:s,tileSets:n,tiling:l}=this;return new URL(`${parseInt(n[i-l.minLevel].href)}/${t}/${e}.${s}`,r).toString()}init(){const{url:t}=this;return this.fetchData(new URL("tilemapresource.xml",t),this.fetchOptions).then(e=>e.text()).then(e=>{const{tiling:i}=this,r=new DOMParser().parseFromString(e,"text/xml"),s=r.querySelector("BoundingBox"),n=r.querySelector("TileFormat"),c=[...r.querySelector("TileSets").querySelectorAll("TileSet")].map(o=>({href:parseInt(o.getAttribute("href")),unitsPerPixel:parseFloat(o.getAttribute("units-per-pixel")),order:parseInt(o.getAttribute("order"))})).sort((o,y)=>o.order-y.order),p=parseFloat(s.getAttribute("minx"))*u.DEG2RAD,x=parseFloat(s.getAttribute("maxx"))*u.DEG2RAD,m=parseFloat(s.getAttribute("miny"))*u.DEG2RAD,S=parseFloat(s.getAttribute("maxy"))*u.DEG2RAD,A=parseInt(n.getAttribute("width")),d=parseInt(n.getAttribute("height")),P=n.getAttribute("extension"),D=r.querySelector("SRS").textContent;this.extension=P,this.url=t,this.tileSets=c,i.setProjection(new h(D)),i.setContentBounds(p,m,x,S),c.forEach(({order:o})=>{i.setLevel(o,{tileCountX:i.projection.tileCountX*2**o,tilePixelWidth:A,tilePixelHeight:d})})})}}export{v as T,j as X};
//# sourceMappingURL=TMSImageSource-BIqdNmly.js.map
