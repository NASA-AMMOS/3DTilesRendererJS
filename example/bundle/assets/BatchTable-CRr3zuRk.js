function E(r){if(r===null||r.byteLength<4)return"";let e;if(r instanceof DataView?e=r:e=new DataView(r),String.fromCharCode(e.getUint8(0))==="{")return null;let t="";for(let s=0;s<4;s++)t+=String.fromCharCode(e.getUint8(s));return t}const b=new TextDecoder;function I(r){return b.decode(r)}function g(r){return r.replace(/[\\/][^\\/]+$/,"")+"/"}class L{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then(t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()}).then(t=>(this.workingPath===""&&(this.workingPath=g(e)),this.parse(t)))}resolveExternalURL(e){return new URL(e,this.workingPath).href}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function f(r,e,t,s,a,o){let n;switch(s){case"SCALAR":n=1;break;case"VEC2":n=2;break;case"VEC3":n=3;break;case"VEC4":n=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${o}".`)}let c;const i=t*n;switch(a){case"BYTE":c=new Int8Array(r,e,i);break;case"UNSIGNED_BYTE":c=new Uint8Array(r,e,i);break;case"SHORT":c=new Int16Array(r,e,i);break;case"UNSIGNED_SHORT":c=new Uint16Array(r,e,i);break;case"INT":c=new Int32Array(r,e,i);break;case"UNSIGNED_INT":c=new Uint32Array(r,e,i);break;case"FLOAT":c=new Float32Array(r,e,i);break;case"DOUBLE":c=new Float64Array(r,e,i);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${o}".`)}return c}class w{constructor(e,t,s,a){this.buffer=e,this.binOffset=t+s,this.binLength=a;let o=null;if(s!==0){const n=new Uint8Array(e,t,s);o=JSON.parse(I(n))}else o={};this.header=o}getKeys(){return Object.keys(this.header).filter(e=>e!=="extensions")}getData(e,t,s=null,a=null){const o=this.header;if(!(e in o))return null;const n=o[e];if(n instanceof Object){if(Array.isArray(n))return n;{const{buffer:c,binOffset:i,binLength:h}=this,l=n.byteOffset||0,p=n.type||a,y=n.componentType||s;if("type"in n&&a&&n.type!==a)throw new Error("FeatureTable: Specified type does not match expected type.");const u=i+l,d=f(c,u,t,p,y,e);if(u+d.byteLength>i+h)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}else return n}getBuffer(e,t){const{buffer:s,binOffset:a}=this;return s.slice(a+e,a+e+t)}}class T{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const a of this.classes){const o=a.instances;for(const n in o)a.instances[n]=this._parseProperty(o[n],a.length,n)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const a=this.parentCounts.reduce((o,n)=>o+n,0);this.parentIds=this._parseProperty(t.parentIds,a,"parentIds")}else this.parentIds=null;this.instancesIds=[];const s={};for(const a of this.classIds)s[a]=s[a]??0,this.instancesIds.push(s[a]),s[a]++}_parseProperty(e,t,s){if(Array.isArray(e))return e;{const{buffer:a,binOffset:o}=this.batchTable,n=e.byteOffset,c=e.componentType||"UNSIGNED_SHORT",i=o+n;return f(a,i,t,"SCALAR",c,s)}}getDataFromId(e,t={}){const s=this.parentCounts[e];if(this.parentIds&&s>0){let i=0;for(let h=0;h<e;h++)i+=this.parentCounts[h];for(let h=0;h<s;h++){const l=this.parentIds[i+h];l!==e&&this.getDataFromId(l,t)}}const a=this.classIds[e],o=this.classes[a].instances,n=this.classes[a].name,c=this.instancesIds[e];for(const i in o)t[n]=t[n]||{},t[n][i]=o[i][c];return t}}class D extends w{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,s,a,o){super(e,s,a,o),this.count=t,this.extensions={};const n=this.header.extensions;n&&n["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new T(this))}getData(e,t=null,s=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,s)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const s of this.getKeys())t[s]=super.getData(s,this.count)[e];for(const s in this.extensions){const a=this.extensions[s];a.getDataFromId instanceof Function&&(t[s]=t[s]||{},a.getDataFromId(e,t[s]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}export{D as B,w as F,L,I as a,g,E as r};
//# sourceMappingURL=BatchTable-CRr3zuRk.js.map
