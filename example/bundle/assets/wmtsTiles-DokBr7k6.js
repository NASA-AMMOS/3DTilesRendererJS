import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{M as T,W as F,S as O,a as k}from"./three.module-D-uF--xd.js";import{T as z}from"./TilesRenderer-Bm042Xsy.js";import{G as V}from"./GlobeControls-4ScISV7m.js";import{E as _}from"./EnvironmentControls-BRF5UI-K.js";import{U as N}from"./UpdateOnChangePlugin-BPSehBEG.js";import{T as j}from"./TilesFadePlugin-BRcOjUD_.js";import{a as $}from"./EPSGTilesPlugin-DX3n6hNw.js";import{L as Q}from"./BatchTable-CRr3zuRk.js";import{W as J}from"./constants-JFoaxC9y.js";import{P as K}from"./TiledImageSource-DmD64Gn9.js";import{g as X}from"./lil-gui.module.min-BH_YJbPT.js";import"./TilesRendererBase-CFsQu8zV.js";import"./B3DMLoader-Cnf0ja_2.js";import"./B3DMLoaderBase-w5mdSgm-.js";import"./GLTFLoader-B4GrkiON.js";import"./PNTSLoader-DwvZQNdL.js";import"./I3DMLoader-BWluRuWb.js";import"./Ellipsoid-Dwquuq5w.js";import"./CMPTLoader-BOTrymv0.js";import"./EllipsoidRegion-VNvPMw5b.js";import"./ImageFormatPlugin-DGN9sc3I.js";import"./TMSImageSource-BIqdNmly.js";const b=J*Math.PI*2,P=new K("EPSG:3857");function Y(e){return/:4326$/i.test(e)}function A(e){return/:3857$/i.test(e)}function L(e){return e.trim().split(/\s+/).map(t=>parseFloat(t))}function R(e,t){Y(t)&&([e[1],e[0]]=[e[0],e[1]])}function M(e,t){if(A(t))return e[0]=P.convertNormalizedToLongitude(.5+e[0]/b),e[1]=P.convertNormalizedToLatitude(.5+e[1]/b),e[0]*=T.RAD2DEG,e[1]*=T.RAD2DEG,e}function q(e){e[0]*=T.DEG2RAD,e[1]*=T.DEG2RAD}class Z extends Q{parse(t){const r=new TextDecoder("utf-8").decode(new Uint8Array(t)),i=new DOMParser().parseFromString(r,"text/xml"),n=i.querySelector("Contents"),s=x(n,"TileMatrixSet").map(d=>oe(d)),l=x(n,"Layer").map(d=>te(d)),p=ee(i.querySelector("ServiceIdentification"));return l.forEach(d=>{d.tileMatrixSets=d.tileMatrixSetLinks.map(S=>s.find(o=>o.identifier===S))}),{serviceIdentification:p,tileMatrixSets:s,layers:l}}}function ee(e){var s;const t=e.querySelector("Title").textContent,r=((s=e.querySelector("Abstract"))==null?void 0:s.textContent)||"",i=e.querySelector("ServiceType").textContent,n=e.querySelector("ServiceTypeVersion").textContent;return{title:t,abstract:r,serviceType:i,serviceTypeVersion:n}}function te(e){const t=e.querySelector("Title").textContent,r=e.querySelector("Identifier").textContent,i=e.querySelector("Format").textContent,n=x(e,"ResourceURL").map(S=>ne(S)),s=x(e,"TileMatrixSetLink").map(S=>x(S,"TileMatrixSet")[0].textContent),l=x(e,"Style").map(S=>ie(S)),p=x(e,"Dimension").map(S=>re(S));let d=v(e.querySelector("WGS84BoundingBox"));return d||(d=v(e.querySelector("BoundingBox"))),{title:t,identifier:r,format:i,dimensions:p,tileMatrixSetLinks:s,styles:l,boundingBox:d,resourceUrls:n}}function ne(e){const t=e.getAttribute("template"),r=e.getAttribute("format"),i=e.getAttribute("resourceType");return{template:t,format:r,resourceType:i}}function re(e){var l,p;const t=e.querySelector("Identifier").textContent,r=((l=e.querySelector("UOM"))==null?void 0:l.textContent)||"",i=e.querySelector("Default").textContent,n=((p=e.querySelector("Current"))==null?void 0:p.textContent)==="true",s=x(e,"Value").map(d=>d.textContent);return{identifier:t,uom:r,defaultValue:i,current:n,values:s}}function v(e){if(!e)return null;const t=e.nodeName.endsWith("WGS84BoundingBox")?"urn:ogc:def:crs:CRS::84":e.getAttribute("crs"),r=L(e.querySelector("LowerCorner").textContent),i=L(e.querySelector("UpperCorner").textContent);return R(r,t),R(i,t),M(r,t),M(i,t),q(r),q(i),{crs:t,lowerCorner:r,upperCorner:i,bounds:[...r,...i]}}function ie(e){var n;const t=((n=e.querySelector("Title"))==null?void 0:n.textContent)||null,r=e.querySelector("Identifier").textContent,i=e.getAttribute("isDefault")==="true";return{title:t,identifier:r,isDefault:i}}function oe(e){var l,p;const t=e.querySelector("SupportedCRS").textContent,r=((l=e.querySelector("Title"))==null?void 0:l.textContent)||"",i=e.querySelector("Identifier").textContent,n=((p=e.querySelector("Abstract"))==null?void 0:p.textContent)||"",s=[];return e.querySelectorAll("TileMatrix").forEach((d,S)=>{const o=se(d),D=28e-5*o.scaleDenominator,E=o.tileWidth*o.matrixWidth*D,W=o.tileHeight*o.matrixHeight*D;let h;R(o.topLeftCorner,t),A(t)?h=[o.topLeftCorner[0]+E,o.topLeftCorner[1]-W]:h=[o.topLeftCorner[0]+360*E/b,o.topLeftCorner[1]-360*W/b],M(h,t),M(o.topLeftCorner,t),q(h),q(o.topLeftCorner),o.bounds=[...o.topLeftCorner,...h],[o.bounds[1],o.bounds[3]]=[o.bounds[3],o.bounds[1]],s.push(o)}),{title:r,identifier:i,abstract:n,supportedCRS:t,tileMatrices:s}}function se(e){const t=e.querySelector("Identifier").textContent,r=parseFloat(e.querySelector("TileWidth").textContent),i=parseFloat(e.querySelector("TileHeight").textContent),n=parseFloat(e.querySelector("MatrixWidth").textContent),s=parseFloat(e.querySelector("MatrixHeight").textContent),l=parseFloat(e.querySelector("ScaleDenominator").textContent),p=L(e.querySelector("TopLeftCorner").textContent);return{identifier:t,tileWidth:r,tileHeight:i,matrixWidth:n,matrixHeight:s,scaleDenominator:l,topLeftCorner:p,bounds:null}}function x(e,t){return[...e.children].filter(r=>r.tagName===t)}const G=window.location.hash.replace(/^#/,"")||"https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?SERVICE=WMTS&request=GetCapabilities",U=["EPSG:4326","EPSG:3857"];let a,w,f,u,m,C,c,y;ae();H();function ae(){f=new F({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor(1118481),f.setAnimationLoop(H),document.body.appendChild(f.domElement),w=new O,m=new k(60,window.innerWidth/window.innerHeight,.001,1e4),ce(),I(),window.addEventListener("resize",I,!1),window.addEventListener("hashchange",()=>location.reload())}async function ce(){y=await new Z().loadAsync(G);let e="MODIS_Terra_CorrectedReflectance_TrueColor";y.layers.find(t=>t.identifier===e)||(e=y.layers.find(t=>t.tileMatrixSets.some(r=>U.includes(r.supportedCRS))).identifier),c={layer:e,style:null,tileMatrixSet:null,planar:!1,dimensions:{}},B(),g()}function B(){var i;C&&C.destroy(),c.style=null,c.tileMatrixSet=null,c.dimensions={};const e=y.layers.find(n=>n.identifier===c.layer);c.style=((i=e.styles.find(n=>n.isDefault))==null?void 0:i.identifier)||e.styles[0].identifier;const t=e.tileMatrixSets.find(n=>U.includes(n.supportedCRS));c.tileMatrixSet=t?t.identifier:e.tileMatrixSets[0].identifier;const r=y.serviceIdentification.abstract;document.getElementById("info").innerHTML="<b>"+y.serviceIdentification.title+"</b>"+(r?"<br/>"+r:"")+"<br/>"+e.title,C=new X,C.add(c,"planar").onChange(g),C.add(c,"layer",y.layers.map(n=>n.identifier)).onChange(()=>{B(),g()}),C.add(c,"tileMatrixSet",e.tileMatrixSets.map(n=>n.identifier)).onChange(g),C.add(c,"style",e.styles.map(n=>n.identifier)).onChange(g);for(const n in e.dimensions){const s=e.dimensions[n];c.dimensions[s.identifier]=e.dimensions[n].defaultValue;let l=s.values;s.identifier==="Time"&&/gibs.earthdata/.test(G)&&(l=l.flatMap(p=>{const d=p.split(/\//g);return d.pop(),d}),/^MODIS_Terra/.test(c.layer)&&(l.push("2013-06-16"),c.dimensions[s.identifier]="2013-06-16")),C.add(c.dimensions,s.identifier,l).onChange(g)}}function g(){u&&u.dispose(),a&&(a.dispose(),a=null),u=new z,u.registerPlugin(new j),u.registerPlugin(new N),u.registerPlugin(new $({shape:c.planar?"planar":"ellipsoid",center:!0,capabilities:y,...c})),u.setCamera(m),w.add(u.group),c.planar?(a=new _(w,m,f.domElement),a.enableDamping=!0,a.minDistance=1e-4,a.maxDistance=5,a.cameraRadius=0,a.fallbackPlane.normal.set(0,0,1),a.up.set(0,0,1),a.camera.position.set(0,0,2),a.camera.quaternion.identity(),m.near=1e-4,m.far=10,m.updateProjectionMatrix()):(u.group.rotation.x=-Math.PI/2,a=new V(w,m,f.domElement),a.setEllipsoid(u.ellipsoid,u.group),a.enableDamping=!0,a.camera.position.set(0,0,1.75*1e7),a.camera.quaternion.identity(),a.minDistance=150)}function I(){const e=window.innerWidth/window.innerHeight;m.aspect=e,m.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)}function H(){a&&(a.update(),m.updateMatrixWorld()),u&&(u.setCamera(m),u.setResolutionFromRenderer(m,f),u.update()),f.render(w,m)}
//# sourceMappingURL=wmtsTiles-DokBr7k6.js.map
