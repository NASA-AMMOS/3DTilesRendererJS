{"version":3,"file":"EllipsoidRegionHelper-D9Sr6EUI.js","sources":["../../../src/three/plugins/objects/SphereHelper.js","../../../src/three/plugins/objects/EllipsoidRegionHelper.js"],"sourcesContent":["import { LineSegments, BufferGeometry, Vector3, BufferAttribute, LineBasicMaterial } from 'three';\n\nconst _vector = new Vector3();\nconst axes = [ 'x', 'y', 'z' ];\nexport class SphereHelper extends LineSegments {\n\n\tconstructor( sphere, color = 0xffff00, angleSteps = 40 ) {\n\n\t\tconst geometry = new BufferGeometry();\n\t\tconst positions = [];\n\t\tfor ( let i = 0; i < 3; i ++ ) {\n\n\t\t\tconst axis1 = axes[ i ];\n\t\t\tconst axis2 = axes[ ( i + 1 ) % 3 ];\n\t\t\t_vector.set( 0, 0, 0 );\n\n\t\t\tfor ( let a = 0; a < angleSteps; a ++ ) {\n\n\t\t\t\tlet angle;\n\t\t\t\tangle = 2 * Math.PI * a / ( angleSteps - 1 );\n\t\t\t\t_vector[ axis1 ] = Math.sin( angle );\n\t\t\t\t_vector[ axis2 ] = Math.cos( angle );\n\n\t\t\t\tpositions.push( _vector.x, _vector.y, _vector.z );\n\n\t\t\t\tangle = 2 * Math.PI * ( a + 1 ) / ( angleSteps - 1 );\n\t\t\t\t_vector[ axis1 ] = Math.sin( angle );\n\t\t\t\t_vector[ axis2 ] = Math.cos( angle );\n\n\t\t\t\tpositions.push( _vector.x, _vector.y, _vector.z );\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tgeometry.setAttribute( 'position', new BufferAttribute( new Float32Array( positions ), 3 ) );\n\t\tgeometry.computeBoundingSphere();\n\n\t\tsuper( geometry, new LineBasicMaterial( { color: color, toneMapped: false } ) );\n\t\tthis.sphere = sphere;\n\t\tthis.type = 'SphereHelper';\n\n\t}\n\n\tupdateMatrixWorld( force ) {\n\n\t\tconst sphere = this.sphere;\n\t\tthis.position.copy( sphere.center );\n\t\tthis.scale.setScalar( sphere.radius );\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n}\n","import { Mesh, Vector3, MathUtils, BoxGeometry, BufferGeometry, EdgesGeometry, LineSegments, BufferAttribute } from 'three';\nimport { EllipsoidRegion } from '3d-tiles-renderer/three';\n\nconst _norm = /* @__PURE__ */ new Vector3();\nconst _norm2 = /* @__PURE__ */ new Vector3();\nconst _pos = /* @__PURE__ */ new Vector3();\nconst _vec1 = /* @__PURE__ */ new Vector3();\nconst _vec2 = /* @__PURE__ */ new Vector3();\n\n// Converts a geometry with a given set of groups rendering a smaller set of\n// geometry into a new one with only the relevant triangles.\nfunction toGroupGeometry( geometry ) {\n\n\t// non indexed makes this process easier\n\tgeometry = geometry.toNonIndexed();\n\n\t// prep the arrays\n\tconst { groups } = geometry;\n\tconst { position, normal } = geometry.attributes;\n\tconst newNorm = [];\n\tconst newPos = [];\n\n\t// add the normals and the positions\n\tfor ( const group of groups ) {\n\n\t\tconst { start, count } = group;\n\t\tfor ( let i = start, l = ( start + count ); i < l; i ++ ) {\n\n\t\t\t_vec1.fromBufferAttribute( position, i );\n\t\t\t_vec2.fromBufferAttribute( normal, i );\n\n\t\t\tnewPos.push( ..._vec1 );\n\t\t\tnewNorm.push( ..._vec2 );\n\n\t\t}\n\n\t}\n\n\t// set the new geometry\n\tconst newGeometry = new BufferGeometry();\n\tnewGeometry.setAttribute( 'position', new BufferAttribute( new Float32Array( newPos ), 3 ) );\n\tnewGeometry.setAttribute( 'normal', new BufferAttribute( new Float32Array( newNorm ), 3 ) );\n\n\treturn newGeometry;\n\n}\n\nfunction getRegionGeometry( ellipsoidRegion, { computeNormals = false } = {} ) {\n\n\t// retrieve the relevant fields\n\tconst {\n\t\tlatStart = - Math.PI / 2, latEnd = Math.PI / 2,\n\t\tlonStart = 0, lonEnd = 2 * Math.PI,\n\t\theightStart = 0, heightEnd = 0,\n\t} = ellipsoidRegion;\n\n\t// get the attributes\n\tconst geometry = new BoxGeometry( 1, 1, 1, 32, 32 );\n\tconst { normal, position } = geometry.attributes;\n\n\t// clone the position buffer so we can reference it for normal calculations later\n\tconst refPosition = position.clone();\n\n\t// perturb the position buffer into an ellipsoid region\n\tfor ( let i = 0, l = position.count; i < l; i ++ ) {\n\n\t\t_pos.fromBufferAttribute( position, i );\n\n\t\tconst lat = MathUtils.mapLinear( _pos.x, - 0.5, 0.5, latStart, latEnd );\n\t\tconst lon = MathUtils.mapLinear( _pos.y, - 0.5, 0.5, lonStart, lonEnd );\n\n\t\tlet height = heightStart;\n\t\tellipsoidRegion.getCartographicToNormal( lat, lon, _norm );\n\t\tif ( _pos.z < 0 ) {\n\n\t\t\theight = heightEnd;\n\n\t\t}\n\t\tellipsoidRegion.getCartographicToPosition( lat, lon, height, _pos );\n\t\tposition.setXYZ( i, ..._pos );\n\n\t}\n\n\tif ( computeNormals ) {\n\n\t\t// compute the vertex normals so we can get the edge normals\n\t\tgeometry.computeVertexNormals();\n\n\t}\n\n\t// compute the top and bottom cap normals\n\tfor ( let i = 0, l = refPosition.count; i < l; i ++ ) {\n\n\t\t_pos.fromBufferAttribute( refPosition, i );\n\n\t\tconst lat = MathUtils.mapLinear( _pos.x, - 0.5, 0.5, latStart, latEnd );\n\t\tconst lon = MathUtils.mapLinear( _pos.y, - 0.5, 0.5, lonStart, lonEnd );\n\n\t\t_norm.fromBufferAttribute( normal, i );\n\t\tellipsoidRegion.getCartographicToNormal( lat, lon, _norm2 );\n\n\t\t// exclude the sides so we get sharp corners\n\t\tif ( Math.abs( _norm.dot( _norm2 ) ) > 0.1 ) {\n\n\t\t\tif ( _pos.z > 0 ) {\n\n\t\t\t\t_norm2.multiplyScalar( - 1 );\n\n\t\t\t}\n\n\t\t\tnormal.setXYZ( i, ..._norm2 );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\nexport class EllipsoidRegionLineHelper extends LineSegments {\n\n\tconstructor( ellipsoidRegion = new EllipsoidRegion(), color = 0xffff00 ) {\n\n\t\tsuper();\n\t\tthis.ellipsoidRegion = ellipsoidRegion;\n\t\tthis.material.color.set( color );\n\t\tthis.update();\n\n\t}\n\n\tupdate() {\n\n\t\tconst geometry = getRegionGeometry( this.ellipsoidRegion );\n\t\tthis.geometry.dispose();\n\t\tthis.geometry = new EdgesGeometry( geometry, 80 );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.geometry.dispose();\n\t\tthis.material.dispose();\n\n\t}\n\n}\n\nexport class EllipsoidRegionHelper extends Mesh {\n\n\tconstructor( ellipsoidRegion = new EllipsoidRegion(), color = 0xffff00 ) {\n\n\t\tsuper();\n\t\tthis.ellipsoidRegion = ellipsoidRegion;\n\t\tthis.material.color.set( color );\n\t\tthis.update();\n\n\t}\n\n\tupdate() {\n\n\t\t// dispose of the existing geometry\n\t\tthis.geometry.dispose();\n\n\t\t// retrieve the relevant fields\n\t\tconst geometry = getRegionGeometry( this.ellipsoidRegion, { computeNormals: true } );\n\t\tconst { lonStart, lonEnd } = this;\n\n\t\t// exclude the side tris if the region wraps around\n\t\tif ( lonEnd - lonStart >= 2 * Math.PI ) {\n\n\t\t\tgeometry.groups.splice( 2, 2 );\n\t\t\tthis.geometry = toGroupGeometry( geometry );\n\n\t\t} else {\n\n\t\t\tthis.geometry = geometry;\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.geometry.dispose();\n\t\tthis.material.dispose();\n\n\t}\n\n}\n"],"names":["_vector","Vector3","axes","SphereHelper","LineSegments","sphere","color","angleSteps","geometry","BufferGeometry","positions","i","axis1","axis2","a","angle","BufferAttribute","LineBasicMaterial","force","_norm","_norm2","_pos","_vec1","_vec2","toGroupGeometry","groups","position","normal","newNorm","newPos","group","start","count","l","newGeometry","getRegionGeometry","ellipsoidRegion","computeNormals","latStart","latEnd","lonStart","lonEnd","heightStart","heightEnd","BoxGeometry","refPosition","lat","MathUtils","lon","height","EllipsoidRegionLineHelper","EllipsoidRegion","EdgesGeometry","EllipsoidRegionHelper","Mesh"],"mappings":"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"}