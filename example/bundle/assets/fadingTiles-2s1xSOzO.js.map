{"version":3,"file":"fadingTiles-2s1xSOzO.js","sources":["../../three/fadingTiles.js"],"sourcesContent":["import {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tOrthographicCamera,\n\tGroup,\n} from 'three';\nimport { TilesFadePlugin } from '3d-tiles-renderer/plugins';\nimport { EnvironmentControls, TilesRenderer, CameraTransitionManager } from '3d-tiles-renderer';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet controls, scene, renderer;\nlet groundTiles, skyTiles, tilesParent, transition;\n\nconst params = {\n\n\treinstantiateTiles,\n\tfadeRootTiles: false,\n\tuseFade: true,\n\terrorTarget: 6,\n\tfadeDuration: 0.5,\n\trenderScale: 1,\n\tfadingGroundTiles: '0 tiles',\n\n\torthographic: false,\n\ttransitionDuration: 0.25,\n\n};\n\ninit();\nrender();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0xd8cec0 );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// set up cameras and ortho / perspective transition\n\ttransition = new CameraTransitionManager(\n\t\tnew PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.25, 4000 ),\n\t\tnew OrthographicCamera( - 1, 1, 1, - 1, 0, 4000 ),\n\t);\n\ttransition.camera.position.set( 20, 10, 20 );\n\ttransition.camera.lookAt( 0, 0, 0 );\n\ttransition.autoSync = false;\n\n\ttransition.addEventListener( 'camera-change', ( { camera, prevCamera } ) => {\n\n\t\tskyTiles.deleteCamera( prevCamera );\n\t\tgroundTiles.deleteCamera( prevCamera );\n\n\t\tskyTiles.setCamera( camera );\n\t\tgroundTiles.setCamera( camera );\n\n\t\tcontrols.setCamera( camera );\n\n\t} );\n\n\t// controls\n\tcontrols = new EnvironmentControls( scene, transition.camera, renderer.domElement );\n\tcontrols.minZoomDistance = 2;\n\tcontrols.cameraRadius = 1;\n\n\t// tiles parent group\n\ttilesParent = new Group();\n\ttilesParent.rotation.set( Math.PI / 2, 0, 0 );\n\tscene.add( tilesParent );\n\n\t// init tiles\n\treinstantiateTiles();\n\n\t// events\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t// gui initialization\n\tconst gui = new GUI();\n\tconst cameraFolder = gui.addFolder( 'camera' );\n\tcameraFolder.add( params, 'orthographic' ).onChange( v => {\n\n\t\ttransition.fixedPoint.copy( controls.pivotPoint );\n\n\t\t// adjust the camera before the transition begins\n\t\ttransition.syncCameras();\n\t\tcontrols.adjustCamera( transition.perspectiveCamera );\n\t\tcontrols.adjustCamera( transition.orthographicCamera );\n\t\ttransition.toggle();\n\n\t} );\n\tcameraFolder.add( params, 'transitionDuration', 0, 1.5 );\n\n\tconst fadeFolder = gui.addFolder( 'fade' );\n\tfadeFolder.add( params, 'useFade' );\n\tfadeFolder.add( params, 'fadeRootTiles' );\n\tfadeFolder.add( params, 'errorTarget', 0, 1000 );\n\tfadeFolder.add( params, 'fadeDuration', 0, 5 );\n\tfadeFolder.add( params, 'renderScale', 0.1, 1.0, 0.05 ).onChange( v => renderer.setPixelRatio( v * window.devicePixelRatio ) );\n\n\tconst textController = fadeFolder.add( params, 'fadingGroundTiles' ).listen().disable();\n\ttextController.domElement.style.opacity = 1.0;\n\n\tgui.add( params, 'reinstantiateTiles' );\n\n\tgui.open();\n\n}\n\nfunction reinstantiateTiles() {\n\n\tif ( groundTiles ) {\n\n\t\tgroundTiles.dispose();\n\t\tgroundTiles.group.removeFromParent();\n\n\t\tskyTiles.dispose();\n\t\tskyTiles.group.removeFromParent();\n\n\t}\n\n\tgroundTiles = new TilesRenderer( 'https://raw.githubusercontent.com/NASA-AMMOS/3DTilesSampleData/master/msl-dingo-gap/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize_tileset.json' );\n\tgroundTiles.fetchOptions.mode = 'cors';\n\tgroundTiles.lruCache.minSize = 900;\n\tgroundTiles.lruCache.maxSize = 1300;\n\tgroundTiles.errorTarget = 12;\n\tgroundTiles.registerPlugin( new TilesFadePlugin() );\n\tgroundTiles.setCamera( transition.camera );\n\n\tskyTiles = new TilesRenderer( 'https://raw.githubusercontent.com/NASA-AMMOS/3DTilesSampleData/master/msl-dingo-gap/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_sky/0528_0260184_to_s64o256_sky_tileset.json' );\n\tskyTiles.fetchOptions.mode = 'cors';\n\tskyTiles.lruCache = groundTiles.lruCache;\n\tskyTiles.registerPlugin( new TilesFadePlugin() );\n\tskyTiles.setCamera( transition.camera );\n\n\ttilesParent.add( groundTiles.group, skyTiles.group );\n\n}\n\nfunction onWindowResize() {\n\n\tconst { perspectiveCamera, orthographicCamera } = transition;\n\tconst aspect = window.innerWidth / window.innerHeight;\n\n\torthographicCamera.bottom = - 40;\n\torthographicCamera.top = 40;\n\torthographicCamera.left = - 40 * aspect;\n\torthographicCamera.right = 40 * aspect;\n\torthographicCamera.updateProjectionMatrix();\n\n\tperspectiveCamera.aspect = aspect;\n\tperspectiveCamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\tcontrols.enabled = ! transition.animating;\n\tcontrols.update();\n\n\ttransition.duration = 1000 * params.transitionDuration;\n\ttransition.update();\n\n\tconst camera = transition.camera;\n\tcamera.updateMatrixWorld();\n\n\tconst groundPlugin = groundTiles.getPluginByName( 'FADE_TILES_PLUGIN' );\n\tgroundPlugin.fadeRootTiles = params.fadeRootTiles;\n\tgroundPlugin.fadeDuration = params.useFade ? params.fadeDuration * 1000 : 0;\n\tgroundTiles.errorTarget = params.errorTarget;\n\tgroundTiles.setCamera( camera );\n\tgroundTiles.setResolutionFromRenderer( camera, renderer );\n\tgroundTiles.update();\n\n\tconst skyPlugin = skyTiles.getPluginByName( 'FADE_TILES_PLUGIN' );\n\tskyPlugin.fadeRootTiles = params.fadeRootTiles;\n\tskyPlugin.fadeDuration = params.useFade ? params.fadeDuration * 1000 : 0;\n\tskyTiles.setCamera( camera );\n\tskyTiles.setResolutionFromRenderer( camera, renderer );\n\tskyTiles.update();\n\n\trenderer.render( scene, camera );\n\n\tparams.fadingGroundTiles = groundPlugin.fadingTiles + ' tiles';\n\n}\n"],"names":["controls","scene","renderer","groundTiles","skyTiles","tilesParent","transition","params","reinstantiateTiles","init","render","WebGLRenderer","Scene","CameraTransitionManager","PerspectiveCamera","OrthographicCamera","camera","prevCamera","EnvironmentControls","Group","onWindowResize","gui","GUI","cameraFolder","v","fadeFolder","textController","TilesRenderer","TilesFadePlugin","perspectiveCamera","orthographicCamera","aspect","groundPlugin","skyPlugin"],"mappings":"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"}