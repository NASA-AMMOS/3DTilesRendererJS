{"version":3,"file":"mapTiles-BDRvHBjX.js","sources":["../../three/mapTiles.js"],"sourcesContent":["import {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n} from 'three';\nimport { TilesRenderer, GlobeControls, EnvironmentControls } from '3d-tiles-renderer';\nimport { TilesFadePlugin, UpdateOnChangePlugin, XYZTilesPlugin, } from '3d-tiles-renderer/plugins';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet controls, scene, renderer;\nlet tiles, camera;\n\nconst params = {\n\n\terrorTarget: 1,\n\tplanar: false,\n\n};\n\n// throttled render function\nconst scheduleRender = throttle( render );\n\ninit();\nrender();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x111111 );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// set up cameras and ortho / perspective transition\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.001, 10000 );\n\n\tinitTiles();\n\n\t// events\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t// gui initialization\n\tconst gui = new GUI();\n\tgui.add( params, 'planar' ).onChange( initTiles );\n\tgui.add( params, 'errorTarget', 1, 40 ).onChange( () => {\n\n\t\ttiles.getPluginByName( 'UPDATE_ON_CHANGE_PLUGIN' ).needsUpdate = true;\n\t\tscheduleRender();\n\n\t} );\n\n\tgui.open();\n\n}\n\nfunction initTiles() {\n\n\tif ( tiles ) {\n\n\t\ttiles.dispose();\n\n\t}\n\n\tif ( controls ) {\n\n\t\tcontrols.dispose();\n\n\t}\n\n\t// tiles\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new TilesFadePlugin( { maximumFadeOutTiles: 200 } ) );\n\ttiles.registerPlugin( new UpdateOnChangePlugin() );\n\ttiles.registerPlugin( new XYZTilesPlugin( {\n\t\tcenter: true,\n\t\tshape: params.planar ? 'planar' : 'ellipsoid',\n\t\turl: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png'\n\t} ) );\n\n\ttiles.lruCache.minSize = 900;\n\ttiles.lruCache.maxSize = 1300;\n\ttiles.parseQueue.maxJobs = 3;\n\ttiles.setCamera( camera );\n\tscene.add( tiles.group );\n\n\tif ( params.planar ) {\n\n\t\t// create the controls\n\t\tcontrols = new EnvironmentControls( scene, camera, renderer.domElement );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.minDistance = 1e-4;\n\t\tcontrols.maxDistance = 5;\n\t\tcontrols.cameraRadius = 0;\n\t\tcontrols.fallbackPlane.normal.set( 0, 0, 1 );\n\t\tcontrols.up.set( 0, 0, 1 );\n\t\tcontrols.camera.position.set( 0, 0, 2 );\n\t\tcontrols.camera.quaternion.identity();\n\n\t\t// reset the camera\n\t\tcamera.near = 1e-4;\n\t\tcamera.far = 10;\n\t\tcamera.updateProjectionMatrix();\n\n\t} else {\n\n\t\t// init tiles\n\t\ttiles.group.rotation.x = - Math.PI / 2;\n\n\t\t// create the controls\n\t\tcontrols = new GlobeControls( scene, camera, renderer.domElement );\n\t\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.camera.position.set( 0, 0, 1.75 * 1e7 );\n\t\tcontrols.camera.quaternion.identity();\n\t\tcontrols.minDistance = 150;\n\n\t}\n\n\t// listen to events to call render() on change\n\tcontrols.addEventListener( 'change', scheduleRender );\n\tcontrols.addEventListener( 'end', scheduleRender );\n\ttiles.addEventListener( 'needs-render', scheduleRender );\n\ttiles.addEventListener( 'needs-update', scheduleRender );\n\n\trender();\n\n}\n\nfunction onWindowResize() {\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\tscheduleRender();\n\n}\n\nfunction render() {\n\n\tcontrols.update();\n\tcamera.updateMatrixWorld();\n\n\ttiles.errorTarget = params.errorTarget;\n\ttiles.setCamera( camera );\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.update();\n\n\trenderer.render( scene, camera );\n\n}\n\nfunction throttle( callback ) {\n\n\tlet scheduled = false;\n\treturn () => {\n\n\t\tif ( ! scheduled ) {\n\n\t\t\tscheduled = true;\n\t\t\trequestAnimationFrame( () => {\n\n\t\t\t\tscheduled = false;\n\t\t\t\tcallback();\n\n\t\t\t} );\n\n\t\t}\n\n\t};\n\n}\n"],"names":["controls","scene","renderer","tiles","camera","params","scheduleRender","throttle","render","init","WebGLRenderer","Scene","PerspectiveCamera","initTiles","onWindowResize","gui","GUI","TilesRenderer","TilesFadePlugin","UpdateOnChangePlugin","XYZTilesPlugin","EnvironmentControls","GlobeControls","aspect","callback","scheduled"],"mappings":"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"}