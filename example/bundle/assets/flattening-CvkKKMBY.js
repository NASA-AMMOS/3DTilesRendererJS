import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as c,j as i,a as f,b as z,d as J,u as V,c as Y,C as Z,T as H,f as q,E as Q}from"./CameraControls-CQWLZjoh.js";import{C as X}from"./plugins-DBdp9Zs1.js";import{n as _,o as P,d as W,R as K,M as R,s as $,B as k,al as ee,G as te}from"./three.module-D-uF--xd.js";import{D as se}from"./DRACOLoader-gn1nzdEq.js";import{E as ie}from"./Environment-CijpZgSe.js";import{G as re,a as ae}from"./GizmoViewport-BPu30StC.js";import{G as oe}from"./GLTFExtensionsPlugin-CGSNI2LM.js";import{U as ne}from"./UpdateOnChangePlugin-BPSehBEG.js";import{T as le}from"./TilesFadePlugin-BRcOjUD_.js";import{R as pe}from"./ReorientationPlugin-zHRdLvVu.js";import"./GlobeControls-4ScISV7m.js";import"./EnvironmentControls-BRF5UI-K.js";import"./Ellipsoid-Dwquuq5w.js";import"./I3DMLoader-BWluRuWb.js";import"./BatchTable-CRr3zuRk.js";import"./GLTFLoader-B4GrkiON.js";import"./constants-JFoaxC9y.js";import"./TilesRenderer-Bm042Xsy.js";import"./TilesRendererBase-CFsQu8zV.js";import"./B3DMLoader-Cnf0ja_2.js";import"./B3DMLoaderBase-w5mdSgm-.js";import"./PNTSLoader-DwvZQNdL.js";import"./CMPTLoader-BOTrymv0.js";import"./EllipsoidRegion-VNvPMw5b.js";import"./GoogleCloudAuth-vMnc9CC1.js";import"./CesiumIonAuth-ByA9ya_o.js";import"./EPSGTilesPlugin-DX3n6hNw.js";import"./ImageFormatPlugin-DGN9sc3I.js";import"./TMSImageSource-BIqdNmly.js";import"./TiledImageSource-DmD64Gn9.js";import"./GeometryClipper-7b525s21.js";import"./constants-C0SaZ5SG.js";const C=new W,v=new P,M=new _,G=new _,I=new K,de=new $({side:ee}),A=new k,j=1e5;function F(l,e){return l.isBufferGeometry?(l.boundingSphere===null&&l.computeBoundingSphere(),e.copy(l.boundingSphere)):(A.setFromObject(l),A.getBoundingSphere(e),e)}let he=class{constructor(){this.name="TILE_FLATTENING_PLUGIN",this.priority=-100,this.tiles=null,this.shapes=new Map,this.positionsMap=new Map,this.positionsUpdated=new Set,this.needsUpdate=!1}init(e){this.tiles=e,this.needsUpdate=!0,this._updateBeforeCallback=()=>{this.needsUpdate&&(this._updateTiles(),this.needsUpdate=!1)},this._disposeModelCallback=({tile:t})=>{this.positionsMap.delete(t),this.positionsUpdated.delete(t)},e.addEventListener("update-before",this._updateBeforeCallback),e.addEventListener("dispose-model",this._disposeModelCallback)}setTileActive(e,t){t&&!this.positionsUpdated.has(e)&&this._updateTile(e)}_updateTile(e){const{positionsUpdated:t,positionsMap:s,shapes:r,tiles:h}=this;t.add(e);const d=e.engineData.scene;if(s.has(e)){const u=s.get(e);d.traverse(a=>{if(a.geometry){const g=u.get(a.geometry);g&&(a.geometry.attributes.position.array.set(g),a.geometry.attributes.position.needsUpdate=!0)}})}else{const u=new Map;s.set(e,u),d.traverse(a=>{a.geometry&&u.set(a.geometry,a.geometry.attributes.position.array.slice())})}d.updateMatrixWorld(!0),d.traverse(u=>{const{geometry:a}=u;a&&(M.copy(u.matrixWorld),d.parent!==null&&M.premultiply(h.group.matrixWorldInverse),G.copy(M).invert(),F(a,C).applyMatrix4(M),r.forEach(({shape:g,direction:o,sphere:S,thresholdMode:E,threshold:w,flattenRange:n})=>{v.subVectors(C.center,S.center),v.addScaledVector(o,-o.dot(v));const x=(C.radius+S.radius)**2;if(v.lengthSq()>x)return;const{position:p}=a.attributes,{ray:m}=I;m.direction.copy(o).multiplyScalar(-1);for(let T=0,O=p.count;T<O;T++){m.origin.fromBufferAttribute(p,T).applyMatrix4(M).addScaledVector(o,j),I.far=j;const y=I.intersectObject(g)[0];if(y){let b=(j-y.distance)/w;const U=b>=1;(!U||U&&E==="flatten")&&(b=Math.min(b,1),y.point.addScaledVector(m.direction,R.mapLinear(b,0,1,-n,0)),y.point.applyMatrix4(G),p.setXYZ(T,...y.point))}}}))}),this.tiles.dispatchEvent({type:"needs-render"})}_updateTiles(){this.positionsUpdated.clear(),this.tiles.activeTiles.forEach(e=>this._updateTile(e))}hasShape(e){return this.shapes.has(e)}addShape(e,t=new P(0,0,-1),s={}){if(this.hasShape(e))throw new Error("TileFlatteningPlugin: Shape is already used.");typeof s=="number"&&(console.warn('TileFlatteningPlugin: "addShape" function signature has changed. Please use an options object, instead.'),s={threshold:s}),this.needsUpdate=!0;const r=e.clone();r.updateMatrixWorld(!0),r.traverse(d=>{d.material&&(d.material=de)});const h=F(r,new W);this.shapes.set(e,{shape:r,direction:t.clone(),sphere:h,thresholdMode:"none",threshold:1/0,flattenRange:0,...s})}updateShape(e){if(!this.hasShape(e))throw new Error("TileFlatteningPlugin: Shape is not present.");const{direction:t,threshold:s,thresholdMode:r,flattenRange:h}=this.shapes.get(e);this.deleteShape(e),this.addShape(e,t,{threshold:s,thresholdMode:r,flattenRange:h})}deleteShape(e){return this.needsUpdate=!0,this.shapes.delete(e)}clearShapes(){this.shapes.size!==0&&(this.needsUpdate=!0,this.shapes.clear())}dispose(){this.tiles.removeEventListener("before-update",this._updateBeforeCallback),this.tiles.removeEventListener("dispose-model",this._disposeModelCallback),this.positionsMap.forEach(e=>{e.forEach((t,s)=>{const{position:r}=s.attributes;r.array.set(t),r.needsUpdate=!0})})}};const L=new _;function N(l,e){let t="";return l.traverse(s=>{let r=s.matrix;s===l&&(L.copy(l.matrixWorld).premultiply(e),r=L),s.geometry&&(t+=s.geometry.uuid+"_"),r.elements.forEach(h=>{t+=h.toFixed(6)+","})}),t}function ue(l){const e=c.useContext(z),t=c.useContext(J),{children:s,visible:r=!1,threshold:h=1/0,thresholdMode:d="none",flattenRange:u=0,direction:a=null,relativeToEllipsoid:g=!1}=l,[o,S]=c.useState(null),[E,w]=c.useState(null),n=c.useMemo(()=>new te,[]),x=c.useCallback(()=>{e.deleteShape(n),n.clear(),n.add(...o.children.map(m=>m.clone())),t.group.updateMatrixWorld(),o.updateMatrixWorld(!0),n.matrixWorld.copy(o.matrixWorld).premultiply(t.group.matrixWorldInverse).decompose(n.position,n.quaternion,n.scale);const p=new P;if(a)p.copy(a);else if(g){const m=new k;m.setFromObject(n),m.getCenter(p),t.ellipsoid.getPositionToNormal(p,p).multiplyScalar(-1)}else p.set(0,0,1);e.addShape(n,p,{threshold:h,thresholdMode:d,flattenRange:u}),w(N(o,t.group.matrixWorldInverse))},[t,o,a,g,e,h,d,u,n]);return c.useEffect(()=>{if(!(t===null||o===null||e===null))return x(),()=>{e.deleteShape(n)}},[o,e,n,t,x]),V(()=>{if(!t||!o)return;const p=N(o,t.group.matrixWorldInverse);E!==p&&x()}),i.jsx("group",{ref:S,visible:r,raycast:()=>!1,children:s})}const ce=c.forwardRef(function(e,t){const{children:s,...r}=e;return i.jsx(f,{plugin:he,ref:t,...r,children:s})}),me=new se().setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),B=35.3606*R.DEG2RAD,D=138.7274*R.DEG2RAD;function ge(){return i.jsxs(Z,{camera:{position:[1e4*.7,1e4*.7,1e4*.7],far:16e5},style:{width:"100%",height:"100%",position:"absolute",margin:0,left:0,top:0},children:[i.jsxs(H,{group:{rotation:[-Math.PI/2,0,0]},children:[i.jsx(f,{plugin:X,args:{apiToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3MGNiODVmZS1hNzliLTQ5NWYtOTdhOS02ZmIzMmZlYWRlMzAiLCJpZCI6MjY3NzgzLCJpYXQiOjE3MzY0Mjg0MTJ9.o7EtbJyQ6yNAgfHFal1RS1BKKM-RmZNusqBCeiowNZo",assetId:"2275207",autoRefreshToken:!0}}),i.jsx(f,{plugin:oe,dracoLoader:me}),i.jsx(f,{plugin:ne}),i.jsx(f,{plugin:le}),i.jsx(f,{plugin:pe,args:{lat:B,lon:D}}),i.jsx(ce,{children:i.jsx(ue,{relativeToEllipsoid:!0,visible:!1,children:i.jsx(q,{lat:B,lon:D,height:1e3,children:i.jsx("mesh",{scale:5e3,children:i.jsx("circleGeometry",{})})})})})]}),i.jsx(Q,{enableDamping:!0,maxDistance:1e4*2,minDistance:500,minPolarAngle:0,maxPolarAngle:3*Math.PI/8}),i.jsx(ie,{preset:"sunset",background:!0,backgroundBlurriness:.9,environmentIntensity:1}),i.jsx(re,{alignment:"bottom-right",children:i.jsx(ae,{})})]})}Y.createRoot(document.getElementById("root")).render(i.jsx(c.StrictMode,{children:i.jsx(ge,{})}));
//# sourceMappingURL=flattening-CvkKKMBY.js.map
