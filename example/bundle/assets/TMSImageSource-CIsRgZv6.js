import{T as h}from"./TiledImageSource-DLt2EM25.js";import{M as n}from"./three.module-DBfedTbk.js";class P{get isMercator(){return this.scheme==="EPSG:3857"}constructor(t="EPSG:4326"){this.scheme=t,this.tileCountX=1,this.tileCountY=1,this.setScheme(t)}setScheme(t){switch(this.scheme=t,t){case"EPSG:4326":this.tileCountX=2,this.tileCountY=1;break;case"EPSG:3857":this.tileCountX=1,this.tileCountY=1;break;default:throw new Error(`ProjectionScheme: Unknown projection scheme "${t}"`)}}convertProjectionToLatitude(t){if(this.isMercator){const e=n.mapLinear(t,0,1,-1,1);return 2*Math.atan(Math.exp(e*Math.PI))-Math.PI/2}else return n.mapLinear(t,0,1,-Math.PI/2,Math.PI/2)}convertProjectionToLongitude(t){return n.mapLinear(t,0,1,-Math.PI,Math.PI)}convertLatitudeToProjection(t){if(this.isMercator){const e=Math.log(Math.tan(Math.PI/4+t/2));return 1/2+1*e/(2*Math.PI)}else return n.mapLinear(t,-Math.PI/2,Math.PI/2,0,1)}convertLongitudeToProjection(t){return(t+Math.PI)/(2*Math.PI)}getLongitudeDerivativeAtProjection(t){return 2*Math.PI}getLatitudeDerivativeAtProjection(t){let i=t-1e-5;return i<0&&(i=t+1e-5),this.isMercator?Math.abs(this.convertProjectionToLatitude(t)-this.convertProjectionToLatitude(i))/1e-5:Math.PI}getBounds(){return[this.convertProjectionToLongitude(0),this.convertProjectionToLatitude(0),this.convertProjectionToLongitude(1),this.convertProjectionToLatitude(1)]}}class A extends h{constructor(t={}){super();const{levels:e=20,tileDimension:i=256,url:r=null}=t;this.tileDimension=i,this.levels=e,this.url=r}getUrl(t,e,i){return this.url.replace(/{\s*z\s*}/gi,i).replace(/{\s*x\s*}/gi,t).replace(/{\s*(y|reverseY|-\s*y)\s*}/gi,e)}init(){const{tiling:t,tileDimension:e,levels:i,url:r}=this;return t.flipY=!/{\s*reverseY|-\s*y\s*}/g.test(r),t.setProjection(new P("EPSG:3857")),t.setContentBounds(...t.projection.getBounds()),t.generateLevels(i,t.projection.tileCountX,t.projection.tileCountY,{tilePixelWidth:e,tilePixelHeight:e}),this.url=r,Promise.resolve()}}class T extends h{constructor(t={}){const{url:e=null}=t;super(),this.tileSets=null,this.extension=null,this.url=e}getUrl(t,e,i){const{url:r,extension:s,tileSets:l,tiling:c}=this;return new URL(`${parseInt(l[i-c.minLevel].href)}/${t}/${e}.${s}`,r).toString()}init(){const{url:t}=this;return this.fetchData(new URL("tilemapresource.xml",t),this.fetchOptions).then(e=>e.text()).then(e=>{const{tiling:i}=this,r=new DOMParser().parseFromString(e,"text/xml"),s=r.querySelector("BoundingBox"),l=r.querySelector("TileFormat"),u=[...r.querySelector("TileSets").querySelectorAll("TileSet")].map(o=>({href:parseInt(o.getAttribute("href")),unitsPerPixel:parseFloat(o.getAttribute("units-per-pixel")),order:parseInt(o.getAttribute("order"))})).sort((o,L)=>o.order-L.order),g=parseFloat(s.getAttribute("minx"))*n.DEG2RAD,m=parseFloat(s.getAttribute("maxx"))*n.DEG2RAD,p=parseFloat(s.getAttribute("miny"))*n.DEG2RAD,S=parseFloat(s.getAttribute("maxy"))*n.DEG2RAD,x=parseInt(l.getAttribute("width")),d=parseInt(l.getAttribute("height")),M=l.getAttribute("extension"),I=r.querySelector("SRS").textContent;this.extension=M,this.url=t,this.tileSets=u,i.setProjection(new P(I)),i.setContentBounds(g,p,m,S),u.forEach(({order:o})=>{i.setLevel(o,{tileCountX:i.projection.tileCountX*2**o,tilePixelWidth:x,tilePixelHeight:d})})})}}export{P,T,A as X};
//# sourceMappingURL=TMSImageSource-CIsRgZv6.js.map
