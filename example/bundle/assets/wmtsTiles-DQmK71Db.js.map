{"version":3,"file":"wmtsTiles-DQmK71Db.js","sources":["../../../src/three/plugins/loaders/WMTSCapabilitiesLoader.js","../../wmtsTiles.js"],"sourcesContent":["import { WGS84_RADIUS, LoaderBase } from '3d-tiles-renderer/core';\nimport { ProjectionScheme } from '../images/utils/ProjectionScheme.js';\nimport { MathUtils } from 'three';\n\nconst EQUATOR_CIRCUMFERENCE = WGS84_RADIUS * Math.PI * 2;\nconst mercatorProjection = /* @__PURE__ */ new ProjectionScheme( 'EPSG:3857' );\n\n// this CRS84 crs is the same as EPSG:4326 except the order of lat / lon are swapped\nfunction isCRS84( crs ) {\n\n\treturn /(:84|:crs84)$/i.test( crs );\n\n}\n\nfunction isEPSG4326( crs ) {\n\n\treturn /:4326$/i.test( crs );\n\n}\n\nfunction isWebMercator( crs ) {\n\n\treturn /:3857$/i.test( crs );\n\n}\n\n// parse a series of space-separated numbers\nfunction parseTuple( tuple ) {\n\n\treturn tuple.trim().split( /\\s+/ ).map( v => parseFloat( v ) );\n\n}\n\n// swap the tuple order to lon, lat if crs is EPSG:4326 since the tiles renderer project\n// expects lon, lat order\nfunction correctTupleOrder( tuple, crs ) {\n\n\tif ( isEPSG4326( crs ) ) {\n\n\t\t[ tuple[ 1 ], tuple[ 0 ] ] = [ tuple[ 0 ], tuple[ 1 ] ];\n\n\t}\n\n}\n\n// web mercator specifies bounding boxes etc as meters assuming the width and height of the full image span\n// is aligned to the globe equator circumference.\nfunction correctTupleUnits( tuple, crs ) {\n\n\tif ( isWebMercator( crs ) ) {\n\n\t\ttuple[ 0 ] = mercatorProjection.convertProjectionToLongitude( 0.5 + tuple[ 0 ] / EQUATOR_CIRCUMFERENCE );\n\t\ttuple[ 1 ] = mercatorProjection.convertProjectionToLatitude( 0.5 + tuple[ 1 ] / EQUATOR_CIRCUMFERENCE );\n\n\t\t// to degrees\n\t\ttuple[ 0 ] *= MathUtils.RAD2DEG;\n\t\ttuple[ 1 ] *= MathUtils.RAD2DEG;\n\n\t\treturn tuple;\n\n\t}\n\n}\n\nfunction tupleToRadians( tuple ) {\n\n\ttuple[ 0 ] *= MathUtils.DEG2RAD;\n\ttuple[ 1 ] *= MathUtils.DEG2RAD;\n\n}\n\nexport class WMTSCapabilitiesLoader extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\tconst str = new TextDecoder( 'utf-8' ).decode( new Uint8Array( buffer ) );\n\t\tconst xml = new DOMParser().parseFromString( str, 'text/xml' );\n\t\tconst contents = xml.querySelector( 'Contents' );\n\n\t\tconst tileMatrixSets = getChildrenByTag( contents, 'TileMatrixSet' ).map( el => parseTileMatrixSet( el ) );\n\t\tconst layers = getChildrenByTag( contents, 'Layer' ).map( el => parseLayer( el ) );\n\t\tconst serviceIdentification = parseServiceIdentification( xml.querySelector( 'ServiceIdentification' ) );\n\n\t\tlayers.forEach( layer => {\n\n\t\t\tlayer.tileMatrixSets = layer.tileMatrixSetLinks.map( key => {\n\n\t\t\t\treturn tileMatrixSets.find( tms => tms.identifier === key );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn {\n\t\t\tserviceIdentification,\n\t\t\ttileMatrixSets,\n\t\t\tlayers,\n\t\t};\n\n\t}\n\n}\n\n// parse <ows:ServiceIdentification> tag\nfunction parseServiceIdentification( el ) {\n\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst abstract = el.querySelector( 'Abstract' )?.textContent || '';\n\tconst serviceType = el.querySelector( 'ServiceType' ).textContent;\n\tconst serviceTypeVersion = el.querySelector( 'ServiceTypeVersion' ).textContent;\n\n\treturn {\n\t\ttitle,\n\t\tabstract,\n\t\tserviceType,\n\t\tserviceTypeVersion,\n\t};\n\n}\n\n// parse <Layers> tag\nfunction parseLayer( el ) {\n\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst format = el.querySelector( 'Format' ).textContent;\n\tconst resourceUrls = getChildrenByTag( el, 'ResourceURL' ).map( el => {\n\n\t\treturn parseResourceUrl( el );\n\n\t} );\n\tconst tileMatrixSetLinks = getChildrenByTag( el, 'TileMatrixSetLink' ).map( el => {\n\n\t\treturn getChildrenByTag( el, 'TileMatrixSet' )[ 0 ].textContent;\n\n\t} );\n\tconst styles = getChildrenByTag( el, 'Style' ).map( el => {\n\n\t\treturn parseStyle( el );\n\n\t} );\n\tconst dimensions = getChildrenByTag( el, 'Dimension' ).map( el => {\n\n\t\treturn parseDimension( el );\n\n\t} );\n\n\tlet boundingBox = parseBoundingBox( el.querySelector( 'WGS84BoundingBox' ) );\n\tif ( ! boundingBox ) {\n\n\t\tboundingBox = parseBoundingBox( el.querySelector( 'BoundingBox' ) );\n\n\t}\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tformat,\n\t\tdimensions,\n\t\ttileMatrixSetLinks,\n\t\tstyles,\n\t\tboundingBox,\n\t\tresourceUrls,\n\t};\n\n}\n\n// parse layer <ResourceURL> tag\nfunction parseResourceUrl( el ) {\n\n\tconst template = el.getAttribute( 'template' );\n\tconst format = el.getAttribute( 'format' );\n\tconst resourceType = el.getAttribute( 'resourceType' );\n\n\treturn {\n\t\ttemplate,\n\t\tformat,\n\t\tresourceType,\n\t};\n\n}\n\n// parse layer <Dimension> tag\nfunction parseDimension( el ) {\n\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst uom = el.querySelector( 'UOM' )?.textContent || '';\n\tconst defaultValue = el.querySelector( 'Default' ).textContent;\n\tconst current = el.querySelector( 'Current' )?.textContent === 'true';\n\tconst values = getChildrenByTag( el, 'Value' ).map( el => el.textContent );\n\treturn {\n\t\tidentifier,\n\t\tuom,\n\t\tdefaultValue,\n\t\tcurrent,\n\t\tvalues,\n\t};\n\n}\n\n// parse <ows:WGS84BoundingBox> and <BoundingBox> tags\nfunction parseBoundingBox( el ) {\n\n\tif ( ! el ) {\n\n\t\treturn null;\n\n\t}\n\n\tlet crs = el.nodeName.endsWith( 'WGS84BoundingBox' ) ? 'urn:ogc:def:crs:CRS::84' : el.getAttribute( 'crs' );\n\tconst lowerCorner = parseTuple( el.querySelector( 'LowerCorner' ).textContent );\n\tconst upperCorner = parseTuple( el.querySelector( 'UpperCorner' ).textContent );\n\n\tcorrectTupleOrder( lowerCorner, crs );\n\tcorrectTupleOrder( upperCorner, crs );\n\n\tcorrectTupleUnits( lowerCorner, crs );\n\tcorrectTupleUnits( upperCorner, crs );\n\n\ttupleToRadians( lowerCorner );\n\ttupleToRadians( upperCorner );\n\n\tif ( isCRS84( crs ) ) {\n\n\t\tcrs = 'EPSG:4326';\n\n\t} else if ( isWebMercator( crs ) ) {\n\n\t\t// Used for detecting \"urn:ogc:def:crs:EPSG::3857\" and converting it to\n\t\t// a commonly legible CRS string\n\t\tcrs = 'EPSG:3857';\n\n\t}\n\n\treturn {\n\t\tcrs,\n\t\tlowerCorner,\n\t\tupperCorner,\n\t\tbounds: [ ...lowerCorner, ...upperCorner ],\n\t};\n\n}\n\n// parse layer <Style> tag\nfunction parseStyle( el ) {\n\n\tconst title = el.querySelector( 'Title' )?.textContent || null;\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst isDefault = el.getAttribute( 'isDefault' ) === 'true';\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tisDefault,\n\t};\n\n}\n\n// parse <TileMatrixSet> tag\nfunction parseTileMatrixSet( el ) {\n\n\tlet supportedCRS = el.querySelector( 'SupportedCRS' ).textContent;\n\tconst title = el.querySelector( 'Title' )?.textContent || '';\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst abstract = el.querySelector( 'Abstract' )?.textContent || '';\n\tconst tileMatrices = [];\n\tel\n\t\t.querySelectorAll( 'TileMatrix' )\n\t\t.forEach( ( el, i ) => {\n\n\t\t\tconst tm = parseTileMatrix( el );\n\n\t\t\tconst pixelSpan = 0.00028 * tm.scaleDenominator;\n\t\t\tconst groundWidth = tm.tileWidth * tm.matrixWidth * pixelSpan;\n\t\t\tconst groundHeight = tm.tileHeight * tm.matrixHeight * pixelSpan;\n\t\t\tlet bottomRightCorner;\n\n\t\t\tcorrectTupleOrder( tm.topLeftCorner, supportedCRS );\n\n\t\t\tif ( isWebMercator( supportedCRS ) ) {\n\n\t\t\t\tbottomRightCorner = [\n\t\t\t\t\ttm.topLeftCorner[ 0 ] + groundWidth,\n\t\t\t\t\ttm.topLeftCorner[ 1 ] - groundHeight,\n\t\t\t\t];\n\n\t\t\t} else {\n\n\t\t\t\tbottomRightCorner = [\n\t\t\t\t\ttm.topLeftCorner[ 0 ] + 360 * groundWidth / EQUATOR_CIRCUMFERENCE,\n\t\t\t\t\ttm.topLeftCorner[ 1 ] - 360 * groundHeight / EQUATOR_CIRCUMFERENCE,\n\t\t\t\t];\n\n\t\t\t}\n\n\t\t\tcorrectTupleUnits( bottomRightCorner, supportedCRS );\n\t\t\tcorrectTupleUnits( tm.topLeftCorner, supportedCRS );\n\n\t\t\ttupleToRadians( bottomRightCorner );\n\t\t\ttupleToRadians( tm.topLeftCorner );\n\n\t\t\t// construct the bounds\n\t\t\ttm.bounds = [ ...tm.topLeftCorner, ...bottomRightCorner ];\n\n\t\t\t// ensure min and max order is correct\n\t\t\t[ tm.bounds[ 1 ], tm.bounds[ 3 ] ] = [ tm.bounds[ 3 ], tm.bounds[ 1 ] ];\n\n\t\t\ttileMatrices.push( tm );\n\n\t\t} );\n\n\tif ( isCRS84( supportedCRS ) ) {\n\n\t\tsupportedCRS = 'EPSG:4326';\n\n\t} else if ( isWebMercator( supportedCRS ) ) {\n\n\t\tsupportedCRS = 'EPSG:3857';\n\n\t}\n\n\treturn {\n\t\ttitle,\n\t\tidentifier,\n\t\tabstract,\n\t\tsupportedCRS,\n\t\ttileMatrices,\n\t};\n\n}\n\n// parse tile matrix set <TileMatrix> tag\nfunction parseTileMatrix( el ) {\n\n\tconst identifier = el.querySelector( 'Identifier' ).textContent;\n\tconst tileWidth = parseFloat( el.querySelector( 'TileWidth' ).textContent );\n\tconst tileHeight = parseFloat( el.querySelector( 'TileHeight' ).textContent );\n\tconst matrixWidth = parseFloat( el.querySelector( 'MatrixWidth' ).textContent );\n\tconst matrixHeight = parseFloat( el.querySelector( 'MatrixHeight' ).textContent );\n\tconst scaleDenominator = parseFloat( el.querySelector( 'ScaleDenominator' ).textContent );\n\tconst topLeftCorner = parseTuple( el.querySelector( 'TopLeftCorner' ).textContent );\n\n\treturn {\n\t\tidentifier,\n\t\ttileWidth,\n\t\ttileHeight,\n\t\tmatrixWidth,\n\t\tmatrixHeight,\n\t\tscaleDenominator,\n\t\ttopLeftCorner,\n\t\tbounds: null,\n\t};\n\n}\n\n// utility for finding immediate children by tag name\nfunction getChildrenByTag( el, tag ) {\n\n\treturn [ ...el.children ].filter( c => c.tagName === tag );\n\n}\n","import {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n} from 'three';\nimport { TilesRenderer, GlobeControls, EnvironmentControls } from '3d-tiles-renderer';\nimport { TilesFadePlugin, UpdateOnChangePlugin, WMTSCapabilitiesLoader, WMTSTilesPlugin } from '3d-tiles-renderer/plugins';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nconst url = window.location.hash.replace( /^#/, '' ) || 'https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?SERVICE=WMTS&request=GetCapabilities';\nconst compatibleCRSList = [ 'EPSG:4326', 'EPSG:3857' ];\n\nlet controls, scene, renderer;\nlet tiles, camera, gui;\nlet params, capabilities;\n\ninit();\nrender();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x111111 );\n\trenderer.setAnimationLoop( render );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// set up cameras and ortho / perspective transition\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.001, 10000 );\n\n\t// update the capabilities file\n\tupdateCapabilities();\n\n\t// events\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\twindow.addEventListener( 'hashchange', () => location.reload() );\n\n}\n\nasync function updateCapabilities() {\n\n\t// load the capabilities file\n\tcapabilities = await new WMTSCapabilitiesLoader().loadAsync( url );\n\n\t// use a default overlay\n\tlet defaultLayer = 'MODIS_Terra_CorrectedReflectance_TrueColor';\n\n\tif ( ! capabilities.layers.find( l => l.identifier === defaultLayer ) ) {\n\n\t\tdefaultLayer = capabilities.layers.find( l =>\n\t\t\tl.tileMatrixSets.some( tms => compatibleCRSList.includes( tms.supportedCRS ) )\n\t\t).identifier;\n\n\t}\n\n\t// set up the parameters\n\tparams = {\n\t\tlayer: defaultLayer,\n\t\tstyle: null,\n\t\ttileMatrixSet: null,\n\t\tplanar: false,\n\t\tdimensions: {},\n\t};\n\n\trebuildGUI();\n\trebuildTiles();\n\n}\n\nfunction rebuildGUI() {\n\n\tif ( gui ) {\n\n\t\tgui.destroy();\n\n\t}\n\n\tparams.style = null;\n\tparams.tileMatrixSet = null;\n\tparams.dimensions = {};\n\n\t// initialize the layer settings\n\tconst layer = capabilities.layers.find( l => l.identifier === params.layer );\n\tparams.style = layer.styles.find( s => s.isDefault )?.identifier || layer.styles[ 0 ].identifier;\n\tconst compatibleTileMatrixSet = layer.tileMatrixSets.find( tms => compatibleCRSList.includes( tms.supportedCRS ) );\n\tparams.tileMatrixSet = compatibleTileMatrixSet ? compatibleTileMatrixSet.identifier : layer.tileMatrixSets[ 0 ].identifier;\n\n\t// update the ui\n\tconst abstract = capabilities.serviceIdentification.abstract;\n\tdocument.getElementById( 'info' ).innerHTML =\n\t\t'<b>' + capabilities.serviceIdentification.title + '</b>' + ( abstract ? '<br/>' + abstract : '' ) +\n\t\t'<br/>' + layer.title;\n\n\n\tgui = new GUI();\n\tgui.add( params, 'planar' ).onChange( rebuildTiles );\n\tgui.add( params, 'layer', capabilities.layers.map( l => l.identifier ) ).onChange( () => {\n\n\t\trebuildGUI( url );\n\t\trebuildTiles();\n\n\t} );\n\tgui.add( params, 'tileMatrixSet', layer.tileMatrixSets.map( tms => tms.identifier ) ).onChange( rebuildTiles );\n\tgui.add( params, 'style', layer.styles.map( s => s.identifier ) ).onChange( rebuildTiles );\n\n\t// create the UI for dimensions\n\tfor ( const key in layer.dimensions ) {\n\n\t\tconst dim = layer.dimensions[ key ];\n\t\tparams.dimensions[ dim.identifier ] = layer.dimensions[ key ].defaultValue;\n\n\t\t// Note that NASA GIBS uses a custom notation for time\n\t\t// https://www.earthdata.nasa.gov/news/blog/wmts-time-dimensions-restful-access\n\t\tlet values = dim.values;\n\t\tif ( dim.identifier === 'Time' && /gibs.earthdata/.test( url ) ) {\n\n\t\t\tvalues = values.flatMap( v => {\n\n\t\t\t\tconst tokens = v.split( /\\//g );\n\t\t\t\ttokens.pop();\n\t\t\t\treturn tokens;\n\n\t\t\t} );\n\n\t\t\tif ( /^MODIS_Terra/.test( params.layer ) ) {\n\n\t\t\t\t// NOTE: this is a good full-ranged time to use with a full set of data typically used by GIBs for demos\n\t\t\t\tvalues.push( '2013-06-16' );\n\t\t\t\tparams.dimensions[ dim.identifier ] = '2013-06-16';\n\n\t\t\t}\n\n\t\t}\n\n\t\tgui.add( params.dimensions, dim.identifier, values ).onChange( rebuildTiles );\n\n\t}\n\n}\n\nfunction rebuildTiles() {\n\n\tif ( tiles ) {\n\n\t\ttiles.dispose();\n\n\t}\n\n\tif ( controls ) {\n\n\t\tcontrols.dispose();\n\t\tcontrols = null;\n\n\t}\n\n\t// tiles\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new TilesFadePlugin() );\n\ttiles.registerPlugin( new UpdateOnChangePlugin() );\n\ttiles.registerPlugin( new WMTSTilesPlugin( {\n\t\tshape: params.planar ? 'planar' : 'ellipsoid',\n\t\tcenter: true,\n\t\tcapabilities,\n\t\t...params,\n\t} ) );\n\n\ttiles.setCamera( camera );\n\tscene.add( tiles.group );\n\n\tif ( params.planar ) {\n\n\t\t// create the controls\n\t\tcontrols = new EnvironmentControls( scene, camera, renderer.domElement );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.minDistance = 1e-4;\n\t\tcontrols.maxDistance = 5;\n\t\tcontrols.cameraRadius = 0;\n\t\tcontrols.fallbackPlane.normal.set( 0, 0, 1 );\n\t\tcontrols.up.set( 0, 0, 1 );\n\t\tcontrols.camera.position.set( 0, 0, 2 );\n\t\tcontrols.camera.quaternion.identity();\n\n\t\t// reset the camera\n\t\tcamera.near = 1e-4;\n\t\tcamera.far = 10;\n\t\tcamera.updateProjectionMatrix();\n\n\t} else {\n\n\t\t// init tiles\n\t\ttiles.group.rotation.x = - Math.PI / 2;\n\n\t\t// create the controls\n\t\tcontrols = new GlobeControls( scene, camera, renderer.domElement );\n\t\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\t\tcontrols.enableDamping = true;\n\t\tcontrols.camera.position.set( 0, 0, 1.75 * 1e7 );\n\t\tcontrols.camera.quaternion.identity();\n\t\tcontrols.minDistance = 150;\n\n\t}\n\n}\n\nfunction onWindowResize() {\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\tif ( controls ) {\n\n\t\tcontrols.update();\n\t\tcamera.updateMatrixWorld();\n\n\t}\n\n\tif ( tiles ) {\n\n\t\ttiles.setCamera( camera );\n\t\ttiles.setResolutionFromRenderer( camera, renderer );\n\t\ttiles.update();\n\n\t}\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["EQUATOR_CIRCUMFERENCE","WGS84_RADIUS","mercatorProjection","ProjectionScheme","isCRS84","crs","isEPSG4326","isWebMercator","parseTuple","tuple","v","correctTupleOrder","correctTupleUnits","MathUtils","tupleToRadians","WMTSCapabilitiesLoader","LoaderBase","buffer","str","xml","contents","tileMatrixSets","getChildrenByTag","el","parseTileMatrixSet","layers","parseLayer","serviceIdentification","parseServiceIdentification","layer","key","tms","title","abstract","_a","serviceType","serviceTypeVersion","identifier","format","resourceUrls","parseResourceUrl","tileMatrixSetLinks","styles","parseStyle","dimensions","parseDimension","boundingBox","parseBoundingBox","template","resourceType","uom","defaultValue","current","_b","values","lowerCorner","upperCorner","isDefault","supportedCRS","tileMatrices","i","tm","parseTileMatrix","pixelSpan","groundWidth","groundHeight","bottomRightCorner","tileWidth","tileHeight","matrixWidth","matrixHeight","scaleDenominator","topLeftCorner","tag","c","url","compatibleCRSList","controls","scene","renderer","tiles","camera","gui","params","capabilities","init","render","WebGLRenderer","Scene","PerspectiveCamera","updateCapabilities","onWindowResize","defaultLayer","l","rebuildGUI","rebuildTiles","s","compatibleTileMatrixSet","GUI","dim","tokens","TilesRenderer","TilesFadePlugin","UpdateOnChangePlugin","WMTSTilesPlugin","EnvironmentControls","GlobeControls","aspect"],"mappings":"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"}