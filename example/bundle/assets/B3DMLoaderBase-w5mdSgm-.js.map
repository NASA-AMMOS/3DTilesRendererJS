{"version":3,"file":"B3DMLoaderBase-w5mdSgm-.js","sources":["../../../src/core/renderer/loaders/B3DMLoaderBase.js"],"sourcesContent":["// B3DM File Format\n// https://github.com/CesiumGS/3d-tiles/blob/master/specification/TileFormats/Batched3DModel/README.md\n\nimport { BatchTable } from '../utilities/BatchTable.js';\nimport { FeatureTable } from '../utilities/FeatureTable.js';\nimport { LoaderBase } from './LoaderBase.js';\nimport { readMagicBytes } from '../utilities/LoaderUtils.js';\n\nexport class B3DMLoaderBase extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\t// TODO: this should be able to take a uint8array with an offset and length\n\t\tconst dataView = new DataView( buffer );\n\n\t\t// 28-byte header\n\n\t\t// 4 bytes\n\t\tconst magic = readMagicBytes( dataView );\n\n\t\tconsole.assert( magic === 'b3dm' );\n\n\t\t// 4 bytes\n\t\tconst version = dataView.getUint32( 4, true );\n\n\t\tconsole.assert( version === 1 );\n\n\t\t// 4 bytes\n\t\tconst byteLength = dataView.getUint32( 8, true );\n\n\t\tconsole.assert( byteLength === buffer.byteLength );\n\n\t\t// 4 bytes\n\t\tconst featureTableJSONByteLength = dataView.getUint32( 12, true );\n\n\t\t// 4 bytes\n\t\tconst featureTableBinaryByteLength = dataView.getUint32( 16, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableJSONByteLength = dataView.getUint32( 20, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableBinaryByteLength = dataView.getUint32( 24, true );\n\n\t\t// Feature Table\n\t\tconst featureTableStart = 28;\n\t\tconst featureTableBuffer = buffer.slice(\n\t\t\tfeatureTableStart,\n\t\t\tfeatureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength,\n\t\t);\n\t\tconst featureTable = new FeatureTable(\n\t\t\tfeatureTableBuffer,\n\t\t\t0,\n\t\t\tfeatureTableJSONByteLength,\n\t\t\tfeatureTableBinaryByteLength,\n\t\t);\n\n\t\t// Batch Table\n\t\tconst batchTableStart = featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength;\n\t\tconst batchTableBuffer = buffer.slice(\n\t\t\tbatchTableStart,\n\t\t\tbatchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength,\n\t\t);\n\t\tconst batchTable = new BatchTable(\n\t\t\tbatchTableBuffer,\n\t\t\tfeatureTable.getData( 'BATCH_LENGTH' ),\n\t\t\t0,\n\t\t\tbatchTableJSONByteLength,\n\t\t\tbatchTableBinaryByteLength,\n\t\t);\n\n\t\tconst glbStart = batchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength;\n\t\tconst glbBytes = new Uint8Array( buffer, glbStart, byteLength - glbStart );\n\n\t\treturn {\n\t\t\tversion,\n\t\t\tfeatureTable,\n\t\t\tbatchTable,\n\t\t\tglbBytes,\n\t\t};\n\n\t}\n\n}\n\n"],"names":["B3DMLoaderBase","LoaderBase","buffer","dataView","magic","readMagicBytes","version","byteLength","featureTableJSONByteLength","featureTableBinaryByteLength","batchTableJSONByteLength","batchTableBinaryByteLength","featureTableStart","featureTableBuffer","featureTable","FeatureTable","batchTableStart","batchTableBuffer","batchTable","BatchTable","glbStart","glbBytes"],"mappings":"6DAQO,MAAMA,UAAuBC,CAAW,CAE9C,MAAOC,EAAS,CAGf,MAAMC,EAAW,IAAI,SAAUD,CAAM,EAK/BE,EAAQC,EAAgBF,CAAQ,EAEtC,QAAQ,OAAQC,IAAU,MAAM,EAGhC,MAAME,EAAUH,EAAS,UAAW,EAAG,EAAI,EAE3C,QAAQ,OAAQG,IAAY,CAAC,EAG7B,MAAMC,EAAaJ,EAAS,UAAW,EAAG,EAAI,EAE9C,QAAQ,OAAQI,IAAeL,EAAO,UAAU,EAGhD,MAAMM,EAA6BL,EAAS,UAAW,GAAI,EAAI,EAGzDM,EAA+BN,EAAS,UAAW,GAAI,EAAI,EAG3DO,EAA2BP,EAAS,UAAW,GAAI,EAAI,EAGvDQ,EAA6BR,EAAS,UAAW,GAAI,EAAI,EAGzDS,EAAoB,GACpBC,EAAqBX,EAAO,MACjCU,EACAA,EAAoBJ,EAA6BC,CACpD,EACQK,EAAe,IAAIC,EACxBF,EACA,EACAL,EACAC,CACH,EAGQO,EAAkBJ,EAAoBJ,EAA6BC,EACnEQ,EAAmBf,EAAO,MAC/Bc,EACAA,EAAkBN,EAA2BC,CAChD,EACQO,EAAa,IAAIC,EACtBF,EACAH,EAAa,QAAS,cAAc,EACpC,EACAJ,EACAC,CACH,EAEQS,EAAWJ,EAAkBN,EAA2BC,EACxDU,EAAW,IAAI,WAAYnB,EAAQkB,EAAUb,EAAaa,CAAQ,EAExE,MAAO,CACN,QAAAd,EACA,aAAAQ,EACA,WAAAI,EACA,SAAAG,CACH,CAEC,CAED"}