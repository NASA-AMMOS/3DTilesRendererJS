{"version":3,"file":"CameraViewTransition-Cm1nEoKA.js","sources":["../../../src/r3f/components/CompassGizmo.jsx","../../../src/r3f/components/CameraTransition.jsx","../../r3f/components/TilesLoadingBar.jsx","../../r3f/components/makeRotateAroundPoint.js","../../r3f/components/CameraViewTransition.jsx"],"sourcesContent":["import { createPortal, useFrame, useThree } from '@react-three/fiber';\nimport { useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { BackSide, Matrix4, OrthographicCamera, Ray, Scene, Vector3 } from 'three';\nimport { EllipsoidContext } from './TilesRenderer.jsx';\n\n// Based in part on @pmndrs/drei's Gizmo component\n\nconst _vec = /*@__PURE__*/ new Vector3();\nconst _axis = /*@__PURE__*/ new Vector3();\nconst _pos = /*@__PURE__*/ new Vector3();\nconst _matrix = /*@__PURE__*/ new Matrix4();\nconst _enuMatrix = /*@__PURE__*/ new Matrix4();\nconst _ray = /*@__PURE__*/ new Ray();\nconst _cart = {};\n\n// Returns the \"focus\" point that the camera is facing based on the closest point to the ellipsoid.\n// Used for determining the compass orientation.\nfunction getCameraFocusPoint( camera, ellipsoid, tilesGroup, target ) {\n\n\t// get ray in globe coordinate frame\n\t_ray.origin.copy( camera.position );\n\t_ray.direction.set( 0, 0, - 1 ).transformDirection( camera.matrixWorld );\n\t_ray.applyMatrix4( tilesGroup.matrixWorldInverse );\n\n\t// get the closest point to the ray on the globe in the global coordinate frame\n\tellipsoid.closestPointToRayEstimate( _ray, _pos );\n\t_pos.applyMatrix4( tilesGroup.matrixWorld );\n\n\t// get ortho camera info\n\t_axis.set( 0, 0, - 1 ).transformDirection( camera.matrixWorld );\n\n\t// ensure we move the camera exactly along the forward vector to avoid shifting\n\t// the camera in other directions due to floating point error\n\tconst dist = _pos.sub( camera.position ).dot( _axis );\n\ttarget.copy( camera.position ).addScaledVector( _axis, dist );\n\treturn target;\n\n}\n\n// Renders the portal with an orthographic camera\nfunction RenderPortal( props ) {\n\n\tconst { defaultScene, defaultCamera, overrideRenderLoop = true, renderPriority = 1 } = props;\n\tconst camera = useMemo( () => new OrthographicCamera(), [] );\n\tconst [ set, size, gl, scene ] = useThree( state => [ state.set, state.size, state.gl, state.scene ] );\n\tuseEffect( () => {\n\n\t\tset( { camera } );\n\n\t}, [ set, camera ] );\n\n\tuseEffect( () => {\n\n\t\tcamera.left = - size.width / 2;\n\t\tcamera.right = size.width / 2;\n\t\tcamera.top = size.height / 2;\n\t\tcamera.bottom = - size.height / 2;\n\t\tcamera.near = 0;\n\t\tcamera.far = 2000;\n\t\tcamera.position.z = camera.far / 2;\n\t\tcamera.updateProjectionMatrix();\n\n\t}, [ camera, size ] );\n\n\tuseFrame( () => {\n\n\t\tif ( overrideRenderLoop ) {\n\n\t\t\tgl.render( defaultScene, defaultCamera );\n\n\t\t}\n\n\t\tconst currentAutoClear = gl.autoClear;\n\t\tgl.autoClear = false;\n\n\t\tgl.clearDepth();\n\t\tgl.render( scene, camera );\n\n\t\tgl.autoClear = currentAutoClear;\n\n\t}, renderPriority );\n\n}\n\n// generates an extruded box geometry\nfunction TriangleGeometry() {\n\n\tconst ref = useRef();\n\tuseEffect( () => {\n\n\t\tconst geometry = ref.current;\n\t\tconst position = geometry.attributes.position;\n\t\tfor ( let i = 0, l = position.count; i < l; i ++ ) {\n\n\t\t\t_vec.fromBufferAttribute( position, i );\n\t\t\tif ( _vec.y > 0 ) {\n\n\t\t\t\t_vec.x = 0;\n\t\t\t\tposition.setXYZ( i, ..._vec );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\treturn <boxGeometry ref={ ref } />;\n\n}\n\n// renders a typical compass graphic with red north triangle, white south, and a tinted circular background\nfunction CompassGraphic( { northColor = 0xEF5350, southColor = 0xFFFFFF } ) {\n\n\tconst [ lightTarget, setLightTarget ] = useState();\n\tconst groupRef = useRef();\n\tuseEffect( () => {\n\n\t\tsetLightTarget( groupRef.current );\n\n\t}, [] );\n\n\treturn (\n\t\t<group scale={ 0.5 } ref={ groupRef }>\n\n\t\t\t{/* Lights */}\n\t\t\t<ambientLight intensity={ 1 } />\n\t\t\t<directionalLight position={ [ 0, 2, 3 ] } intensity={ 3 } target={ lightTarget } />\n\t\t\t<directionalLight position={ [ 0, - 2, - 3 ] } intensity={ 3 } target={ lightTarget } />\n\n\t\t\t{/* Background */}\n\t\t\t<mesh>\n\t\t\t\t<sphereGeometry />\n\t\t\t\t<meshBasicMaterial color={ 0 } opacity={ 0.3 } transparent={ true } side={ BackSide } />\n\t\t\t</mesh>\n\n\t\t\t{/* Compass shape */}\n\t\t\t<group scale={ [ 0.5, 1, 0.15 ] }>\n\t\t\t\t<mesh position-y={ 0.5 }>\n\t\t\t\t\t<TriangleGeometry />\n\t\t\t\t\t<meshStandardMaterial color={ northColor } />\n\t\t\t\t</mesh>\n\t\t\t\t<mesh position-y={ - 0.5 } rotation-x={ Math.PI }>\n\t\t\t\t\t<TriangleGeometry />\n\t\t\t\t\t<meshStandardMaterial color={ southColor } />\n\t\t\t\t</mesh>\n\t\t\t</group>\n\t\t</group>\n\t);\n\n}\n\nexport function CompassGizmo( { children, overrideRenderLoop, mode = '3d', margin = 10, scale = 35, visible = true, ...rest } ) {\n\n\tconst [ defaultCamera, defaultScene, size ] = useThree( state => [ state.camera, state.scene, state.size ] );\n\tconst ellipsoidContext = useContext( EllipsoidContext );\n\tconst groupRef = useRef( null );\n\tconst scene = useMemo( () => {\n\n\t\treturn new Scene();\n\n\t}, [] );\n\n\tlet marginX, marginY;\n\tif ( Array.isArray( margin ) ) {\n\n\t\tmarginX = margin[ 0 ];\n\t\tmarginY = margin[ 1 ];\n\n\t} else {\n\n\t\tmarginX = margin;\n\t\tmarginY = margin;\n\n\t}\n\n\tuseFrame( () => {\n\n\t\tconst ellipsoid = ellipsoidContext?.ellipsoid;\n\t\tconst frame = ellipsoidContext?.frame;\n\n\t\tif ( ( ! ellipsoid || ! frame ) || groupRef.current === null ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst group = groupRef.current;\n\n\t\t// get the ENU frame in world space\n\t\tgetCameraFocusPoint( defaultCamera, ellipsoid, frame, _pos ).applyMatrix4( frame.matrixWorldInverse );\n\t\tellipsoid.getPositionToCartographic( _pos, _cart );\n\n\t\tellipsoid\n\t\t\t.getEastNorthUpFrame( _cart.lat, _cart.lon, 0, _enuMatrix )\n\t\t\t.premultiply( frame.matrixWorld );\n\n\t\t// get the camera orientation in the local ENU frame\n\t\t_enuMatrix.invert();\n\t\t_matrix.copy( defaultCamera.matrixWorld ).premultiply( _enuMatrix );\n\n\t\tif ( mode.toLowerCase() === '3d' ) {\n\n\t\t\tgroup.quaternion.setFromRotationMatrix( _matrix ).invert();\n\n\t\t} else {\n\n\t\t\t// get the projected facing direction of the camera\n\t\t\t_vec.set( 0, 1, 0 ).transformDirection( _matrix ).normalize();\n\t\t\t_vec.z = 0;\n\t\t\t_vec.normalize();\n\n\t\t\tif ( _vec.length() === 0 ) {\n\n\t\t\t\t// if we're looking exactly top-down\n\t\t\t\tgroup.quaternion.identity();\n\n\t\t\t} else {\n\n\t\t\t\t// compute the 2d looking direction\n\t\t\t\tconst angle = _axis.set( 0, 1, 0 ).angleTo( _vec );\n\t\t\t\t_axis.cross( _vec ).normalize();\n\t\t\t\tgroup.quaternion.setFromAxisAngle( _axis, - angle );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\t// default to the compass graphic\n\tif ( ! children ) {\n\n\t\tchildren = <CompassGraphic />;\n\n\t}\n\n\t// remove the portal rendering if not present\n\tif ( ! visible ) {\n\n\t\treturn null;\n\n\t}\n\n\treturn (\n\t\tcreatePortal(\n\t\t\t<>\n\t\t\t\t<group\n\t\t\t\t\tref={ groupRef }\n\t\t\t\t\tscale={ scale }\n\t\t\t\t\tposition={ [\n\t\t\t\t\t\tsize.width / 2 - marginX - scale / 2,\n\t\t\t\t\t\t- size.height / 2 + marginY + scale / 2,\n\t\t\t\t\t\t0,\n\t\t\t\t\t] }\n\n\t\t\t\t\t{ ...rest }\n\t\t\t\t>{ children }</group>\n\t\t\t\t<RenderPortal\n\t\t\t\t\tdefaultCamera={ defaultCamera }\n\t\t\t\t\tdefaultScene={ defaultScene }\n\t\t\t\t\toverrideRenderLoop={ overrideRenderLoop }\n\t\t\t\t\trenderPriority={ 10 }\n\t\t\t\t/>\n\t\t\t</>,\n\t\t\tscene,\n\t\t\t{ events: { priority: 10 } },\n\t\t)\n\t);\n\n}\n","import { forwardRef, useEffect, useMemo } from 'react';\nimport { useFrame, useThree } from '@react-three/fiber';\nimport { CameraTransitionManager } from '3d-tiles-renderer/three';\nimport { useDeepOptions } from '../utilities/useOptions.js';\nimport { useApplyRefs } from '../utilities/useApplyRefs.js';\n\nexport const CameraTransition = forwardRef( function CameraTransition( props, ref ) {\n\n\tconst {\n\t\tmode = 'perspective',\n\t\tonBeforeToggle,\n\t\tperspectiveCamera,\n\t\torthographicCamera,\n\t\t...options\n\t} = props;\n\n\tconst [ set, get, invalidate, controls, camera, size ] = useThree( state => [ state.set, state.get, state.invalidate, state.controls, state.camera, state.size ] );\n\n\t// create the manager\n\tconst manager = useMemo( () => {\n\n\t\tconst manager = new CameraTransitionManager();\n\t\tmanager.autoSync = false;\n\n\t\tif ( camera.isOrthographicCamera ) {\n\n\t\t\tmanager.orthographicCamera.copy( camera );\n\t\t\tmanager.mode = 'orthographic';\n\n\t\t} else {\n\n\t\t\tmanager.perspectiveCamera.copy( camera );\n\n\t\t}\n\n\t\tmanager.syncCameras();\n\t\tmanager.mode = mode;\n\n\t\treturn manager;\n\n\t\t// only respect the camera initially so the default camera settings are automatically used\n\n\t}, [] ); // eslint-disable-line react-hooks/exhaustive-deps\n\n\tuseEffect( () => {\n\n\t\tconst { perspectiveCamera, orthographicCamera } = manager;\n\t\tconst aspect = size.width / size.height;\n\t\tperspectiveCamera.aspect = aspect;\n\t\tperspectiveCamera.updateProjectionMatrix();\n\n\t\torthographicCamera.left = - orthographicCamera.top * aspect;\n\t\torthographicCamera.right = - orthographicCamera.left;\n\t\tperspectiveCamera.updateProjectionMatrix();\n\n\t}, [ manager, size ] );\n\n\t// assign ref\n\tuseApplyRefs( manager, ref );\n\n\t// set the camera\n\tuseEffect( () => {\n\n\t\tconst cameraCallback = ( { camera } ) => {\n\n\t\t\tset( () => ( { camera } ) );\n\n\t\t};\n\n\t\tset( () => ( { camera: manager.camera } ) );\n\t\tmanager.addEventListener( 'camera-change', cameraCallback );\n\t\treturn () => {\n\n\t\t\tmanager.removeEventListener( 'camera-change', cameraCallback );\n\n\t\t};\n\n\t}, [ manager, set ] );\n\n\t// assign cameras\n\tuseEffect( () => {\n\n\t\tconst oldPerspectiveCamera = manager.perspectiveCamera;\n\t\tconst oldOrthographicCamera = manager.orthographicCamera;\n\t\tmanager.perspectiveCamera = perspectiveCamera || oldPerspectiveCamera;\n\t\tmanager.orthographicCamera = orthographicCamera || oldOrthographicCamera;\n\n\t\tset( () => ( { camera: manager.camera } ) );\n\n\t\treturn () => {\n\n\t\t\tmanager.perspectiveCamera = oldPerspectiveCamera;\n\t\t\tmanager.orthographicCamera = oldOrthographicCamera;\n\n\t\t};\n\n\t}, [ perspectiveCamera, orthographicCamera, manager, set ] );\n\n\t// toggle\n\tuseEffect( () => {\n\n\t\tif ( mode !== manager.mode ) {\n\n\t\t\t// calculate the camera being toggled to. Because \"toggle\" has not yet been\n\t\t\t// called this will select the camera that is being transitioned to.\n\t\t\tconst targetCamera = mode === 'orthographic' ? manager.orthographicCamera : manager.perspectiveCamera;\n\t\t\tif ( onBeforeToggle ) {\n\n\t\t\t\tonBeforeToggle( manager, targetCamera );\n\n\t\t\t} else if ( controls && controls.isEnvironmentControls ) {\n\n\t\t\t\tcontrols.getPivotPoint( manager.fixedPoint );\n\t\t\t\tmanager.syncCameras();\n\n\t\t\t\tcontrols.adjustCamera( manager.perspectiveCamera );\n\t\t\t\tcontrols.adjustCamera( manager.orthographicCamera );\n\n\t\t\t} else {\n\n\t\t\t\tmanager.fixedPoint\n\t\t\t\t\t.set( 0, 0, - 1 )\n\t\t\t\t\t.transformDirection( manager.camera.matrixWorld )\n\t\t\t\t\t.multiplyScalar( 50 )\n\t\t\t\t\t.add( manager.camera.position );\n\t\t\t\tmanager.syncCameras();\n\n\t\t\t}\n\n\t\t\tmanager.toggle();\n\t\t\tinvalidate();\n\n\t\t}\n\n\t}, [ mode, manager, invalidate, controls, onBeforeToggle ] );\n\n\t// rerender the frame when the transition animates\n\tuseEffect( () => {\n\n\t\tconst callback = () => invalidate();\n\t\tmanager.addEventListener( 'transition-start', callback );\n\t\tmanager.addEventListener( 'change', callback );\n\t\tmanager.addEventListener( 'transition-end', callback );\n\n\t\treturn () => {\n\n\t\t\tmanager.removeEventListener( 'transition-start', callback );\n\t\t\tmanager.removeEventListener( 'change', callback );\n\t\t\tmanager.removeEventListener( 'transition-end', callback );\n\n\t\t};\n\n\t}, [ manager, invalidate ] );\n\n\tuseDeepOptions( manager, options );\n\n\t// update animation\n\tuseFrame( () => {\n\n\t\tmanager.update();\n\t\tif ( controls ) {\n\n\t\t\tcontrols.enabled = ! manager.animating;\n\n\t\t}\n\n\t\t// ensure the orthographic camera size is resized correctly if the user is not\n\t\t// providing their own camera.\n\t\tconst { camera, size } = get();\n\t\tif ( ! orthographicCamera && camera === manager.orthographicCamera ) {\n\n\t\t\tconst aspect = size.width / size.height;\n\t\t\tconst camera = manager.orthographicCamera;\n\t\t\tif ( aspect !== camera.right ) {\n\n\t\t\t\tcamera.bottom = - 1;\n\t\t\t\tcamera.top = 1;\n\t\t\t\tcamera.left = - aspect;\n\t\t\t\tcamera.right = aspect;\n\t\t\t\tcamera.updateProjectionMatrix();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( manager.animating ) {\n\n\t\t\tinvalidate();\n\n\t\t}\n\n\t}, - 1 );\n\n} );\n","import { CanvasDOMOverlay, TilesRendererContext } from '3d-tiles-renderer/r3f';\nimport { useFrame } from '@react-three/fiber';\nimport { useContext, useRef } from 'react';\n\nexport function TilesLoadingBar( props ) {\n\n\tconst tiles = useContext( TilesRendererContext );\n\tconst domRef = useRef();\n\n\tuseFrame( () => {\n\n\t\tconst element = domRef.current;\n\t\tif ( element && tiles ) {\n\n\t\t\telement.style.width = `${ tiles.loadProgress * 100 }%`;\n\t\t\telement.style.opacity = tiles.loadProgress === 1 ? 0 : 1;\n\t\t\telement.style.transition = tiles.loadProgress === 1 ? 'opacity 0.5s linear' : '';\n\n\t\t}\n\n\t} );\n\n\treturn <CanvasDOMOverlay\n\t\tref={ domRef }\n\t\tstyle={ {\n\t\t\tposition: 'absolute',\n\t\t\tleft: 0,\n\t\t\tbottom: 0,\n\t\t\theight: '2px',\n\t\t\tbackground: 'white',\n\t\t\t// transition: 'opacity 0.2s linear',\n\t\t\topacity: 0,\n\t\t\twidth: '100%',\n\t\t} }\n\t/>;\n\n}\n","import { Matrix4 } from 'three';\n\n// helper function for constructing a matrix for rotating around a point\nconst _matrix = new Matrix4();\nexport function makeRotateAroundPoint( point, quat, target ) {\n\n\ttarget.makeTranslation( - point.x, - point.y, - point.z );\n\n\t_matrix.makeRotationFromQuaternion( quat );\n\ttarget.premultiply( _matrix );\n\n\t_matrix.makeTranslation( point.x, point.y, point.z );\n\ttarget.premultiply( _matrix );\n\n\treturn target;\n\n}\n","import { forwardRef, useCallback, useContext } from 'react';\nimport { CameraTransition, TilesRendererContext } from '3d-tiles-renderer/r3f';\nimport { useThree } from '@react-three/fiber';\nimport { Matrix4, Quaternion, Raycaster, Vector3, MathUtils } from 'three';\nimport { makeRotateAroundPoint } from './makeRotateAroundPoint.js';\n\nconst raycaster = /* @__PURE__ */ new Raycaster();\nconst downVector = /* @__PURE__ */ new Vector3();\nconst axis = /* @__PURE__ */ new Vector3();\nconst quat = /* @__PURE__ */ new Quaternion();\nconst matrix = /* @__PURE__ */ new Matrix4();\n\nexport const CameraViewTransition = forwardRef( function CameraViewTransition( props, ref ) {\n\n\tconst tiles = useContext( TilesRendererContext );\n\tconst controls = useThree( ( { controls } ) => controls );\n\tconst scene = useThree( ( { scene } ) => scene );\n\n\tconst onBeforeToggleCallback = useCallback( ( manager, targetCamera ) => {\n\n\t\tif ( ! manager.animating ) {\n\n\t\t\ttargetCamera.updateMatrixWorld();\n\n\t\t\t// Force the fixed point to be in the camera center\n\t\t\traycaster.ray.direction.set( 0, 0, - 1 ).transformDirection( manager.camera.matrixWorld );\n\t\t\traycaster.ray.origin.setFromMatrixPosition( manager.camera.matrixWorld );\n\n\t\t\tconst hit = raycaster.intersectObject( scene )[ 0 ];\n\t\t\tif ( hit ) {\n\n\t\t\t\tmanager.fixedPoint.copy( hit.point );\n\t\t\t\tmanager.syncCameras();\n\n\t\t\t} else {\n\n\t\t\t\tcontrols.getPivotPoint( manager.fixedPoint );\n\t\t\t\tmanager.syncCameras();\n\n\t\t\t}\n\n\t\t\t// get the normal at the target point\n\t\t\tif ( tiles ) {\n\n\t\t\t\tmatrix.copy( tiles.group.matrixWorld ).invert();\n\t\t\t\tdownVector.copy( manager.fixedPoint ).applyMatrix4( matrix );\n\t\t\t\ttiles.ellipsoid.getPositionToNormal( downVector, downVector ).multiplyScalar( - 1 ).transformDirection( tiles.group.matrixWorld );\n\n\t\t\t} else {\n\n\t\t\t\tdownVector.set( 0, - 1, 0 );\n\n\t\t\t}\n\n\t\t\tif ( targetCamera.isOrthographicCamera ) {\n\n\t\t\t\t// transition the camera view to the top down while retaining same general pointing direction\n\t\t\t\tconst angle = downVector.angleTo( raycaster.ray.direction );\n\t\t\t\taxis.crossVectors( downVector, raycaster.ray.direction );\n\t\t\t\tquat.setFromAxisAngle( axis, - angle ).normalize();\n\n\t\t\t\tmakeRotateAroundPoint( manager.fixedPoint, quat, matrix );\n\t\t\t\ttargetCamera.matrixWorld.premultiply( matrix );\n\t\t\t\ttargetCamera.matrixWorld.decompose(\n\t\t\t\t\ttargetCamera.position,\n\t\t\t\t\ttargetCamera.quaternion,\n\t\t\t\t\ttargetCamera.scale,\n\t\t\t\t);\n\n\t\t\t\t// TODO: it's possible if the fixed point isn't in the middle of the screen that\n\t\t\t\t// the \"down\" vector isn't well aligned with the ellipsoid normal. Trying to\n\t\t\t\t// find the middle point again after rotation and then adjusting the camera again\n\t\t\t\t// could help this?\n\n\t\t\t} else {\n\n\t\t\t\t// TODO: expose _isNearControls in a better way\n\t\t\t\t// don't tilt the camera if we're outside the \"near controls\" behavior so we\n\t\t\t\t// don't rotate the camera while out in space\n\t\t\t\tif ( ! controls.isGlobeControls || controls._isNearControls() ) {\n\n\t\t\t\t\t// tilt the perspective down slightly\n\t\t\t\t\tlet angle = downVector.angleTo( raycaster.ray.direction );\n\t\t\t\t\tangle = Math.max( 65 * MathUtils.DEG2RAD - angle, 0 );\n\n\t\t\t\t\taxis.set( 1, 0, 0 ).transformDirection( targetCamera.matrixWorld );\n\t\t\t\t\tquat.setFromAxisAngle( axis, angle ).normalize();\n\n\t\t\t\t\tmakeRotateAroundPoint( manager.fixedPoint, quat, matrix );\n\t\t\t\t\ttargetCamera.matrixWorld.premultiply( matrix );\n\t\t\t\t\ttargetCamera.matrixWorld.decompose(\n\t\t\t\t\t\ttargetCamera.position,\n\t\t\t\t\t\ttargetCamera.quaternion,\n\t\t\t\t\t\ttargetCamera.scale,\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tcontrols.adjustCamera( manager.perspectiveCamera );\n\t\tcontrols.adjustCamera( manager.orthographicCamera );\n\n\t}, [ tiles, controls, scene ] );\n\n\treturn <CameraTransition { ...props } ref={ ref } onBeforeToggle={ onBeforeToggleCallback } />;\n\n} );\n"],"names":["_vec","Vector3","_axis","_pos","_matrix","Matrix4","_enuMatrix","_ray","Ray","_cart","getCameraFocusPoint","camera","ellipsoid","tilesGroup","target","dist","RenderPortal","props","defaultScene","defaultCamera","overrideRenderLoop","renderPriority","useMemo","OrthographicCamera","set","size","gl","scene","useThree","state","useEffect","useFrame","currentAutoClear","TriangleGeometry","ref","useRef","position","i","l","jsx","CompassGraphic","northColor","southColor","lightTarget","setLightTarget","useState","groupRef","jsxs","BackSide","CompassGizmo","children","mode","margin","scale","visible","rest","ellipsoidContext","useContext","EllipsoidContext","Scene","marginX","marginY","frame","group","angle","createPortal","Fragment","CameraTransition","forwardRef","onBeforeToggle","perspectiveCamera","orthographicCamera","options","get","invalidate","controls","manager","CameraTransitionManager","aspect","useApplyRefs","cameraCallback","oldPerspectiveCamera","oldOrthographicCamera","targetCamera","callback","useDeepOptions","TilesLoadingBar","tiles","TilesRendererContext","domRef","element","CanvasDOMOverlay","makeRotateAroundPoint","point","quat","raycaster","Raycaster","downVector","axis","Quaternion","matrix","CameraViewTransition","onBeforeToggleCallback","useCallback","hit","MathUtils"],"mappings":"+TAOA,MAAMA,MAAyBC,EACzBC,MAA0BD,EAC1BE,MAAyBF,EACzBG,MAA4BC,EAC5BC,MAA+BD,EAC/BE,MAAyBC,EACzBC,EAAQ,CAAA,EAId,SAASC,GAAqBC,EAAQC,EAAWC,EAAYC,EAAS,CAGrEP,EAAK,OAAO,KAAMI,EAAO,QAAS,EAClCJ,EAAK,UAAU,IAAK,EAAG,EAAG,EAAI,EAAE,mBAAoBI,EAAO,WAAY,EACvEJ,EAAK,aAAcM,EAAW,kBAAmB,EAGjDD,EAAU,0BAA2BL,EAAMJ,CAAK,EAChDA,EAAK,aAAcU,EAAW,WAAY,EAG1CX,EAAM,IAAK,EAAG,EAAG,EAAI,EAAE,mBAAoBS,EAAO,WAAY,EAI9D,MAAMI,EAAOZ,EAAK,IAAKQ,EAAO,QAAS,EAAE,IAAKT,CAAM,EACpD,OAAAY,EAAO,KAAMH,EAAO,QAAS,EAAE,gBAAiBT,EAAOa,CAAK,EACrDD,CAER,CAGA,SAASE,GAAcC,EAAQ,CAE9B,KAAM,CAAE,aAAAC,EAAc,cAAAC,EAAe,mBAAAC,EAAqB,GAAM,eAAAC,EAAiB,GAAMJ,EACjFN,EAASW,EAAAA,QAAS,IAAM,IAAIC,EAAsB,CAAA,CAAG,EACrD,CAAEC,EAAKC,EAAMC,EAAIC,CAAM,EAAIC,EAAUC,GAAS,CAAEA,EAAM,IAAKA,EAAM,KAAMA,EAAM,GAAIA,EAAM,KAAM,CAAE,EACrGC,EAAAA,UAAW,IAAM,CAEhBN,EAAK,CAAE,OAAAb,EAAS,CAEjB,EAAG,CAAEa,EAAKb,CAAO,CAAE,EAEnBmB,EAAAA,UAAW,IAAM,CAEhBnB,EAAO,KAAO,CAAEc,EAAK,MAAQ,EAC7Bd,EAAO,MAAQc,EAAK,MAAQ,EAC5Bd,EAAO,IAAMc,EAAK,OAAS,EAC3Bd,EAAO,OAAS,CAAEc,EAAK,OAAS,EAChCd,EAAO,KAAO,EACdA,EAAO,IAAM,IACbA,EAAO,SAAS,EAAIA,EAAO,IAAM,EACjCA,EAAO,uBAAA,CAER,EAAG,CAAEA,EAAQc,CAAK,CAAE,EAEpBM,EAAU,IAAM,CAEVX,GAEJM,EAAG,OAAQR,EAAcC,CAAc,EAIxC,MAAMa,EAAmBN,EAAG,UAC5BA,EAAG,UAAY,GAEfA,EAAG,WAAA,EACHA,EAAG,OAAQC,EAAOhB,CAAO,EAEzBe,EAAG,UAAYM,CAEhB,EAAGX,CAAe,CAEnB,CAGA,SAASY,GAAmB,CAE3B,MAAMC,EAAMC,EAAAA,OAAA,EACZL,OAAAA,EAAAA,UAAW,IAAM,CAGhB,MAAMM,EADWF,EAAI,QACK,WAAW,SACrC,QAAUG,EAAI,EAAGC,EAAIF,EAAS,MAAOC,EAAIC,EAAGD,IAE3CrC,EAAK,oBAAqBoC,EAAUC,CAAE,EACjCrC,EAAK,EAAI,IAEbA,EAAK,EAAI,EACToC,EAAS,OAAQC,EAAG,GAAGrC,CAAK,EAM/B,CAAE,EAEKuC,MAAC,eAAY,IAAAL,EAAY,CAEjC,CAGA,SAASM,GAAgB,CAAE,WAAAC,EAAa,SAAU,WAAAC,EAAa,UAAa,CAE3E,KAAM,CAAEC,EAAaC,CAAe,EAAIC,WAAA,EAClCC,EAAWX,EAAAA,OAAA,EACjBL,OAAAA,EAAAA,UAAW,IAAM,CAEhBc,EAAgBE,EAAS,OAAQ,CAElC,EAAG,CAAA,CAAG,EAGLC,EAAAA,KAAC,QAAA,CAAM,MAAQ,GAAM,IAAMD,EAG1B,SAAA,CAAAP,EAAAA,IAAC,eAAA,CAAa,UAAY,CAAA,CAAI,EAC9BA,EAAAA,IAAC,mBAAA,CAAiB,SAAW,CAAE,EAAG,EAAG,CAAE,EAAI,UAAY,EAAI,OAASI,CAAA,CAAc,EAClFJ,EAAAA,IAAC,mBAAA,CAAiB,SAAW,CAAE,EAAG,GAAK,EAAI,EAAI,UAAY,EAAI,OAASI,CAAA,CAAc,SAGrF,OAAA,CACA,SAAA,CAAAJ,EAAAA,IAAC,iBAAA,EAAe,EAChBA,EAAAA,IAAC,qBAAkB,MAAQ,EAAI,QAAU,GAAM,YAAc,GAAO,KAAOS,CAAA,CAAW,CAAA,EACvF,SAGC,QAAA,CAAM,MAAQ,CAAE,GAAK,EAAG,GAAK,EAC7B,SAAA,CAAAD,EAAAA,KAAC,OAAA,CAAK,aAAa,GAClB,SAAA,CAAAR,EAAAA,IAACN,EAAA,EAAiB,EAClBM,EAAAA,IAAC,uBAAA,CAAqB,MAAQE,CAAA,CAAa,CAAA,EAC5C,SACC,OAAA,CAAK,aAAa,IAAQ,aAAa,KAAK,GAC5C,SAAA,CAAAF,EAAAA,IAACN,EAAA,EAAiB,EAClBM,EAAAA,IAAC,uBAAA,CAAqB,MAAQG,CAAA,CAAa,CAAA,CAAA,CAC5C,CAAA,CAAA,CACD,CAAA,EACD,CAGF,CAEO,SAASO,GAAc,CAAE,SAAAC,EAAU,mBAAA9B,EAAoB,KAAA+B,EAAO,KAAM,OAAAC,EAAS,GAAI,MAAAC,EAAQ,GAAI,QAAAC,EAAU,GAAM,GAAGC,GAAS,CAE/H,KAAM,CAAEpC,EAAeD,EAAcO,CAAK,EAAIG,EAAUC,GAAS,CAAEA,EAAM,OAAQA,EAAM,MAAOA,EAAM,IAAK,CAAE,EACrG2B,EAAmBC,EAAAA,WAAYC,CAAiB,EAChDZ,EAAWX,EAAAA,OAAQ,IAAK,EACxBR,EAAQL,EAAAA,QAAS,IAEf,IAAIqC,EAET,CAAA,CAAG,EAEN,IAAIC,EAASC,EA2Eb,OA1EK,MAAM,QAAST,CAAO,GAE1BQ,EAAUR,EAAQ,CAAE,EACpBS,EAAUT,EAAQ,CAAE,IAIpBQ,EAAUR,EACVS,EAAUT,GAIXrB,EAAU,IAAM,CAEf,MAAMnB,EAAY4C,GAAA,YAAAA,EAAkB,UAC9BM,EAAQN,GAAA,YAAAA,EAAkB,MAEhC,GAAO,CAAE5C,GAAa,CAAEkD,GAAWhB,EAAS,UAAY,KAEvD,OAAO,KAIR,MAAMiB,EAAQjB,EAAS,QAcvB,GAXApC,GAAqBS,EAAeP,EAAWkD,EAAO3D,CAAK,EAAE,aAAc2D,EAAM,kBAAmB,EACpGlD,EAAU,0BAA2BT,EAAMM,CAAM,EAEjDG,EACE,oBAAqBH,EAAM,IAAKA,EAAM,IAAK,EAAGH,CAAW,EACzD,YAAawD,EAAM,WAAY,EAGjCxD,EAAW,OAAA,EACXF,EAAQ,KAAMe,EAAc,WAAY,EAAE,YAAab,CAAW,EAE7D6C,EAAK,YAAA,IAAkB,KAE3BY,EAAM,WAAW,sBAAuB3D,CAAQ,EAAE,OAAA,UAKlDJ,EAAK,IAAK,EAAG,EAAG,CAAE,EAAE,mBAAoBI,CAAQ,EAAE,UAAA,EAClDJ,EAAK,EAAI,EACTA,EAAK,UAAA,EAEAA,EAAK,OAAA,IAAa,EAGtB+D,EAAM,WAAW,SAAA,MAEX,CAGN,MAAMC,EAAQ9D,EAAM,IAAK,EAAG,EAAG,CAAE,EAAE,QAASF,CAAK,EACjDE,EAAM,MAAOF,CAAK,EAAE,UAAA,EACpB+D,EAAM,WAAW,iBAAkB7D,EAAO,CAAE8D,CAAM,CAEnD,CAIF,CAAE,EAGKd,IAENA,QAAYV,GAAA,EAAe,GAKrBc,EAONW,EACClB,OAAAmB,EAAAA,SAAA,CACC,SAAA,CAAA3B,EAAAA,IAAC,QAAA,CACA,IAAMO,EACN,MAAAO,EACA,SAAW,CACV5B,EAAK,MAAQ,EAAImC,EAAUP,EAAQ,EACnC,CAAE5B,EAAK,OAAS,EAAIoC,EAAUR,EAAQ,EACtC,CAAA,EAGC,GAAGE,EACH,SAAAL,CAAA,CAAA,EACHX,EAAAA,IAACvB,GAAA,CACA,cAAAG,EACA,aAAAD,EACA,mBAAAE,EACA,eAAiB,EAAA,CAAA,CAClB,EACD,EACAO,EACA,CAAE,OAAQ,CAAE,SAAU,GAAG,CAAE,EA1BrB,IA8BT,CCvQO,MAAMwC,GAAmBC,EAAAA,WAAY,SAA2BnD,EAAOiB,EAAM,CAEnF,KAAM,CACL,KAAAiB,EAAO,cACP,eAAAkB,EACA,kBAAAC,EACA,mBAAAC,EACA,GAAGC,CAAA,EACAvD,EAEE,CAAEO,EAAKiD,EAAKC,EAAYC,EAAUhE,EAAQc,CAAK,EAAIG,EAAUC,GAAS,CAAEA,EAAM,IAAKA,EAAM,IAAKA,EAAM,WAAYA,EAAM,SAAUA,EAAM,OAAQA,EAAM,IAAK,CAAE,EAG3J+C,EAAUtD,EAAAA,QAAS,IAAM,CAE9B,MAAMsD,EAAU,IAAIC,EACpBD,OAAAA,EAAQ,SAAW,GAEdjE,EAAO,sBAEXiE,EAAQ,mBAAmB,KAAMjE,CAAO,EACxCiE,EAAQ,KAAO,gBAIfA,EAAQ,kBAAkB,KAAMjE,CAAO,EAIxCiE,EAAQ,YAAA,EACRA,EAAQ,KAAOzB,EAERyB,CAIR,EAAG,CAAA,CAAG,EAEN9C,EAAAA,UAAW,IAAM,CAEhB,KAAM,CAAE,kBAAAwC,EAAmB,mBAAAC,GAAuBK,EAC5CE,EAASrD,EAAK,MAAQA,EAAK,OACjC6C,EAAkB,OAASQ,EAC3BR,EAAkB,uBAAA,EAElBC,EAAmB,KAAO,CAAEA,EAAmB,IAAMO,EACrDP,EAAmB,MAAQ,CAAEA,EAAmB,KAChDD,EAAkB,uBAAA,CAEnB,EAAG,CAAEM,EAASnD,CAAK,CAAE,EAGrBsD,EAAcH,EAAS1C,CAAI,EAG3BJ,EAAAA,UAAW,IAAM,CAEhB,MAAMkD,EAAiB,CAAE,CAAE,OAAArE,KAAc,CAExCa,EAAK,KAAQ,CAAE,OAAAb,CAAAA,EAAW,CAE3B,EAEA,OAAAa,EAAK,KAAQ,CAAE,OAAQoD,EAAQ,QAAW,EAC1CA,EAAQ,iBAAkB,gBAAiBI,CAAe,EACnD,IAAM,CAEZJ,EAAQ,oBAAqB,gBAAiBI,CAAe,CAE9D,CAED,EAAG,CAAEJ,EAASpD,CAAI,CAAE,EAGpBM,EAAAA,UAAW,IAAM,CAEhB,MAAMmD,EAAuBL,EAAQ,kBAC/BM,EAAwBN,EAAQ,mBACtC,OAAAA,EAAQ,kBAAoBN,GAAqBW,EACjDL,EAAQ,mBAAqBL,GAAsBW,EAEnD1D,EAAK,KAAQ,CAAE,OAAQoD,EAAQ,QAAW,EAEnC,IAAM,CAEZA,EAAQ,kBAAoBK,EAC5BL,EAAQ,mBAAqBM,CAE9B,CAED,EAAG,CAAEZ,EAAmBC,EAAoBK,EAASpD,CAAI,CAAE,EAG3DM,EAAAA,UAAW,IAAM,CAEhB,GAAKqB,IAASyB,EAAQ,KAAO,CAI5B,MAAMO,EAAehC,IAAS,eAAiByB,EAAQ,mBAAqBA,EAAQ,kBAC/EP,EAEJA,EAAgBO,EAASO,CAAa,EAE3BR,GAAYA,EAAS,uBAEhCA,EAAS,cAAeC,EAAQ,UAAW,EAC3CA,EAAQ,YAAA,EAERD,EAAS,aAAcC,EAAQ,iBAAkB,EACjDD,EAAS,aAAcC,EAAQ,kBAAmB,IAIlDA,EAAQ,WACN,IAAK,EAAG,EAAG,EAAI,EACf,mBAAoBA,EAAQ,OAAO,WAAY,EAC/C,eAAgB,EAAG,EACnB,IAAKA,EAAQ,OAAO,QAAS,EAC/BA,EAAQ,YAAA,GAITA,EAAQ,OAAA,EACRF,EAAA,CAED,CAED,EAAG,CAAEvB,EAAMyB,EAASF,EAAYC,EAAUN,CAAe,CAAE,EAG3DvC,EAAAA,UAAW,IAAM,CAEhB,MAAMsD,EAAW,IAAMV,EAAA,EACvB,OAAAE,EAAQ,iBAAkB,mBAAoBQ,CAAS,EACvDR,EAAQ,iBAAkB,SAAUQ,CAAS,EAC7CR,EAAQ,iBAAkB,iBAAkBQ,CAAS,EAE9C,IAAM,CAEZR,EAAQ,oBAAqB,mBAAoBQ,CAAS,EAC1DR,EAAQ,oBAAqB,SAAUQ,CAAS,EAChDR,EAAQ,oBAAqB,iBAAkBQ,CAAS,CAEzD,CAED,EAAG,CAAER,EAASF,CAAW,CAAE,EAE3BW,EAAgBT,EAASJ,CAAQ,EAGjCzC,EAAU,IAAM,CAEf6C,EAAQ,OAAA,EACHD,IAEJA,EAAS,QAAU,CAAEC,EAAQ,WAM9B,KAAM,CAAE,OAAAjE,EAAQ,KAAAc,CAAAA,EAASgD,EAAA,EACzB,GAAK,CAAEF,GAAsB5D,IAAWiE,EAAQ,mBAAqB,CAEpE,MAAME,EAASrD,EAAK,MAAQA,EAAK,OAC3Bd,EAASiE,EAAQ,mBAClBE,IAAWnE,EAAO,QAEtBA,EAAO,OAAS,GAChBA,EAAO,IAAM,EACbA,EAAO,KAAO,CAAEmE,EAChBnE,EAAO,MAAQmE,EACfnE,EAAO,uBAAA,EAIT,CAEKiE,EAAQ,WAEZF,EAAA,CAIF,EAAG,EAAI,CAER,CAAE,EC7LK,SAASY,GAAiBrE,EAAQ,CAExC,MAAMsE,EAAQ9B,EAAAA,WAAY+B,CAAqB,EACzCC,EAAStD,EAAAA,OAAA,EAEf,OAAAJ,EAAU,IAAM,CAEf,MAAM2D,EAAUD,EAAO,QAClBC,GAAWH,IAEfG,EAAQ,MAAM,MAAQ,GAAIH,EAAM,aAAe,GAAI,IACnDG,EAAQ,MAAM,QAAUH,EAAM,eAAiB,EAAI,EAAI,EACvDG,EAAQ,MAAM,WAAaH,EAAM,eAAiB,EAAI,sBAAwB,GAIhF,CAAE,EAEKhD,EAAAA,IAACoD,EAAA,CACP,IAAMF,EACN,MAAQ,CACP,SAAU,WACV,KAAM,EACN,OAAQ,EACR,OAAQ,MACR,WAAY,QAEZ,QAAS,EACT,MAAO,MAAA,CACR,CAAA,CAGF,CCjCA,MAAMrF,EAAU,IAAIC,EACb,SAASuF,EAAuBC,EAAOC,EAAMhF,EAAS,CAE5D,OAAAA,EAAO,gBAAiB,CAAE+E,EAAM,EAAG,CAAEA,EAAM,EAAG,CAAEA,EAAM,CAAC,EAEvDzF,EAAQ,2BAA4B0F,CAAI,EACxChF,EAAO,YAAaV,CAAO,EAE3BA,EAAQ,gBAAiByF,EAAM,EAAGA,EAAM,EAAGA,EAAM,CAAC,EAClD/E,EAAO,YAAaV,CAAO,EAEpBU,CAER,CCVA,MAAMiF,MAAgCC,EAChCC,MAAiChG,EACjCiG,MAA2BjG,EAC3B6F,MAA2BK,EAC3BC,MAA6B/F,EAEtBgG,GAAuBjC,EAAAA,WAAY,SAA+BnD,EAAOiB,EAAM,CAE3F,MAAMqD,EAAQ9B,EAAAA,WAAY+B,CAAqB,EACzCb,EAAW/C,EAAU,CAAE,CAAE,SAAA+C,CAAAA,IAAgBA,CAAS,EAClDhD,EAAQC,EAAU,CAAE,CAAE,MAAAD,CAAAA,IAAaA,CAAM,EAEzC2E,EAAyBC,EAAAA,YAAa,CAAE3B,EAASO,IAAkB,CAExE,GAAK,CAAEP,EAAQ,UAAY,CAE1BO,EAAa,kBAAA,EAGbY,EAAU,IAAI,UAAU,IAAK,EAAG,EAAG,EAAI,EAAE,mBAAoBnB,EAAQ,OAAO,WAAY,EACxFmB,EAAU,IAAI,OAAO,sBAAuBnB,EAAQ,OAAO,WAAY,EAEvE,MAAM4B,EAAMT,EAAU,gBAAiBpE,CAAM,EAAG,CAAE,EA0BlD,GAzBK6E,GAEJ5B,EAAQ,WAAW,KAAM4B,EAAI,KAAM,EACnC5B,EAAQ,YAAA,IAIRD,EAAS,cAAeC,EAAQ,UAAW,EAC3CA,EAAQ,YAAA,GAKJW,GAEJa,EAAO,KAAMb,EAAM,MAAM,WAAY,EAAE,OAAA,EACvCU,EAAW,KAAMrB,EAAQ,UAAW,EAAE,aAAcwB,CAAO,EAC3Db,EAAM,UAAU,oBAAqBU,EAAYA,CAAW,EAAE,eAAgB,EAAI,EAAE,mBAAoBV,EAAM,MAAM,WAAY,GAIhIU,EAAW,IAAK,EAAG,GAAK,CAAE,EAItBd,EAAa,qBAAuB,CAGxC,MAAMnB,EAAQiC,EAAW,QAASF,EAAU,IAAI,SAAU,EAC1DG,EAAK,aAAcD,EAAYF,EAAU,IAAI,SAAU,EACvDD,EAAK,iBAAkBI,EAAM,CAAElC,CAAM,EAAE,UAAA,EAEvC4B,EAAuBhB,EAAQ,WAAYkB,EAAMM,CAAO,EACxDjB,EAAa,YAAY,YAAaiB,CAAO,EAC7CjB,EAAa,YAAY,UACxBA,EAAa,SACbA,EAAa,WACbA,EAAa,KAAA,CAQf,SAKM,CAAER,EAAS,iBAAmBA,EAAS,kBAAoB,CAG/D,IAAIX,EAAQiC,EAAW,QAASF,EAAU,IAAI,SAAU,EACxD/B,EAAQ,KAAK,IAAK,GAAKyC,EAAU,QAAUzC,EAAO,CAAE,EAEpDkC,EAAK,IAAK,EAAG,EAAG,CAAE,EAAE,mBAAoBf,EAAa,WAAY,EACjEW,EAAK,iBAAkBI,EAAMlC,CAAM,EAAE,UAAA,EAErC4B,EAAuBhB,EAAQ,WAAYkB,EAAMM,CAAO,EACxDjB,EAAa,YAAY,YAAaiB,CAAO,EAC7CjB,EAAa,YAAY,UACxBA,EAAa,SACbA,EAAa,WACbA,EAAa,KAAA,CAGf,CAIF,CAEAR,EAAS,aAAcC,EAAQ,iBAAkB,EACjDD,EAAS,aAAcC,EAAQ,kBAAmB,CAEnD,EAAG,CAAEW,EAAOZ,EAAUhD,CAAM,CAAE,EAE9B,aAAQwC,GAAA,CAAmB,GAAGlD,EAAQ,IAAAiB,EAAY,eAAiBoE,EAAyB,CAE7F,CAAE"}