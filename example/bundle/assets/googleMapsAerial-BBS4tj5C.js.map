{"version":3,"file":"googleMapsAerial-BBS4tj5C.js","sources":["../../three/googleMapsAerial.js"],"sourcesContent":["import { GeoUtils, WGS84_ELLIPSOID, TilesRenderer } from '3d-tiles-renderer';\nimport { TilesFadePlugin, TileCompressionPlugin, GLTFExtensionsPlugin, CesiumIonAuthPlugin, ReorientationPlugin } from '3d-tiles-renderer/plugins';\nimport {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tRaycaster,\n\tMathUtils,\n} from 'three';\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\n\nlet camera, controls, scene, renderer, tiles;\n\nconst raycaster = new Raycaster();\nraycaster.firstHitOnly = true;\n\ninit();\nanimate();\n\nfunction reinstantiateTiles() {\n\n\tif ( tiles ) {\n\n\t\tscene.remove( tiles.group );\n\t\ttiles.dispose();\n\t\ttiles = null;\n\n\t}\n\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new CesiumIonAuthPlugin( { apiToken: import.meta.env.VITE_ION_KEY, assetId: '2275207', autoRefreshToken: true } ) );\n\ttiles.registerPlugin( new TileCompressionPlugin() );\n\ttiles.registerPlugin( new TilesFadePlugin() );\n\ttiles.registerPlugin( new GLTFExtensionsPlugin( {\n\t\t// Note the DRACO compression files need to be supplied via an explicit source.\n\t\t// We use unpkg here but in practice should be provided by the application.\n\t\tdracoLoader: new DRACOLoader().setDecoderPath( 'https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/' )\n\t} ) );\n\ttiles.registerPlugin( new ReorientationPlugin( { lat: 35.6586 * MathUtils.DEG2RAD, lon: 139.7454 * MathUtils.DEG2RAD } ) );\n\n\t// 35.3606, 138.7274 // Mt Fuji\n\t// 48.8584, 2.2945 // Eiffel Tower\n\t// 41.8902, 12.4922 // Colosseum\n\t// 43.8803, - 103.4538 // Mt Rushmore\n\t// 36.2679, - 112.3535 // Grand Canyon\n\t// - 22.951890, - 43.210439 // Christ the Redeemer\n\t// 34.9947, 135.7847 // Kiyomizu-dera\n\t// 35.6586, 139.7454 // Tokyo Tower\n\n\tscene.add( tiles.group );\n\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.setCamera( camera );\n\n}\n\nfunction init() {\n\n\tscene = new Scene();\n\n\t// primary camera view\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setClearColor( 0x151c1f );\n\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 100, 1600000 );\n\tcamera.position.set( 1e3, 1e3, 1e3 ).multiplyScalar( 0.5 );\n\n\t// controls\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.minDistance = 500;\n\tcontrols.maxDistance = 1e4 * 2;\n\tcontrols.minPolarAngle = 0;\n\tcontrols.maxPolarAngle = 3 * Math.PI / 8;\n\tcontrols.enableDamping = true;\n\tcontrols.autoRotate = true;\n\tcontrols.autoRotateSpeed = 0.5;\n\tcontrols.enablePan = false;\n\n\treinstantiateTiles();\n\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\twindow.addEventListener( 'hashchange', initFromHash );\n\n\t// run hash functions\n\tinitFromHash();\n\n}\n\nfunction onWindowResize() {\n\n\tcamera.aspect = window.innerWidth / window.innerHeight;\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\tcamera.updateProjectionMatrix();\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\n}\n\nfunction initFromHash() {\n\n\tconst hash = window.location.hash.replace( /^#/, '' );\n\tconst tokens = hash.split( /,/g ).map( t => parseFloat( t ) );\n\tif ( tokens.length !== 2 || tokens.findIndex( t => Number.isNaN( t ) ) !== - 1 ) {\n\n\t\treturn;\n\n\t}\n\n\n\tconst [ lat, lon ] = tokens;\n\ttiles.setLatLonToYUp( lat * MathUtils.DEG2RAD, lon * MathUtils.DEG2RAD );\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tif ( ! tiles ) return;\n\n\tcontrols.update();\n\n\t// update options\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.setCamera( camera );\n\n\t// update tiles\n\tcamera.updateMatrixWorld();\n\ttiles.update();\n\n\trender();\n\n}\n\nfunction render() {\n\n\t// render primary view\n\trenderer.render( scene, camera );\n\n\tif ( tiles ) {\n\n\t\tconst mat = tiles.group.matrixWorld.clone().invert();\n\t\tconst vec = camera.position.clone().applyMatrix4( mat );\n\n\t\tconst res = {};\n\t\tWGS84_ELLIPSOID.getPositionToCartographic( vec, res );\n\n\t\tconst attributions = tiles.getAttributions()[ 0 ]?.value || '';\n\t\tdocument.getElementById( 'credits' ).innerText = GeoUtils.toLatLonString( res.lat, res.lon ) + '\\n' + attributions;\n\n\t}\n\n}\n"],"names":["camera","controls","scene","renderer","tiles","raycaster","Raycaster","init","animate","reinstantiateTiles","TilesRenderer","CesiumIonAuthPlugin","TileCompressionPlugin","TilesFadePlugin","GLTFExtensionsPlugin","DRACOLoader","ReorientationPlugin","MathUtils","Scene","WebGLRenderer","PerspectiveCamera","OrbitControls","onWindowResize","initFromHash","tokens","t","lat","lon","render","mat","vec","res","WGS84_ELLIPSOID","attributions","_a","GeoUtils.toLatLonString"],"mappings":"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"}