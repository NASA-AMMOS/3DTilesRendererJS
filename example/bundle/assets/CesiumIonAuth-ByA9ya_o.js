class o{constructor(s={}){const{apiToken:t,autoRefreshToken:e=!1}=s;this.apiToken=t,this.autoRefreshToken=e,this.authURL=null,this._tokenRefreshPromise=null,this._bearerToken=null}async fetch(s,t){await this._tokenRefreshPromise;const e={...t};e.headers=e.headers||{},e.headers={...e.headers,Authorization:this._bearerToken};const r=await fetch(s,e);return r.status>=400&&r.status<=499&&this.autoRefreshToken?(await this.refreshToken(t),e.headers.Authorization=this._bearerToken,fetch(s,e)):r}refreshToken(s){if(this._tokenRefreshPromise===null){const t=new URL(this.authURL);t.searchParams.set("access_token",this.apiToken),this._tokenRefreshPromise=fetch(t,s).then(e=>{if(!e.ok)throw new Error(`CesiumIonAuthPlugin: Failed to load data with error code ${e.status}`);return e.json()}).then(e=>(this._bearerToken=`Bearer ${e.accessToken}`,this._tokenRefreshPromise=null,e))}return this._tokenRefreshPromise}}export{o as C};
//# sourceMappingURL=CesiumIonAuth-ByA9ya_o.js.map
