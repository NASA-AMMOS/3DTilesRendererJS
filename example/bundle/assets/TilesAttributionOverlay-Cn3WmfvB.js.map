{"version":3,"file":"TilesAttributionOverlay-Cn3WmfvB.js","sources":["../../../src/r3f/components/TilesAttributionOverlay.jsx"],"sourcesContent":["import { useContext, useState, useEffect, useMemo } from 'react';\nimport { TilesRendererContext } from './TilesRenderer.jsx';\nimport { CanvasDOMOverlay } from './CanvasDOMOverlay.jsx';\n\nfunction randomID() {\n\n\treturn crypto.getRandomValues( new Uint32Array( 1 ) )[ 0 ].toString( 16 );\n\n}\n\n// Overlay for displaying tile data set attributions\nexport function TilesAttributionOverlay( { children, style, generateAttributions, ...rest } ) {\n\n\tconst tiles = useContext( TilesRendererContext );\n\tconst [ attributions, setAttributions ] = useState( [] );\n\n\t// Add events for checking when attributions may be updated\n\tuseEffect( () => {\n\n\t\tif ( ! tiles ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tlet queued = false;\n\t\tconst callback = () => {\n\n\t\t\tif ( ! queued ) {\n\n\t\t\t\tqueued = true;\n\t\t\t\tqueueMicrotask( () => {\n\n\t\t\t\t\tsetAttributions( tiles.getAttributions() );\n\t\t\t\t\tqueued = false;\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t};\n\n\t\ttiles.addEventListener( 'tile-visibility-change', callback );\n\t\ttiles.addEventListener( 'load-tile-set', callback );\n\n\t\treturn () => {\n\n\t\t\ttiles.removeEventListener( 'tile-visibility-change', callback );\n\t\t\ttiles.removeEventListener( 'load-tile-set', callback );\n\n\t\t};\n\n\t}, [ tiles ] );\n\n\t// Generate CSS for modifying child elements implicit to the html attributions\n\tconst classId = useMemo( () => 'class_' + randomID(), [] );\n\tconst styles = useMemo( () => `\n\t\t#${ classId } a {\n\t\t\tcolor: white;\n\t\t}\n\n\t\t#${ classId } img {\n\t\t\tmax-width: 125px;\n\t\t\tdisplay: block;\n\t\t\tmargin: 5px 0;\n\t\t}\n\t`, [ classId ] );\n\n\tlet output;\n\tif ( generateAttributions ) {\n\n\t\toutput = generateAttributions( attributions, classId );\n\n\t} else {\n\n\t\t// generate elements for each type of attribution\n\t\tconst elements = [];\n\t\tattributions.forEach( ( att, i ) => {\n\n\t\t\tlet element = null;\n\t\t\tif ( att.type === 'string' ) {\n\n\t\t\t\telement = <div key={ i }>{ att.value }</div>;\n\n\t\t\t} else if ( att.type === 'html' ) {\n\n\t\t\t\telement = <div key={ i } dangerouslySetInnerHTML={ { __html: att.value } } style={ { pointerEvents: 'all' } }/>;\n\n\t\t\t} else if ( att.type === 'image' ) {\n\n\t\t\t\telement = <div key={ i }><img src={ att.value } /></div>;\n\n\t\t\t}\n\n\t\t\tif ( element ) {\n\n\t\t\t\telements.push( element );\n\n\t\t\t}\n\n\t\t} );\n\n\t\toutput = (\n\t\t\t<>\n\t\t\t\t<style>{ styles }</style>\n\t\t\t\t{ elements }\n\t\t\t</>\n\t\t);\n\n\t}\n\n\treturn (\n\t\t<CanvasDOMOverlay\n\t\t\tid={ classId }\n\t\t\tstyle={ {\n\t\t\t\tposition: 'absolute',\n\t\t\t\tbottom: 0,\n\t\t\t\tleft: 0,\n\t\t\t\tpadding: '10px',\n\t\t\t\tcolor: 'rgba( 255, 255, 255, 0.75 )',\n\t\t\t\tfontSize: '10px',\n\t\t\t\t...style,\n\t\t\t} }\n\t\t\t{ ...rest }\n\t\t>\n\t\t\t{ children }\n\t\t\t{ output }\n\t\t</CanvasDOMOverlay>\n\t);\n\n}\n"],"names":["randomID","TilesAttributionOverlay","children","style","generateAttributions","rest","tiles","useContext","TilesRendererContext","attributions","setAttributions","useState","useEffect","queued","callback","classId","useMemo","styles","output","elements","att","i","element","jsx","jsxs","Fragment","CanvasDOMOverlay"],"mappings":"6GAIA,SAASA,GAAW,CAEnB,OAAO,OAAO,gBAAiB,IAAI,YAAa,CAAE,CAAE,EAAG,CAAE,EAAE,SAAU,EAAG,CAEzE,CAGO,SAASC,EAAyB,CAAE,SAAAC,EAAU,MAAAC,EAAO,qBAAAC,EAAsB,GAAGC,GAAS,CAE7F,MAAMC,EAAQC,EAAAA,WAAYC,CAAqB,EACzC,CAAEC,EAAcC,CAAgB,EAAIC,EAAAA,SAAU,CAAA,CAAG,EAGvDC,EAAAA,UAAW,IAAM,CAEhB,GAAK,CAAEN,EAEN,OAID,IAAIO,EAAS,GACb,MAAMC,EAAW,IAAM,CAEfD,IAENA,EAAS,GACT,eAAgB,IAAM,CAErBH,EAAiBJ,EAAM,iBAAkB,EACzCO,EAAS,EAEV,CAAE,EAIJ,EAEA,OAAAP,EAAM,iBAAkB,yBAA0BQ,CAAS,EAC3DR,EAAM,iBAAkB,gBAAiBQ,CAAS,EAE3C,IAAM,CAEZR,EAAM,oBAAqB,yBAA0BQ,CAAS,EAC9DR,EAAM,oBAAqB,gBAAiBQ,CAAS,CAEtD,CAED,EAAG,CAAER,CAAM,CAAE,EAGb,MAAMS,EAAUC,EAAAA,QAAS,IAAM,SAAWhB,EAAA,EAAY,CAAA,CAAG,EACnDiB,EAASD,EAAAA,QAAS,IAAM;AAAA,KACzBD,CAAQ;AAAA;AAAA;AAAA;AAAA,KAIRA,CAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,GAKV,CAAEA,CAAQ,CAAE,EAEf,IAAIG,EACJ,GAAKd,EAEJc,EAASd,EAAsBK,EAAcM,CAAQ,MAE/C,CAGN,MAAMI,EAAW,CAAA,EACjBV,EAAa,QAAS,CAAEW,EAAKC,IAAO,CAEnC,IAAIC,EAAU,KACTF,EAAI,OAAS,SAEjBE,EAAUC,EAAAA,IAAC,MAAA,CAAgB,SAAAH,EAAI,KAAA,EAAVC,CAAiB,EAE3BD,EAAI,OAAS,OAExBE,EAAUC,EAAAA,IAAC,MAAA,CAAc,wBAA0B,CAAE,OAAQH,EAAI,KAAA,EAAU,MAAQ,CAAE,cAAe,KAAA,GAA/EC,CAAwF,EAElGD,EAAI,OAAS,UAExBE,EAAUC,EAAAA,IAAC,OAAc,SAAAA,EAAAA,IAAC,MAAA,CAAI,IAAMH,EAAI,MAAQ,GAA3BC,CAA6B,GAI9CC,GAEJH,EAAS,KAAMG,CAAQ,CAIzB,CAAE,EAEFJ,EACCM,EAAAA,KAAAC,WAAA,CACC,SAAA,CAAAF,EAAAA,IAAC,SAAQ,SAAAN,CAAA,CAAQ,EACfE,CAAA,EACH,CAGF,CAEA,OACCK,EAAAA,KAACE,EAAA,CACA,GAAKX,EACL,MAAQ,CACP,SAAU,WACV,OAAQ,EACR,KAAM,EACN,QAAS,OACT,MAAO,8BACP,SAAU,OACV,GAAGZ,CAAA,EAEF,GAAGE,EAEH,SAAA,CAAAH,EACAgB,CAAA,CAAA,CAAA,CAIL"}