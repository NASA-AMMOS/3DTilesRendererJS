import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{T as Te}from"./TilesRenderer-Bm042Xsy.js";import{L as Ee,r as Ce,a as Be}from"./BatchTable-CRr3zuRk.js";import{G as Se}from"./GLTFExtensionsPlugin-CGSNI2LM.js";import{D as R}from"./DebugTilesPlugin-DPW5Pin-.js";import{o as De,t as Pe,u as ke,S as Ae,W as j,a as Y,v as Z,O as Le,D as Me,A as Re,B as Ie,d as Ue,G as q,R as He,V as ee,s as Ke,h as le,w as Ve,x as Ne}from"./three.module-D-uF--xd.js";import{O as Oe}from"./OrbitControls-DlTkIL5F.js";import{e as ze}from"./GLTFLoader-B4GrkiON.js";import{D as Fe}from"./DRACOLoader-gn1nzdEq.js";import{K as We}from"./KTX2Loader-CDpjicL9.js";import{g as _e}from"./lil-gui.module.min-BH_YJbPT.js";import{S as Ge}from"./stats.module--VATS4Kh.js";import"./TilesRendererBase-CFsQu8zV.js";import"./constants-JFoaxC9y.js";import"./B3DMLoader-Cnf0ja_2.js";import"./B3DMLoaderBase-w5mdSgm-.js";import"./PNTSLoader-DwvZQNdL.js";import"./I3DMLoader-BWluRuWb.js";import"./Ellipsoid-Dwquuq5w.js";import"./CMPTLoader-BOTrymv0.js";import"./EllipsoidRegion-VNvPMw5b.js";import"./EllipsoidRegionHelper-CAg2B1Y_.js";function $(d){return d.implicitTilingData.root.implicitTiling.subdivisionScheme==="OCTREE"}function X(d){return $(d)?8:4}function $e(d,e){if(!d)return[0,0,0];const i=d.implicitTilingData.x,t=d.implicitTilingData.y,n=d.implicitTilingData.z,s=2*i+e%2,o=2*t+Math.floor(e/2)%2,a=$(d)?2*n+Math.floor(e/4)%2:0;return[s,o,a]}class ce{constructor(e,i){this.parent=e,this.children=[],this.geometricError=0,this.boundingVolume=null;const[t,n,s]=$e(e,i);this.implicitTilingData={level:e.implicitTilingData.level+1,root:e.implicitTilingData.root,subtreeIdx:i,x:t,y:n,z:s}}static clone(e){return{parent:e.parent,children:[],geometricError:e.geometricError,boundingVolume:e.boundingVolume,implicitTilingData:{...e.implicitTilingData}}}}class je extends Ee{constructor(e){super(),this.tile=e,this.rootTile=e.implicitTilingData.root,this.workingPath=null}parseBuffer(e){const i=new DataView(e);let t=0;const n=Ce(i);console.assert(n==="subt",'SUBTREELoader: The magic bytes equal "subt".'),t+=4;const s=i.getUint32(t,!0);console.assert(s===1,'SUBTREELoader: The version listed in the header is "1".'),t+=4;const o=i.getUint32(t,!0);t+=8;const a=i.getUint32(t,!0);t+=8;const c=JSON.parse(Be(new Uint8Array(e,t,o)));t+=o;const h=e.slice(t,t+a);return{version:s,subtreeJson:c,subtreeByte:h}}async parse(e){const i=this.parseBuffer(e),t=i.subtreeJson;t.contentAvailabilityHeaders=[].concat(t.contentAvailability);const n=this.preprocessBuffers(t.buffers),s=this.preprocessBufferViews(t.bufferViews,n);this.markActiveBufferViews(t,s);const o=await this.requestActiveBuffers(n,i.subtreeByte),a=this.parseActiveBufferViews(s,o);this.parseAvailability(i,t,a),this.expandSubtree(this.tile,i)}markActiveBufferViews(e,i){let t;const n=e.tileAvailability;isNaN(n.bitstream)?isNaN(n.bufferView)||(t=i[n.bufferView]):t=i[n.bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0);const s=e.contentAvailabilityHeaders;for(let a=0;a<s.length;a++)t=void 0,isNaN(s[a].bitstream)?isNaN(s[a].bufferView)||(t=i[s[a].bufferView]):t=i[s[a].bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0);t=void 0;const o=e.childSubtreeAvailability;isNaN(o.bitstream)?isNaN(o.bufferView)||(t=i[o.bufferView]):t=i[o.bitstream],t&&(t.isActive=!0,t.bufferHeader.isActive=!0)}async requestActiveBuffers(e,i){const t=[];for(let o=0;o<e.length;o++){const a=e[o];if(!a.isActive)t.push(Promise.resolve());else if(a.isExternal){const c=this.parseImplicitURIBuffer(this.tile,this.rootTile.implicitTiling.subtrees.uri,a.uri),h=fetch(c,this.fetchOptions).then(p=>{if(!p.ok)throw new Error(`SUBTREELoader: Failed to load external buffer from ${a.uri} with error code ${p.status}.`);return p.arrayBuffer()}).then(p=>new Uint8Array(p));t.push(h)}else t.push(Promise.resolve(new Uint8Array(i)))}const n=await Promise.all(t),s={};for(let o=0;o<n.length;o++){const a=n[o];a&&(s[o]=a)}return s}parseActiveBufferViews(e,i){const t={};for(let n=0;n<e.length;n++){const s=e[n];if(!s.isActive)continue;const o=s.byteOffset,a=o+s.byteLength,c=i[s.buffer];t[n]=c.slice(o,a)}return t}preprocessBuffers(e=[]){for(let i=0;i<e.length;i++){const t=e[i];t.isActive=!1,t.isExternal=!!t.uri}return e}preprocessBufferViews(e=[],i){for(let t=0;t<e.length;t++){const n=e[t];n.bufferHeader=i[n.buffer],n.isActive=!1,n.isExternal=n.bufferHeader.isExternal}return e}parseAvailability(e,i,t){const n=X(this.rootTile),s=this.rootTile.implicitTiling.subtreeLevels,o=(Math.pow(n,s)-1)/(n-1),a=Math.pow(n,s);e._tileAvailability=this.parseAvailabilityBitstream(i.tileAvailability,t,o),e._contentAvailabilityBitstreams=[];for(let c=0;c<i.contentAvailabilityHeaders.length;c++){const h=this.parseAvailabilityBitstream(i.contentAvailabilityHeaders[c],t,o);e._contentAvailabilityBitstreams.push(h)}e._childSubtreeAvailability=this.parseAvailabilityBitstream(i.childSubtreeAvailability,t,a)}parseAvailabilityBitstream(e,i,t){if(!isNaN(e.constant))return{constant:!!e.constant,lengthBits:t};let n;return isNaN(e.bitstream)?isNaN(e.bufferView)||(n=i[e.bufferView]):n=i[e.bitstream],{bitstream:n,lengthBits:t}}expandSubtree(e,i){const t=ce.clone(e);for(let o=0;i&&o<i._contentAvailabilityBitstreams.length;o++)if(i&&this.getBit(i._contentAvailabilityBitstreams[o],0)){t.content={uri:this.parseImplicitURI(e,this.rootTile.content.uri)};break}e.children.push(t);const n=this.transcodeSubtreeTiles(t,i),s=this.listChildSubtrees(i,n);for(let o=0;o<s.length;o++){const a=s[o],c=a.tile,h=this.deriveChildTile(null,c,null,a.childMortonIndex);h.content={uri:this.parseImplicitURI(h,this.rootTile.implicitTiling.subtrees.uri)},c.children.push(h)}}transcodeSubtreeTiles(e,i){let t=[e],n=[];for(let s=1;s<this.rootTile.implicitTiling.subtreeLevels;s++){const o=X(this.rootTile),a=(Math.pow(o,s)-1)/(o-1),c=o*t.length;for(let h=0;h<c;h++){const p=a+h,E=h>>Math.log2(o),k=t[E];if(!this.getBit(i._tileAvailability,p)){n.push(void 0);continue}const I=this.deriveChildTile(i,k,p,h);k.children.push(I),n.push(I)}t=n,n=[]}return t}deriveChildTile(e,i,t,n){const s=new ce(i,n);s.boundingVolume=this.getTileBoundingVolume(s),s.geometricError=this.getGeometricError(s);for(let o=0;e&&o<e._contentAvailabilityBitstreams.length;o++)if(e&&this.getBit(e._contentAvailabilityBitstreams[o],t)){s.content={uri:this.parseImplicitURI(s,this.rootTile.content.uri)};break}return s}getBit(e,i){if(i<0||i>=e.lengthBits)throw new Error("Bit index out of bounds.");if(e.constant!==void 0)return e.constant;const t=i>>3,n=i%8;return(new Uint8Array(e.bitstream)[t]>>n&1)===1}getTileBoundingVolume(e){const i={};if(this.rootTile.boundingVolume.region){const t=[...this.rootTile.boundingVolume.region],n=t[0],s=t[2],o=t[1],a=t[3],c=(s-n)/Math.pow(2,e.implicitTilingData.level),h=(a-o)/Math.pow(2,e.implicitTilingData.level);t[0]=n+c*e.implicitTilingData.x,t[2]=n+c*(e.implicitTilingData.x+1),t[1]=o+h*e.implicitTilingData.y,t[3]=o+h*(e.implicitTilingData.y+1);for(let p=0;p<4;p++){const E=t[p];E<-Math.PI?t[p]+=2*Math.PI:E>Math.PI&&(t[p]-=2*Math.PI)}if($(e)){const p=t[4],k=(t[5]-p)/Math.pow(2,e.implicitTilingData.level);t[4]=p+k*e.implicitTilingData.z,t[5]=p+k*(e.implicitTilingData.z+1)}i.region=t}if(this.rootTile.boundingVolume.box){const t=[...this.rootTile.boundingVolume.box],n=2**e.implicitTilingData.level-1,s=Math.pow(2,-e.implicitTilingData.level),o=$(e)?3:2;for(let a=0;a<o;a++){t[3+a*3+0]*=s,t[3+a*3+1]*=s,t[3+a*3+2]*=s;const c=t[3+a*3+0],h=t[3+a*3+1],p=t[3+a*3+2],E=a===0?e.implicitTilingData.x:a===1?e.implicitTilingData.y:e.implicitTilingData.z;t[0]+=2*c*(-.5*n+E),t[1]+=2*h*(-.5*n+E),t[2]+=2*p*(-.5*n+E)}i.box=t}return i}getGeometricError(e){return this.rootTile.geometricError/Math.pow(2,e.implicitTilingData.level)}listChildSubtrees(e,i){const t=[],n=X(this.rootTile);for(let s=0;s<i.length;s++){const o=i[s];if(o!==void 0)for(let a=0;a<n;a++){const c=s*n+a;this.getBit(e._childSubtreeAvailability,c)&&t.push({tile:o,childMortonIndex:c})}}return t}parseImplicitURI(e,i){return i=i.replace("{level}",e.implicitTilingData.level),i=i.replace("{x}",e.implicitTilingData.x),i=i.replace("{y}",e.implicitTilingData.y),i=i.replace("{z}",e.implicitTilingData.z),i}parseImplicitURIBuffer(e,i,t){const n=this.parseImplicitURI(e,i),s=new URL(n,this.workingPath+"/");return s.pathname=s.pathname.substring(0,s.pathname.lastIndexOf("/")),new URL(s.pathname+"/"+t,this.workingPath+"/").toString()}}class Ye{constructor(){this.name="IMPLICIT_TILING_PLUGIN"}init(e){this.tiles=e}preprocessNode(e,i,t){var n;e.implicitTiling?(e.internal.hasUnrenderableContent=!0,e.internal.hasRenderableContent=!1,e.implicitTilingData={root:e,subtreeIdx:0,x:0,y:0,z:0,level:0}):/.subtree$/i.test((n=e.content)==null?void 0:n.uri)&&(e.internal.hasUnrenderableContent=!0,e.internal.hasRenderableContent=!1)}parseTile(e,i,t){if(/^subtree$/i.test(t)){const n=new je(i);return n.workingPath=i.internal.basePath,n.fetchOptions=this.tiles.fetchOptions,n.parse(e)}}preprocessURL(e,i){if(i&&i.implicitTiling){const t=i.implicitTiling.subtrees.uri.replace("{level}",i.implicitTilingData.level).replace("{x}",i.implicitTilingData.x).replace("{y}",i.implicitTilingData.y).replace("{z}",i.implicitTilingData.z);return new URL(t,i.internal.basePath+"/").toString()}return e}disposeTile(e){var i;/.subtree$/i.test((i=e.content)==null?void 0:i.uri)&&(e.children.forEach(t=>{this.tiles.processNodeQueue.remove(t)}),e.children.length=0)}}const Ze={type:"fly-change"},qe={type:"fly-start"},Xe={type:"fly-end"},v=new Pe(0,0,0,0);class Q extends Oe{constructor(e,i){const t=y=>{this.enabled&&Object.defineProperty(y,"shiftKey",{get(){return!1}})};i.addEventListener("pointerdown",t),super(e,i),this.enableKeys=!1,this.enableFlight=!0,this.baseSpeed=1,this.fastSpeed=4,this.forwardKey="w",this.backKey="s",this.leftKey="a",this.rightKey="d",this.upKey="q",this.downKey="e",this.fastKey="shift";let n=!1,s=!1,o=!1,a=!1,c=!1,h=!1,p=!1,E=0,k=0,I=0,M=-1;const te=new De,ie=new ke,ne=()=>{if(M!==-1){cancelAnimationFrame(M),M=-1,this.minDistance=k,this.maxDistance=I;const y=Math.min(E,e.position.distanceTo(te));v.set(0,0,-1,0).applyMatrix4(e.matrixWorld),this.target.copy(e.position).addScaledVector(v,y),this.dispatchEvent(Xe)}},se=()=>{if(!this.enabled||!this.enableFlight)return;M=requestAnimationFrame(se),v.set(0,0,0,0),s&&(v.z-=1),o&&(v.z+=1),a&&(v.x-=1),c&&(v.x+=1),h&&(v.y+=1),p&&(v.y-=1),v.applyMatrix4(e.matrixWorld);const y=60*ie.getDelta(),A=n?this.fastSpeed:this.baseSpeed;e.position.addScaledVector(v,A*y),this.target.addScaledVector(v,A*y),this.dispatchEvent(Ze)},oe=y=>{const A=y.key.toLowerCase();switch(M===-1&&(I=this.maxDistance,k=this.minDistance,E=e.position.distanceTo(this.target),te.copy(this.target)),A){case this.forwardKey:s=!0;break;case this.backKey:o=!0;break;case this.leftKey:a=!0;break;case this.rightKey:c=!0;break;case this.upKey:h=!0;break;case this.downKey:p=!0;break;case this.fastKey:n=!0;break}switch(A){case this.fastKey:case this.forwardKey:case this.backKey:case this.leftKey:case this.rightKey:case this.upKey:case this.downKey:y.stopPropagation(),y.preventDefault()}(s||o||a||c||h||p||n)&&(this.minDistance=.01,this.maxDistance=.01,v.set(0,0,-1,0).applyMatrix4(e.matrixWorld),this.target.copy(e.position).addScaledVector(v,.01),M===-1&&(this.dispatchEvent(qe),ie.getDelta(),se()))},ae=y=>{const A=y.key.toLowerCase();switch(A){case this.fastKey:case this.forwardKey:case this.backKey:case this.leftKey:case this.rightKey:case this.upKey:case this.downKey:y.stopPropagation(),y.preventDefault()}switch(A){case this.forwardKey:s=!1;break;case this.backKey:o=!1;break;case this.leftKey:a=!1;break;case this.rightKey:c=!1;break;case this.upKey:h=!1;break;case this.downKey:p=!1;break;case this.fastKey:n=!1;break}s||o||a||c||h||p||n||ne()},re=()=>{ne()};this.blurCallback=re,this.keyDownCallback=oe,this.keyUpCallback=ae,this.disableShiftKeyCallback=t,this.domElement.addEventListener("blur",re),this.domElement.addEventListener("keydown",oe),this.domElement.addEventListener("keyup",ae)}dispose(){super.dispose(),this.domElement.removeEventListener("blur",this.blurCallback),this.domElement.removeEventListener("keydown",this.keyDownCallback),this.domElement.removeEventListener("keyup",this.keyUpCallback),this.domElement.removeEventListener("pointerdown",this.disableShiftKeyCallback)}}const fe=0,Qe=1,ge=2,we=window.location.hash.replace(/^#/,""),O=new URLSearchParams(window.location.search);let f,U,B,m,l,H,D,T,z,u,K,F,b,g,V,_,J,P,S,w,N,L,C,x,G;const r={enableUpdate:!0,raycast:R.ColorModes.NONE,enableCacheDisplay:!1,enableRendererStats:!1,orthographic:!1,errorTarget:6,maxDepth:15,displayActiveTiles:!1,resolutionScale:1,up:O.get("up")??we?"+Z":"+Y",enableDebug:!0,displayParentBounds:!1,displayBoxBounds:!1,displaySphereBounds:!1,displayRegionBounds:!1,colorMode:O.get("colorMode")in R.ColorModes?R.ColorModes[O.get("colorMode")]:R.ColorModes.NONE,unlit:!!O.get("unlit"),showThirdPerson:!1,showSecondView:!1,reload:be};Je();xe();function be(){const d=we||"../../data/tileset.json";l&&(C.remove(l.group),l.dispose());const e=new Fe;e.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const i=new We;i.setTranscoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/basis/"),i.detectSupport(m),l=new Te(d),l.registerPlugin(new Ye),l.registerPlugin(new Se({rtc:!0,dracoLoader:e,ktxLoader:i})),l.fetchOptions.mode="cors",C.add(l.group);const t=new R;l.registerPlugin(t),t.customColorCallback=(n,s)=>{const a=n.internal.depth%2===0?16711680:16777215;s.traverse(c=>{c.isMesh&&c.material.color.set(a)})}}function Je(){B=new Ae,m=new j({antialias:!0}),m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.setClearColor(1383455),document.body.appendChild(m.domElement),m.domElement.tabIndex=1,f=new Y(60,window.innerWidth/window.innerHeight,1,1e4),f.position.set(400,400,400),H=new Z(f),B.add(H),g=new Le,V=new Z(g),B.add(V),b=new Y(60,window.innerWidth/window.innerHeight,1,4e3),b.position.set(400,400,-400),b.lookAt(0,0,0),u=new j({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.setClearColor(1383455),document.body.appendChild(u.domElement),u.domElement.style.position="absolute",u.domElement.style.right="0",u.domElement.style.top="0",u.domElement.style.outline="#0f1416 solid 2px",u.domElement.tabIndex=1,F=new Q(b,u.domElement),F.screenSpacePanning=!1,F.minDistance=1,F.maxDistance=5e3,K=new Z(b),B.add(K),D=new Y(60,window.innerWidth/window.innerHeight,1,4e3),D.position.set(50,40,40),D.lookAt(0,0,0),T=new j({antialias:!0}),T.setPixelRatio(window.devicePixelRatio),T.setSize(window.innerWidth,window.innerHeight),T.setClearColor(988182),document.body.appendChild(T.domElement),T.domElement.style.position="fixed",T.domElement.style.left="5px",T.domElement.style.bottom="5px",T.domElement.tabIndex=1,z=new Q(D,T.domElement),z.screenSpacePanning=!1,z.minDistance=1,z.maxDistance=5e3,U=new Q(f,m.domElement),U.screenSpacePanning=!1,U.minDistance=1,U.maxDistance=5e3;const d=new Me(16777215,4);d.position.set(1,2,3),B.add(d);const e=new Re(16777215,.2);B.add(e),_=new Ie,J=new Ue,L=new q,B.add(L),C=new q,L.add(C),P=new He,S=new ee,w=new q;const i=new Ke({color:15277667}),t=new le(new Ve(.25,.25,6),i);t.rotation.x=Math.PI/2,t.position.z+=3,w.add(t);const n=new le(new Ne(1.5,.2,16,100),i);w.add(n),B.add(w),w.visible=!1,be(),W(),window.addEventListener("resize",W,!1),m.domElement.addEventListener("pointermove",he,!1),m.domElement.addEventListener("pointerdown",ue,!1),m.domElement.addEventListener("pointerup",me,!1),m.domElement.addEventListener("pointerleave",de,!1),u.domElement.addEventListener("pointermove",he,!1),u.domElement.addEventListener("pointerdown",ue,!1),u.domElement.addEventListener("pointerup",me,!1),u.domElement.addEventListener("pointerleave",de,!1);const s=new _e;s.width=300;const o=s.addFolder("Tiles Options");o.add(r,"displayActiveTiles"),o.add(r,"errorTarget").min(0).max(50),o.add(r,"maxDepth").min(1).max(100),o.add(r,"up",["+Y","+Z","-Z"]),o.open();const a=s.addFolder("Debug Options");a.add(r,"enableDebug"),a.add(r,"displayParentBounds"),a.add(r,"displayBoxBounds"),a.add(r,"displaySphereBounds"),a.add(r,"displayRegionBounds"),a.add(r,"colorMode",R.ColorModes),a.add(r,"unlit"),a.open();const c=s.addFolder("Example Options");c.add(r,"resolutionScale").min(.01).max(2).step(.01).onChange(W),c.add(r,"orthographic"),c.add(r,"showThirdPerson"),c.add(r,"showSecondView").onChange(W),c.add(r,"enableUpdate").onChange(h=>{l.parseQueue.autoUpdate=h,l.downloadQueue.autoUpdate=h,h&&(l.parseQueue.scheduleJobRun(),l.downloadQueue.scheduleJobRun())}),c.add(r,"raycast",{NONE:fe,ALL_HITS:Qe,FIRST_HIT_ONLY:ge}),c.add(r,"enableCacheDisplay"),c.add(r,"enableRendererStats"),c.open(),s.add(r,"reload"),s.open(),x=document.createElement("div"),x.style.position="absolute",x.style.top=0,x.style.left=0,x.style.color="white",x.style.width="100%",x.style.textAlign="center",x.style.padding="5px",x.style.pointerEvents="none",x.style.lineHeight="1.5em",document.body.appendChild(x),G=new Ge,G.showPanel(0),document.body.appendChild(G.dom)}function W(){D.aspect=window.innerWidth/window.innerHeight,D.updateProjectionMatrix(),T.setSize(Math.floor(window.innerWidth/3),Math.floor(window.innerHeight/3)),r.showSecondView?(f.aspect=.5*window.innerWidth/window.innerHeight,m.setSize(.5*window.innerWidth,window.innerHeight),b.aspect=.5*window.innerWidth/window.innerHeight,u.setSize(.5*window.innerWidth,window.innerHeight),u.domElement.style.display="block"):(f.aspect=window.innerWidth/window.innerHeight,m.setSize(window.innerWidth,window.innerHeight),u.domElement.style.display="none"),f.updateProjectionMatrix(),m.setPixelRatio(window.devicePixelRatio*r.resolutionScale),b.updateProjectionMatrix(),u.setPixelRatio(window.devicePixelRatio),ve()}function de(d){N=null}function he(d){const e=this.getBoundingClientRect();S.x=d.clientX-e.x,S.y=d.clientY-e.y,S.x=S.x/e.width*2-1,S.y=-(S.y/e.height)*2+1,N=this}const ye=new ee,pe=new ee;function ue(d){const e=this.getBoundingClientRect();ye.set(d.clientX-e.x,d.clientY-e.y)}function me(d){const e=this.getBoundingClientRect();if(pe.set(d.clientX-e.x,d.clientY-e.y),ye.distanceTo(pe)>2)return;N===u.domElement?P.setFromCamera(S,b):P.setFromCamera(S,r.orthographic?g:f),P.firstHitOnly=!0;const i=P.intersectObject(l.group,!0);if(i.length){const t=i[0].object,n=l.getPluginByName("DEBUG_TILES_PLUGIN").getTileInformationFromActiveObject(t);let s="";for(const o in n){let a=n[o];typeof a=="number"&&(a=Math.floor(a*1e5)/1e5);let c=o;for(;c.length<20;)c+=" ";s+=`${c} : ${a}
`}console.log(s)}}function ve(){g.position.copy(f.position),g.rotation.copy(f.rotation);const d=f.position.distanceTo(U.target)/2;let e=window.innerWidth/window.innerHeight;r.showSecondView&&(e*=.5),g.left=-e*d,g.right=e*d,g.bottom=-d,g.top=d,g.near=f.near,g.far=f.far,g.updateProjectionMatrix()}function xe(){requestAnimationFrame(xe),l.errorTarget=r.errorTarget,l.displayActiveTiles=r.displayActiveTiles,l.maxDepth=r.maxDepth;const d=l.getPluginByName("DEBUG_TILES_PLUGIN");if(d.enabled=r.enableDebug,d.displayBoxBounds=r.displayBoxBounds,d.displayParentBounds=r.displayParentBounds,d.displaySphereBounds=r.displaySphereBounds,d.displayRegionBounds=r.displayRegionBounds,d.colorMode=parseFloat(r.colorMode),d.unlit=r.unlit,r.orthographic?(l.deleteCamera(f),l.setCamera(g),l.setResolutionFromRenderer(g,m)):(l.deleteCamera(g),l.setCamera(f),l.setResolutionFromRenderer(f,m)),r.showSecondView?(l.setCamera(b),l.setResolutionFromRenderer(b,u)):l.deleteCamera(b),l.root&&l.root.boundingVolume.region&&(l.getOrientedBoundingBox(_,C.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale),C.position.set(0,0,0),C.quaternion.invert(),C.scale.set(1,1,1)),L.rotation.set(0,0,0),r.up==="-Z"?L.rotation.x=Math.PI/2:r.up==="+Z"&&(L.rotation.x=-Math.PI/2),L.updateMatrixWorld(!1),l.getBoundingBox(_)?(_.getCenter(l.group.position),l.group.position.multiplyScalar(-1)):l.getBoundingSphere(J)&&(l.group.position.copy(J.center),l.group.position.multiplyScalar(-1)),parseFloat(r.raycast)!==fe&&N!==null){N===m.domElement?P.setFromCamera(S,r.orthographic?g:f):P.setFromCamera(S,b),P.firstHitOnly=parseFloat(r.raycast)===ge;const e=P.intersectObject(l.group,!0);if(e.length){const i=e[0],t=i.point;if(w.position.copy(t),i.face){const n=i.face.normal;n.transformDirection(i.object.matrixWorld),w.lookAt(t.x+n.x,t.y+n.y,t.z+n.z)}w.visible=!0}else w.visible=!1}else w.visible=!1;window.tiles=l,r.enableUpdate&&(b.updateMatrixWorld(),f.updateMatrixWorld(),g.updateMatrixWorld(),l.update()),et(),G.update()}function et(){if(ve(),H.visible=!1,V.visible=!1,K.visible=!1,r.orthographic){const i=g.position.distanceTo(w.position);w.scale.setScalar(i/150)}else{const i=f.position.distanceTo(w.position);w.scale.setScalar(i*f.fov/6e3)}if(m.render(B,r.orthographic?g:f),r.showSecondView){const i=b.position.distanceTo(w.position);w.scale.setScalar(i*b.fov/6e3),u.render(B,b)}if(T.domElement.style.visibility=r.showThirdPerson?"visible":"hidden",r.showThirdPerson){H.update(),H.visible=!r.orthographic,V.update(),V.visible=r.orthographic,r.showSecondView&&(K.update(),K.visible=!0);const i=D.position.distanceTo(w.position);w.scale.setScalar(i*D.fov/6e3),T.render(B,D)}const d=l.lruCache.itemList.length/l.lruCache.maxSize;let e=`Queued: ${l.stats.queued} Downloading: ${l.stats.downloading} Parsing: ${l.stats.parsing} Visible: ${l.visibleTiles.size}`;if(r.enableCacheDisplay){const i=new Set;l.traverse(n=>{const s=n.cached.scene;s&&s.traverse(o=>{o.geometry&&i.add(o.geometry)})});let t=0;i.forEach(n=>{t+=ze(n)}),e+=`<br/>Cache: ${(100*d).toFixed(2)}% ~${(t/1e3/1e3).toFixed(2)}mb`}if(r.enableRendererStats){const i=m.info.memory,t=m.info.programs.length;e+=`<br/>Geometries: ${i.geometries} Textures: ${i.textures} Programs: ${t}`}x.innerHTML!==e&&(x.innerHTML=e)}
//# sourceMappingURL=index-DhxKIsaL.js.map
