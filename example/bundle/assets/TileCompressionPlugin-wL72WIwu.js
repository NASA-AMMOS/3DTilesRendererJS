import{J as M,ao as I,M as z,o as w}from"./three.module-D-uF--xd.js";const S=new w;function A(t,o){if(t.isInterleavedBufferAttribute||t.array instanceof o)return t;const f=o===Int8Array||o===Int16Array||o===Int32Array?-1:0,s=new o(t.count*t.itemSize),y=new I(s,t.itemSize,!0),d=t.itemSize,v=t.count;for(let c=0;c<v;c++)for(let i=0;i<d;i++){const u=z.clamp(t.getComponent(c,i),f,1);y.setComponent(c,i,u)}return y}function B(t,o=Int16Array){const x=t.geometry,f=x.attributes,s=f.position;if(s.isInterleavedBufferAttribute||s.array instanceof o)return s;const y=new o(s.count*s.itemSize),d=new I(y,s.itemSize,!1),v=s.itemSize,c=s.count;x.computeBoundingBox();const i=x.boundingBox,{min:u,max:g}=i,r=2**(8*o.BYTES_PER_ELEMENT-1)-1,a=-r;for(let n=0;n<c;n++)for(let e=0;e<v;e++){const l=e===0?"x":e===1?"y":"z",m=u[l],p=g[l],b=z.mapLinear(s.getComponent(n,e),m,p,a,r);d.setComponent(n,e,b)}i.getCenter(S).multiply(t.scale).applyQuaternion(t.quaternion),t.position.add(S),t.scale.x*=.5*(g.x-u.x)/r,t.scale.y*=.5*(g.y-u.y)/r,t.scale.z*=.5*(g.z-u.z)/r,f.position=d,t.geometry.boundingBox=null,t.geometry.boundingSphere=null,t.updateMatrixWorld()}class N{constructor(o){this._options={generateNormals:!1,disableMipmaps:!0,compressIndex:!0,compressNormals:!1,compressUvs:!1,compressPosition:!1,uvType:Int8Array,normalType:Int8Array,positionType:Int16Array,...o},this.name="TILES_COMPRESSION_PLUGIN",this.priority=-100}processTileModel(o,x){const{generateNormals:f,disableMipmaps:s,compressIndex:y,compressUvs:d,compressNormals:v,compressPosition:c,uvType:i,normalType:u,positionType:g}=this._options;o.traverse(r=>{if(r.material&&s){const a=r.material;for(const n in a){const e=a[n];e&&e.isTexture&&e.generateMipmaps&&(e.generateMipmaps=!1,e.minFilter=M)}}if(r.geometry){const a=r.geometry,n=a.attributes;if(d){const{uv:e,uv1:l,uv2:m,uv3:p}=n;e&&(n.uv=A(e,i)),l&&(n.uv1=A(l,i)),m&&(n.uv2=A(m,i)),p&&(n.uv3=A(p,i))}if(f&&!n.normals&&a.computeVertexNormals(),v&&n.normals&&(n.normals=A(n.normals,u)),c&&B(r,g),y&&a.index){const e=n.position.count,l=a.index,m=e>65535?Uint32Array:e>255?Uint16Array:Uint8Array;if(!(l.array instanceof m)){const p=new m(a.index.count);p.set(l.array);const b=new I(p,1);a.setIndex(b)}}}})}}export{N as T};
//# sourceMappingURL=TileCompressionPlugin-wL72WIwu.js.map
