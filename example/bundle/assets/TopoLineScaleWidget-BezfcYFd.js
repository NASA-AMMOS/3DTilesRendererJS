import{g as w,r as j,d as C,j as e}from"./CameraControls-CQWLZjoh.js";import{C as S}from"./CanvasDOMOverlay-Dx1Xg4wU.js";import{o as P,M as G}from"./three.module-D-uF--xd.js";const X=new P,A=new P;function O(i,o,n){const r=X.set(0,0,-n).applyMatrix4(i.projectionMatrix),u=A.set(.01,0,-n).applyMatrix4(i.projectionMatrix);return 1/(Math.abs(r.x-u.x)*o.width*.5/.01)}function h(i){if(i===null)return"--";const o=R(i);return`${parseFloat(o.value.toFixed(2)).toString().replace(/^-/,"- ")}${o.unit}`}function R(i){const o=Math.ceil(Math.log10(Math.abs(i)));let n="m",l=0;switch(G.clamp(o,-6,2)){case 2:n="km",l=3;break;case 1:case 0:case-1:n="m",l=0;break;case-2:n="cm",l=-2;break;case-3:case-4:case-5:n="mm",l=-3;break;case-6:n="Î¼M",l=-6;break;default:throw new Error}return{unit:n,value:i*Math.pow(10,-l)}}function F({invert:i}){const o=w(({get:t})=>t),n=w(({gl:t})=>t),l=w(({pointer:t})=>t),[r,u]=j.useState(null),f=j.useContext(C),d=n.domElement;j.useEffect(()=>{const t=()=>{const s=f&&f.getPluginByName("TOPO_LINES_PLUGIN");if(s){const{pointer:x,camera:c,scene:y,raycaster:b}=o();b.setFromCamera(x,c);const g=b.intersectObject(y)[0];if(g){const E=s.computeTopographicLineInfo(c,g.point),_={metersPerPixel:O(c,s.resolution,g.distance)};i&&(E.value*=-1),u({elevation:E,length:_})}else u(null)}};return d.addEventListener("pointermove",t),d.addEventListener("wheel",t),()=>{d.removeEventListener("pointermove",t),d.removeEventListener("wheel",t)}},[o,d,f,i]);let m=null,M=5,v=null,a=0,p=null;if(r){const t=window.devicePixelRatio,s=r.elevation.alpha<.25?r.elevation.max:r.elevation.min;m=r.elevation.value,M=s.stepInPixels/t,v=s.step;const x=50,c=r.length.metersPerPixel*t,y=x*c;p=10**Math.floor(Math.log10(y)),a=p/c,a*5<x&&(p*=5,a*=5),a*2.5<x&&(p*=2.5,a*=2.5)}const T=e.jsx("div",{style:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden",alignItems:"end",justifyContent:"end",paddingBottom:"0.5em"},children:new Array(10).fill().map((t,s)=>e.jsx("div",{style:{minHeight:"1px",opacity:s===9?1:.5,width:s===9?"15px":"10px",background:"white",marginTop:M}},s))}),L=e.jsxs("div",{style:{display:"flex",overflow:"hidden",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",flexGrow:1,justifyContent:"end"},children:[e.jsx("div",{children:h(v)}),e.jsx("div",{children:h(v*10||null)})]}),T]}),k=e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flexGrow:1},children:h(p)}),e.jsx("div",{children:"len"})]}),e.jsx("div",{style:{height:"2px",borderTop:"1px solid white",borderLeft:"1px solid white",borderRight:"1px solid white",width:a===0?"100%":`${a}px`}})]}),I=e.jsxs("div",{style:{display:"flex",marginTop:"10px"},children:[e.jsx("div",{style:{flexGrow:1},children:h(m)}),e.jsx("div",{children:"el"})]}),D=e.jsx("div",{style:{position:"absolute",left:`${(l.x*.5+.5)*100}%`,top:`${100-(l.y*.5+.5)*100}%`,color:"white",fontSize:"12px",pointerEvents:"none",textShadow:"0px 0px 4px rgba( 0, 0, 0, 0.5 )"},children:e.jsx("div",{style:{transform:"translateX( -50% ) translateY( -125% )"},children:m?h(m):""})});return e.jsxs(S,{children:[D,e.jsxs("div",{style:{padding:"5px",width:"65px",height:"80px",position:"absolute",left:5,bottom:5,background:"rgb( 0, 0, 0, 0.2 )",borderRadius:3,color:"white",display:"flex",flexDirection:"column",fontSize:"12px"},children:[L,I,k]})]})}export{F as T};
//# sourceMappingURL=TopoLineScaleWidget-BezfcYFd.js.map
