import"./modulepreload-polyfill-B5Qt9EMX.js";import{T as G}from"./TilesRenderer-Bm042Xsy.js";import{C as b}from"./Ellipsoid-Dwquuq5w.js";import{G as k}from"./GlobeControls-4ScISV7m.js";import{E as U}from"./EnvironmentControls-BRF5UI-K.js";import{M as E,T as H,W as I,S as j,a as O,d as V,D as q,e as N,E as K}from"./three.module-D-uF--xd.js";import{e as $}from"./GLTFLoader-B4GrkiON.js";import{D as J}from"./DRACOLoader-gn1nzdEq.js";import{K as X}from"./KTX2Loader-CDpjicL9.js";import{G as Q}from"./GLTFExtensionsPlugin-CGSNI2LM.js";import"./TilesRendererBase-CFsQu8zV.js";import"./constants-JFoaxC9y.js";import"./BatchTable-CRr3zuRk.js";import"./B3DMLoader-Cnf0ja_2.js";import"./B3DMLoaderBase-w5mdSgm-.js";import"./PNTSLoader-DwvZQNdL.js";import"./I3DMLoader-BWluRuWb.js";import"./CMPTLoader-BOTrymv0.js";import"./EllipsoidRegion-VNvPMw5b.js";const A=new URLSearchParams(location.search).get("url")||"../../data/tileset.json",z=document.getElementById("three-container"),_=document.getElementById("cesium-container"),p=z.getElementsByClassName("stats")[0],f=_.getElementsByClassName("stats")[0];let r,i,T=!1;(async()=>(await te(),await oe(),window.addEventListener("keydown",e=>{e.key===" "&&document.body.classList.toggle("fullscreen")}),Y(),setInterval(()=>{const{camera:e}=i,{position:t,rotation:s}=e,d=[...t,s.x,s.y,s.z].map(o=>parseFloat(o.toFixed(4)));window.history.replaceState(void 0,void 0,`#${JSON.stringify(d)}`)},100),P()))();function Y(){const e=window.location.hash.replace(/^#/,"");if(!e)return;const[t,s,d,o,c,u]=JSON.parse(unescape(e)),{camera:n}=i;n.position.set(t,s,d),n.rotation.set(o,c,u),T=!0}function P(){requestAnimationFrame(P),window.THREE_DATA=i,window.CESIUM_DATA=r,i.update();const t=i.tiles.ellipsoid.getCartographicFromObjectFrame(i.camera.matrixWorld,{},b);r.camera.frustum.near=i.camera.near,r.camera.frustum.far=i.camera.far,r.camera.frustum.fov=ne(i.camera.fov,i.camera.aspect)*E.DEG2RAD,r.camera.position.x=i.camera.position.x,r.camera.position.y=i.camera.position.y,r.camera.position.z=i.camera.position.z,r.camera.setView({destination:r.position,orientation:{roll:t.roll,pitch:t.elevation,heading:t.azimuth}}),r.update(),Z(),ee()}function Z(){let e,t,s,d,o;t=0,d=0,o=0,i.tiles.forEachLoadedModel((l,y)=>{t++,l.traverse(g=>{const{geometry:F,material:v}=g;if(F){o+=$(g.geometry);for(const B in v){const w=v[B];if(w&&w.isTexture){const{format:S,type:R,image:x}=w,{width:C,height:m}=x;let h=H.getByteLength(C,m,S,R);h*=w.generateMipmaps?4/3:1,d+=h}}}})}),e=0,L(i.root,l=>{if(l.internal&&l.internal.hasRenderableContent&&l.internal.loadingState!==0)return e++,!0}),s=0,L(i.root,(l,y)=>{l.internal&&l.internal.hasContent&&l.internal.loadingState!==0&&s++});const{loadStart:c,loadEnd:u}=i,n=u-c;W(p),a(p,"visible tiles",i.tiles.visibleTiles.size),a(p,"loaded tiles",s),a(p,"loaded geom tiles",t),a(p,"loaded subtree tiles",s-t),a(p,"loaded layer 1 tiles",e),a(p,"total memory",(i.tiles.lruCache.cachedBytes*1e-6).toFixed(3)+" MB"),a(p,"geometry memory",(o*1e-6).toFixed(3)+" MB"),a(p,"texture memory",(d*1e-6).toFixed(3)+" MB"),a(p,"load start",c.toFixed(0)+" ms"),a(p,"load end",n<0?"--":u.toFixed(0)+" ms"),a(p,"load delta",n<0?"--":n.toFixed(0)+" ms"),a(p,"total load time",i.totalLoadTime.toFixed(0)+" ms"),a(p,"perf",(100*i.totalLoadTime/r.totalLoadTime).toFixed(2)+"%")}function ee(){let e,t,s,d;e=0,L(r.root,n=>{if(n._content&&n._content.ready&&n._content._model)return e++,!0}),t=0,d=0,s=0,L(r.root,(n,l)=>{n._content&&n._content.ready&&(l!==0&&t++,n._content._model&&(d+=n._content._model.statistics.geometryByteLength,s+=n._content._model.statistics.texturesByteLength))});const{loadStart:o,loadEnd:c}=r,u=c-o;W(f),a(f,"visible tiles",r.tiles.statistics.selected),a(f,"loaded tiles",t),a(f,"loaded geom tiles",r.tiles.statistics.numberOfTilesWithContentReady),a(f,"loaded subtree tiles",t-r.tiles.statistics.numberOfTilesWithContentReady),a(f,"loaded layer 1 tiles",e),a(f,"total memory",(r.tiles.totalMemoryUsageInBytes*1e-6).toFixed(3)+" MB"),a(f,"geometry memory",(d*1e-6).toFixed(3)+" MB"),a(f,"texture memory",(s*1e-6).toFixed(3)+" MB"),a(f,"load start",o.toFixed(0)+" ms"),a(f,"load end",u<0?"--":c.toFixed(0)+" ms"),a(f,"load delta",u<0?"--":u.toFixed(0)+" ms"),a(f,"total load time",r.totalLoadTime.toFixed(0)+" ms")}async function te(){const e=new I({antialias:!0});e.setClearColor(0),z.appendChild(e.domElement),e.domElement.style.imageRendering="pixelated",e.setPixelRatio(window.devicePixelRatio);const t=new j,s=window.innerWidth/window.innerHeight,d=60,o=new O(M(d,s),s,.1,1e10);o.position.set(-1.3567366495227425e6,529850286925096e-8,3.2711939085458643e6),o.quaternion.set(.27330445532852865,-.4460582045331912,-.821679716911258,.2262281938283491);const c=new J;c.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const u=new X;u.setTranscoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/basis/"),u.detectSupport(e);const n=new G(A);n.registerPlugin(new Q({rtc:!0,dracoLoader:c,ktxLoader:u})),n.preprocessURL=m=>unescape(m),n.lruCache.maxBytesSize=1/0,n.lruCache.minBytesSize=0,n.setResolutionFromRenderer(o,e),n.setCamera(o);let l;n.addEventListener("load-root-tileset",()=>{const m=new V;if(n.getBoundingSphere(m),m.center.distanceTo(o.position)>m.radius*20&&(T=!1),!T){if(T=!0,o.position.copy(m.center),o.position.length()>1e5){const h=m.center.clone().normalize();o.position.addScaledVector(h,m.radius)}else o.position.x+=m.radius,o.position.y+=m.radius,o.position.z+=m.radius;o.lookAt(m.center)}l||(o.position.length()>1e5?(l=new k(t,o,e.domElement,null),l.enableDamping=!0,l.adjustHeight=!1,l.setEllipsoid(n.ellipsoid,n.group)):(l=new U(t,o,e.domElement,null),l.enableDamping=!0,l.adjustHeight=!1))});let y=0;n.addEventListener("tiles-load-start",m=>{y=performance.now(),performance.now()-i.loadEnd>100&&(i.loadStart=y)}),n.addEventListener("tiles-load-end",m=>{i.loadEnd=performance.now(),i.totalLoadTime+=performance.now()-y}),t.add(n.group);const g=new q(16777215,2);g.position.set(1,2,3),t.add(g),t.environment=new N(new Uint8Array(4096*4).fill(255),64,64),t.environment.mapping=K,t.environmentIntensity=1/Math.PI,t.environment.needsUpdate=!0,n.ellipsoid.getObjectFrame(.5419733570174874,1.821470691863346,553.1228538149635,0,-.5000321680050197,0,o.matrixWorld,b).decompose(o.position,o.quaternion,o.scale),x(),window.addEventListener("resize",x,!1),i={totalLoadTime:0,loadStart:0,loadEnd:0,tiles:n,camera:o,renderer:e,scene:t,update:C,get root(){return n.root}};function x(){const h=e.domElement,D=h.clientWidth/h.clientHeight;o.aspect=D,o.fov=M(60,D),o.updateProjectionMatrix(),e.setSize(h.clientWidth,h.clientHeight,!1)}function C(){x(),l&&l.update(),n.setResolutionFromRenderer(o,e),n.setCamera(o),o.updateMatrixWorld(),n.update(),e.render(t,o)}}async function oe(){const e=new Cesium.CesiumWidget(_);e.scene.terrainProvider=!1,e.scene.skyBox.destroy(),e.scene.skyBox=void 0,e.scene.sun.destroy(),e.scene.sun=void 0,e.scene.backgroundColor=Cesium.Color.BLACK.clone(),e.creditDisplay.container.style.display="none";const t=await Cesium.Cesium3DTileset.fromUrl(A,{maximumCacheOverflowBytes:1e20,cacheBytes:0});e.scene.primitives.add(t);const s=e.camera;let d=!1,o=0;t.loadProgress.addEventListener((c,u)=>{const n=c+u;n!==0&&!d?(d=!0,o=performance.now(),o-i.loadEnd>100&&(r.loadStart=o)):n===0&&d&&(d=!1,r.loadEnd=performance.now(),r.totalLoadTime+=performance.now()-o)}),r={totalLoadTime:0,loadStart:0,loadEnd:0,tiles:t,viewer:e,camera:s,scene:e.scene,update:()=>{},get root(){let c=t._selectedTiles[0];for(;c&&c.parent;)c=c.parent;return c||null}}}function W(e){e.innerHTML=""}function a(e,t,s){e.innerHTML+=`<div name="${t}">${s}</div>`}function M(e,t){return E.RAD2DEG*2*Math.atan(Math.tan(E.DEG2RAD*e/2)/t)}function ne(e,t){return t<1?e:E.RAD2DEG*2*Math.atan(Math.tan(E.DEG2RAD*e/2)*t)}function L(e,t,s=0){e&&!t(e,s)&&e.children&&e.children.forEach(d=>{L(d,t,s+1)})}
//# sourceMappingURL=cesiumCompare-CVkeZnoY.js.map
