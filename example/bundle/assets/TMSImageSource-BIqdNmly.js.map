{"version":3,"file":"TMSImageSource-BIqdNmly.js","sources":["../../../src/three/plugins/images/sources/XYZImageSource.js","../../../src/three/plugins/images/sources/TMSImageSource.js"],"sourcesContent":["import { ProjectionScheme } from '../utils/ProjectionScheme.js';\nimport { TiledImageSource } from './TiledImageSource.js';\n\nexport class XYZImageSource extends TiledImageSource {\n\n\tconstructor( options = {} ) {\n\n\t\tconst {\n\t\t\tlevels = 20,\n\t\t\ttileDimension = 256,\n\t\t\tprojection = 'EPSG:3857',\n\t\t\turl = null,\n\t\t\t...rest\n\t\t} = options;\n\n\t\tsuper( rest );\n\n\t\tthis.tileDimension = tileDimension;\n\t\tthis.levels = levels;\n\t\tthis.projection = projection;\n\t\tthis.url = url;\n\n\t}\n\n\tgetUrl( x, y, level ) {\n\n\t\treturn this.url\n\t\t\t.replace( /{\\s*z\\s*}/gi, level )\n\t\t\t.replace( /{\\s*x\\s*}/gi, x )\n\t\t\t.replace( /{\\s*(y|reverseY|-\\s*y)\\s*}/gi, y );\n\n\t}\n\n\tinit() {\n\n\t\t// transform the url\n\t\tconst { tiling, tileDimension, levels, url, projection } = this;\n\t\ttiling.flipY = ! /{\\s*reverseY|-\\s*y\\s*}/g.test( url );\n\t\ttiling.setProjection( new ProjectionScheme( projection ) );\n\t\ttiling.setContentBounds( ...tiling.projection.getBounds() );\n\t\tif ( Array.isArray( levels ) ) {\n\n\t\t\tlevels.forEach( ( info, level ) => {\n\n\t\t\t\tif ( info !== null ) {\n\n\t\t\t\t\ttiling.setLevel( level, {\n\t\t\t\t\t\ttilePixelWidth: tileDimension,\n\t\t\t\t\t\ttilePixelHeight: tileDimension,\n\t\t\t\t\t\t...info\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\ttiling.generateLevels( levels, tiling.projection.tileCountX, tiling.projection.tileCountY, {\n\t\t\t\ttilePixelWidth: tileDimension,\n\t\t\t\ttilePixelHeight: tileDimension,\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.url = url;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n","import { ProjectionScheme } from '../utils/ProjectionScheme.js';\nimport { TiledImageSource } from './TiledImageSource.js';\nimport { MathUtils } from 'three';\n\nexport class TMSImageSource extends TiledImageSource {\n\n\tconstructor( options = {} ) {\n\n\t\tconst {\n\t\t\turl = null,\n\t\t\t...rest\n\t\t} = options;\n\n\t\tsuper( rest );\n\n\t\tthis.tileSets = null;\n\t\tthis.extension = null;\n\t\tthis.url = url;\n\n\t}\n\n\tgetUrl( x, y, level ) {\n\n\t\tconst { url, extension, tileSets, tiling } = this;\n\t\treturn new URL( `${ parseInt( tileSets[ level - tiling.minLevel ].href ) }/${ x }/${ y }.${ extension }`, url ).toString();\n\n\t}\n\n\tinit() {\n\n\t\tconst { url } = this;\n\n\t\treturn this\n\t\t\t.fetchData( new URL( 'tilemapresource.xml', url ), this.fetchOptions )\n\t\t\t.then( res => res.text() )\n\t\t\t.then( text => {\n\n\t\t\t\tconst { tiling } = this;\n\n\t\t\t\t// elements\n\t\t\t\tconst xml = new DOMParser().parseFromString( text, 'text/xml' );\n\t\t\t\tconst boundingBox = xml.querySelector( 'BoundingBox' );\n\t\t\t\tconst tileFormat = xml.querySelector( 'TileFormat' );\n\t\t\t\tconst tileSets = xml.querySelector( 'TileSets' ).querySelectorAll( 'TileSet' );\n\n\t\t\t\t// tileset definitions\n\t\t\t\tconst tileSetList = [ ...tileSets ]\n\t\t\t\t\t.map( ts => ( {\n\t\t\t\t\t\thref: parseInt( ts.getAttribute( 'href' ) ),\n\t\t\t\t\t\tunitsPerPixel: parseFloat( ts.getAttribute( 'units-per-pixel' ) ),\n\t\t\t\t\t\torder: parseInt( ts.getAttribute( 'order' ) ),\n\t\t\t\t\t} ) )\n\t\t\t\t\t.sort( ( a, b ) => {\n\n\t\t\t\t\t\treturn a.order - b.order;\n\n\t\t\t\t\t} );\n\n\t\t\t\t// bounding box\n\t\t\t\tconst minX = parseFloat( boundingBox.getAttribute( 'minx' ) ) * MathUtils.DEG2RAD;\n\t\t\t\tconst maxX = parseFloat( boundingBox.getAttribute( 'maxx' ) ) * MathUtils.DEG2RAD;\n\t\t\t\tconst minY = parseFloat( boundingBox.getAttribute( 'miny' ) ) * MathUtils.DEG2RAD;\n\t\t\t\tconst maxY = parseFloat( boundingBox.getAttribute( 'maxy' ) ) * MathUtils.DEG2RAD;\n\n\t\t\t\t// origin in lat / lon\n\t\t\t\t// Note: The \"origin\" value in TMS is documented but otherwise not used in any data set as\n\t\t\t\t// defined by the spec so ignore it here.\n\t\t\t\t// const origin = xml.querySelector( 'Origin' );\n\t\t\t\t// const originX = parseFloat( origin.getAttribute( 'x' ) ) * MathUtils.DEG2RAD;\n\t\t\t\t// const originY = parseFloat( origin.getAttribute( 'y' ) ) * MathUtils.DEG2RAD;\n\n\t\t\t\t// image dimensions in pixels\n\t\t\t\tconst tileWidth = parseInt( tileFormat.getAttribute( 'width' ) );\n\t\t\t\tconst tileHeight = parseInt( tileFormat.getAttribute( 'height' ) );\n\t\t\t\tconst extension = tileFormat.getAttribute( 'extension' );\n\t\t\t\tconst srs = xml.querySelector( 'SRS' ).textContent;\n\n\t\t\t\t// assign settings\n\t\t\t\tthis.extension = extension;\n\t\t\t\tthis.url = url;\n\t\t\t\tthis.tileSets = tileSetList;\n\n\t\t\t\t// initialize tiling and projection schemes\n\t\t\t\ttiling.setProjection( new ProjectionScheme( srs ) );\n\t\t\t\ttiling.setContentBounds( minX, minY, maxX, maxY );\n\n\t\t\t\ttileSetList.forEach( ( { order } ) => {\n\n\t\t\t\t\ttiling.setLevel( order, {\n\t\t\t\t\t\ttileCountX: tiling.projection.tileCountX * 2 ** order,\n\t\t\t\t\t\ttilePixelWidth: tileWidth,\n\t\t\t\t\t\ttilePixelHeight: tileHeight,\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t}\n\n}\n"],"names":["XYZImageSource","TiledImageSource","options","levels","tileDimension","projection","url","rest","x","y","level","tiling","ProjectionScheme","info","TMSImageSource","extension","tileSets","res","text","xml","boundingBox","tileFormat","tileSetList","ts","a","b","minX","MathUtils","maxX","minY","maxY","tileWidth","tileHeight","srs","order"],"mappings":"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"}