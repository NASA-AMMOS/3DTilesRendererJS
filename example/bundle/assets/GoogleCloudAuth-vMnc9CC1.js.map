{"version":3,"file":"GoogleCloudAuth-vMnc9CC1.js","sources":["../../../src/core/plugins/GoogleAttributionsManager.js","../../../src/core/plugins/GoogleCloudAuthPlugin.js","../../../src/core/plugins/CesiumIonAuthPlugin.js","../../../src/core/plugins/auth/GoogleCloudAuth.js"],"sourcesContent":["export class GoogleAttributionsManager {\n\n\tconstructor() {\n\n\t\tthis.creditsCount = {};\n\n\t}\n\n\t_adjustAttributions( line, add ) {\n\n\t\tconst creditsCount = this.creditsCount;\n\t\tconst tokens = line.split( /;/g );\n\t\tfor ( let i = 0, l = tokens.length; i < l; i ++ ) {\n\n\t\t\tconst t = tokens[ i ];\n\t\t\tif ( ! ( t in creditsCount ) ) {\n\n\t\t\t\tcreditsCount[ t ] = 0;\n\n\t\t\t}\n\n\t\t\tcreditsCount[ t ] += add ? 1 : - 1;\n\n\t\t\tif ( creditsCount[ t ] <= 0 ) {\n\n\t\t\t\tdelete creditsCount[ t ];\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\taddAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, true );\n\n\t}\n\n\tremoveAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, false );\n\n\t}\n\n\ttoString() {\n\n\t\t// attribution guidelines: https://developers.google.com/maps/documentation/tile/create-renderer#display-attributions\n\n\t\tconst sortedByCount = Object.entries( this.creditsCount ).sort( ( a, b ) => {\n\n\t\t\tconst countA = a[ 1 ];\n\t\t\tconst countB = b[ 1 ];\n\t\t\treturn countB - countA; // Descending order\n\n\t\t} );\n\n\t\treturn sortedByCount.map( pair => pair[ 0 ] ).join( '; ' );\n\n\t}\n\n}\n","import { GoogleCloudAuth } from '3d-tiles-renderer/core/plugins';\nimport { GoogleAttributionsManager } from './GoogleAttributionsManager.js';\n\nconst TILES_3D_API = 'https://tile.googleapis.com/v1/3dtiles/root.json';\n\nexport class GoogleCloudAuthPlugin {\n\n\tconstructor( {\n\t\tapiToken,\n\t\tsessionOptions = null,\n\t\tautoRefreshToken = false,\n\t\tlogoUrl = null,\n\t\tuseRecommendedSettings = true,\n\t} ) {\n\n\t\tthis.name = 'GOOGLE_CLOUD_AUTH_PLUGIN';\n\n\t\tthis.apiToken = apiToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.logoUrl = logoUrl;\n\n\t\tthis.auth = new GoogleCloudAuth( { apiToken, autoRefreshToken, sessionOptions } );\n\t\tthis.tiles = null;\n\n\t\tthis._visibilityChangeCallback = null;\n\t\tthis._attributionsManager = new GoogleAttributionsManager();\n\t\tthis._logoAttribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'image',\n\t\t\tcollapsible: false,\n\t\t};\n\t\tthis._attribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'string',\n\t\t\tcollapsible: true,\n\t\t};\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tconst { useRecommendedSettings, auth } = this;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t\tif ( tiles.rootURL == null ) {\n\n\t\t\ttiles.rootURL = TILES_3D_API;\n\n\t\t}\n\n\t\tif ( ! auth.sessionOptions ) {\n\n\t\t\tauth.authURL = tiles.rootURL;\n\n\t\t}\n\n\t\tif ( useRecommendedSettings && ! auth.isMapTilesSession ) {\n\n\t\t\t// This plugin changes below values to be more efficient for the photorealistic tiles\n\t\t\ttiles.errorTarget = 20;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\n\t\tthis._visibilityChangeCallback = ( { tile, visible } ) => {\n\n\t\t\tconst copyright = tile.engineData.metadata?.asset?.copyright || '';\n\t\t\tif ( visible ) {\n\n\t\t\t\tthis._attributionsManager.addAttributions( copyright );\n\n\t\t\t} else {\n\n\t\t\t\tthis._attributionsManager.removeAttributions( copyright );\n\n\t\t\t}\n\n\t\t};\n\n\t\ttiles.addEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\tif ( this.logoUrl ) {\n\n\t\t\t\tthis._logoAttribution.value = this.logoUrl;\n\t\t\t\ttarget.push( this._logoAttribution );\n\n\t\t\t}\n\n\t\t\tthis._attribution.value = this._attributionsManager.toString();\n\t\t\ttarget.push( this._attribution );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.tiles.removeEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tasync fetchData( uri, options ) {\n\n\t\treturn this.auth.fetch( uri, options );\n\n\t}\n\n}\n","import { CesiumIonAuth } from './auth/CesiumIonAuth.js';\nimport { GoogleCloudAuthPlugin } from './GoogleCloudAuthPlugin.js';\n\nexport class CesiumIonAuthPlugin {\n\n\tget apiToken() {\n\n\t\treturn this.auth.apiToken;\n\n\t}\n\n\tset apiToken( v ) {\n\n\t\tthis.auth.apiToken = v;\n\n\t}\n\n\tget autoRefreshToken() {\n\n\t\treturn this.auth.autoRefreshToken;\n\n\t}\n\n\tset autoRefreshToken( v ) {\n\n\t\tthis.auth.autoRefreshToken = v;\n\n\t}\n\n\tconstructor( options = {} ) {\n\n\t\tconst {\n\t\t\tapiToken,\n\t\t\tassetId = null,\n\t\t\tautoRefreshToken = false,\n\t\t\tuseRecommendedSettings = true,\n\t\t\tassetTypeHandler = ( type, tiles, asset ) => {\n\n\t\t\t\tconsole.warn( `CesiumIonAuthPlugin: Cesium Ion asset type \"${ type }\" unhandled.` );\n\n\t\t\t},\n\t\t} = options;\n\n\t\tthis.name = 'CESIUM_ION_AUTH_PLUGIN';\n\t\tthis.auth = new CesiumIonAuth( { apiToken, autoRefreshToken } );\n\n\t\tthis.assetId = assetId;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.assetTypeHandler = assetTypeHandler;\n\t\tthis.tiles = null;\n\n\t\tthis._tileSetVersion = - 1;\n\t\tthis._attributions = [];\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tif ( this.assetId !== null ) {\n\n\t\t\ttiles.rootURL = `https://api.cesium.com/v1/assets/${ this.assetId }/endpoint`;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\t\tthis.auth.authURL = tiles.rootURL;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t}\n\n\tloadRootTileset() {\n\n\t\t// ensure we have an up-to-date token and root url, then trigger the internal\n\t\t// root tileset load function\n\t\treturn this\n\t\t\t.auth\n\t\t\t.refreshToken()\n\t\t\t.then( json => {\n\n\t\t\t\tthis._initializeFromAsset( json );\n\t\t\t\treturn this.tiles.invokeOnePlugin( plugin => plugin !== this && plugin.loadRootTileset && plugin.loadRootTileset() );\n\n\t\t\t} )\n\t\t\t.catch( error => {\n\n\t\t\t\tthis.tiles.dispatchEvent( {\n\t\t\t\t\ttype: 'load-error',\n\t\t\t\t\ttile: null,\n\t\t\t\t\terror,\n\t\t\t\t\turl: this.auth.authURL,\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t}\n\n\tpreprocessURL( uri ) {\n\n\t\turi = new URL( uri );\n\t\tif ( /^http/.test( uri.protocol ) && this._tileSetVersion != - 1 ) {\n\n\t\t\turi.searchParams.set( 'v', this._tileSetVersion );\n\n\t\t}\n\n\t\treturn uri.toString();\n\n\t}\n\n\tfetchData( uri, options ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( tiles.getPluginByName( 'GOOGLE_CLOUD_AUTH_PLUGIN' ) !== null ) {\n\n\t\t\treturn null;\n\n\t\t} else {\n\n\t\t\treturn this.auth.fetch( uri, options );\n\n\t\t}\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\ttarget.push( ...this._attributions );\n\n\t\t}\n\n\t}\n\n\t_initializeFromAsset( json ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( 'externalType' in json ) {\n\n\t\t\tconst url = new URL( json.options.url );\n\t\t\ttiles.rootURL = json.options.url;\n\n\t\t\t// if the tileset is \"external\" then assume it's a google API tileset\n\t\t\ttiles.registerPlugin( new GoogleCloudAuthPlugin( {\n\t\t\t\tapiToken: url.searchParams.get( 'key' ),\n\t\t\t\tautoRefreshToken: this.autoRefreshToken,\n\t\t\t\tuseRecommendedSettings: this.useRecommendedSettings,\n\t\t\t} ) );\n\n\t\t} else {\n\n\t\t\t// fire callback for unhandled asset types\n\t\t\tif ( json.type !== '3DTILES' ) {\n\n\t\t\t\t// Other types include:\n\t\t\t\t// - GLTF\n\t\t\t\t// - CZML\n\t\t\t\t// - KML\n\t\t\t\t// - GEOJSON\n\t\t\t\t// - TERRAIN (QuantizedMesh)\n\t\t\t\t// - IMAGERY (TSM Tiles)\n\n\t\t\t\tthis.assetTypeHandler( json.type, tiles, json );\n\n\t\t\t}\n\n\t\t\ttiles.rootURL = json.url;\n\n\t\t\t// save the version key if present\n\t\t\tconst url = new URL( json.url );\n\t\t\tif ( url.searchParams.has( 'v' ) && this._tileSetVersion === - 1 ) {\n\n\t\t\t\tthis._tileSetVersion = url.searchParams.get( 'v' );\n\n\t\t\t}\n\n\t\t\tif ( json.attributions ) {\n\n\t\t\t\tthis._attributions = json.attributions.map( att => ( {\n\t\t\t\t\tvalue: att.html,\n\t\t\t\t\ttype: 'html',\n\t\t\t\t\tcollapsible: att.collapsible,\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n","import { TraversalUtils } from '3d-tiles-renderer/core';\n\nconst TILES_MAP_URL = 'https://tile.googleapis.com/v1/createSession';\n\n// Class for making fetches to Google Cloud, refreshing the token if needed.\n// Supports both the 2d map tiles API in addition to 3d tiles.\nexport class GoogleCloudAuth {\n\n\tget isMapTilesSession() {\n\n\t\treturn this.authURL === TILES_MAP_URL;\n\n\t}\n\n\tconstructor( options = {} ) {\n\n\t\tconst { apiToken, sessionOptions = null, autoRefreshToken = false } = options;\n\t\tthis.apiToken = apiToken;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.authURL = TILES_MAP_URL;\n\t\tthis.sessionToken = null;\n\t\tthis.sessionOptions = sessionOptions;\n\t\tthis._tokenRefreshPromise = null;\n\n\t}\n\n\tasync fetch( url, options ) {\n\n\t\t// if we're using a map tiles session then we have to refresh the token separately\n\t\tif ( this.sessionToken === null && this.isMapTilesSession ) {\n\n\t\t\tthis.refreshToken( options );\n\n\t\t}\n\n\t\tawait this._tokenRefreshPromise;\n\n\t\t// construct the url\n\t\tconst fetchUrl = new URL( url );\n\t\tfetchUrl.searchParams.set( 'key', this.apiToken );\n\t\tif ( this.sessionToken ) {\n\n\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t}\n\n\t\t// try to refresh the session token if we failed to load it\n\t\tlet res = await fetch( fetchUrl, options );\n\t\tif ( res.status >= 400 && res.status <= 499 && this.autoRefreshToken ) {\n\n\t\t\t// refresh the session token\n\t\t\tawait this.refreshToken( options );\n\t\t\tif ( this.sessionToken ) {\n\n\t\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t\t}\n\n\t\t\tres = await fetch( fetchUrl, options );\n\n\t\t}\n\n\t\tif ( this.sessionToken === null && ! this.isMapTilesSession ) {\n\n\t\t\t// if we're using a 3d tiles session then we get the session key in the first request\n\t\t\treturn res\n\t\t\t\t.json()\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn res;\n\n\t\t}\n\n\t}\n\n\trefreshToken( options ) {\n\n\t\tif ( this._tokenRefreshPromise === null ) {\n\n\t\t\t// construct the url to fetch the endpoint\n\t\t\tconst url = new URL( this.authURL );\n\t\t\turl.searchParams.set( 'key', this.apiToken );\n\n\t\t\t// initialize options for map tiles\n\t\t\tconst fetchOptions = { ...options };\n\t\t\tif ( this.isMapTilesSession ) {\n\n\t\t\t\tfetchOptions.method = 'POST';\n\t\t\t\tfetchOptions.body = JSON.stringify( this.sessionOptions );\n\t\t\t\tfetchOptions.headers = fetchOptions.headers || {};\n\t\t\t\tfetchOptions.headers = {\n\t\t\t\t\t...fetchOptions.headers,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis._tokenRefreshPromise = fetch( url, fetchOptions )\n\t\t\t\t.then( res => {\n\n\t\t\t\t\tif ( ! res.ok ) {\n\n\t\t\t\t\t\tthrow new Error( `GoogleCloudAuth: Failed to load data with error code ${ res.status }` );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res.json();\n\n\t\t\t\t} )\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\tthis._tokenRefreshPromise = null;\n\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\treturn this._tokenRefreshPromise;\n\n\t}\n\n}\n\n// Takes a json response from the auth url and extracts the session token\nfunction getSessionToken( json ) {\n\n\tif ( 'session' in json ) {\n\n\t\t// if using the 2d maps api\n\t\treturn json.session;\n\n\t} else {\n\n\t\t// is using the 3d tiles api\n\t\tlet sessionToken = null;\n\t\tconst root = json.root;\n\t\tTraversalUtils.traverseSet( root, tile => {\n\n\t\t\tif ( tile.content && tile.content.uri ) {\n\n\t\t\t\tconst [ , params ] = tile.content.uri.split( '?' );\n\t\t\t\tsessionToken = new URLSearchParams( params ).get( 'session' );\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t} );\n\n\t\treturn sessionToken;\n\n\t}\n\n}\n\n"],"names":["GoogleAttributionsManager","line","add","creditsCount","tokens","i","l","t","a","b","countA","pair","TILES_3D_API","GoogleCloudAuthPlugin","apiToken","sessionOptions","autoRefreshToken","logoUrl","useRecommendedSettings","GoogleCloudAuth","tiles","auth","tile","visible","copyright","_b","_a","target","uri","options","CesiumIonAuthPlugin$1","v","assetId","assetTypeHandler","type","asset","CesiumIonAuth","json","plugin","error","url","att","TILES_MAP_URL","fetchUrl","res","getSessionToken","fetchOptions","sessionToken","root","TraversalUtils.traverseSet","params"],"mappings":"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"}