{"version":3,"file":"quantMeshOverlays-BSfvCwpZ.js","sources":["../../quantMeshOverlays.js"],"sourcesContent":["import {\n\tGlobeControls,\n\tTilesRenderer,\n} from '3d-tiles-renderer';\nimport {\n\tTilesFadePlugin,\n\tCesiumIonAuthPlugin,\n\tImageOverlayPlugin,\n\tCesiumIonOverlay,\n\tXYZTilesOverlay,\n} from '3d-tiles-renderer/plugins';\nimport {\n\tScene,\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tAmbientLight,\n\tDirectionalLight,\n} from 'three';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport Stats from 'three/examples/jsm/libs/stats.module.js';\n\nlet controls, scene, renderer, tiles, camera, washingtonOverlay, baseOverlay;\nlet statsContainer, stats;\n\nconst params = {\n\tenableCacheDisplay: false,\n\tenableRendererStats: false,\n\tenableTileSplitting: true,\n\tmapBase: false,\n\terrorTarget: 2,\n\topacity: 1.0,\n\tcolor: '#ffffff',\n\n\tbaseOpacity: 1.0,\n\tbaseColor: '#ffffff',\n\n\treload: reinstantiateTiles,\n};\n\ninit();\nanimate();\n\nfunction reinstantiateTiles() {\n\n\tif ( tiles ) {\n\n\t\tscene.remove( tiles.group );\n\t\ttiles.dispose();\n\t\ttiles = null;\n\n\t}\n\n\twashingtonOverlay = new CesiumIonOverlay( {\n\t\topacity: params.layerOpacity,\n\t\tassetId: '3827',\n\t\tapiToken: import.meta.env.VITE_ION_KEY,\n\t} );\n\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new CesiumIonAuthPlugin( { apiToken: import.meta.env.VITE_ION_KEY, assetId: '1', autoRefreshToken: true } ) );\n\ttiles.registerPlugin( new TilesFadePlugin() );\n\ttiles.registerPlugin( new ImageOverlayPlugin( {\n\t\trenderer,\n\t\toverlays: [ washingtonOverlay ],\n\t} ) );\n\n\tupdateBaseOverlay();\n\n\ttiles.group.rotation.x = - Math.PI / 2;\n\tscene.add( tiles.group );\n\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.setCamera( camera );\n\n\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\n}\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setClearColor( 0x151c1f );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene\n\tscene = new Scene();\n\n\t// camera set up\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 160000000 );\n\tcamera.position.set( 1150000, 3920000, 4980000 );\n\tcamera.rotation.set( 0.381, 0.202, - 0.090 );\n\n\t// lights\n\tconst ambientLight = new AmbientLight( 0xffffff, 0.25 );\n\tconst dirLight = new DirectionalLight( 0xffffff, 3 );\n\tdirLight.position.set( 1, 1, 1 );\n\tcamera.add( ambientLight, dirLight, dirLight.target );\n\tscene.add( camera );\n\n\t// controls\n\tcontrols = new GlobeControls( scene, camera, renderer.domElement, null );\n\tcontrols.enableDamping = true;\n\n\t// initialize tiles\n\treinstantiateTiles();\n\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t// GUI\n\tconst gui = new GUI();\n\tgui.width = 300;\n\tgui.add( params, 'enableCacheDisplay' );\n\tgui.add( params, 'enableRendererStats' );\n\tgui.add( params, 'enableTileSplitting' );\n\tgui.add( params, 'mapBase' ).name( 'OpenStreetMap' ).onChange( updateBaseOverlay );\n\tgui.add( params, 'errorTarget', 1, 30, 1 );\n\n\tconst washingtonFolder = gui.addFolder( 'Washington DC Layer' );\n\twashingtonFolder.add( params, 'opacity', 0, 1 );\n\twashingtonFolder.addColor( params, 'color' );\n\n\tconst baseFolder = gui.addFolder( 'Base Layer' );\n\tbaseFolder.add( params, 'baseOpacity', 0, 1 ).name( 'opacity' );\n\tbaseFolder.addColor( params, 'baseColor' ).name( 'color' );\n\n\tgui.add( params, 'reload' );\n\n\tstatsContainer = document.createElement( 'div' );\n\tdocument.getElementById( 'info' ).appendChild( statsContainer );\n\n\t// Stats\n\tstats = new Stats();\n\tstats.showPanel( 0 );\n\tdocument.body.appendChild( stats.dom );\n\n}\n\nfunction updateBaseOverlay() {\n\n\tconst plugin = tiles.getPluginByName( 'IMAGE_OVERLAY_PLUGIN' );\n\tif ( baseOverlay ) {\n\n\t\tplugin.deleteOverlay( baseOverlay );\n\n\t}\n\n\tif ( params.mapBase ) {\n\n\t\tbaseOverlay = new XYZTilesOverlay( {\n\t\t\turl: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',\n\t\t} );\n\n\t} else {\n\n\t\tbaseOverlay = new CesiumIonOverlay( {\n\t\t\tassetId: '3954',\n\t\t\tapiToken: import.meta.env.VITE_ION_KEY,\n\t\t} );\n\n\t}\n\n\tplugin.addOverlay( baseOverlay, - 1 );\n\n}\n\nfunction onWindowResize() {\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tif ( ! tiles ) return;\n\n\tconst plugin = tiles.getPluginByName( 'IMAGE_OVERLAY_PLUGIN' );\n\tplugin.enableTileSplitting = params.enableTileSplitting;\n\n\twashingtonOverlay.color.set( params.color );\n\twashingtonOverlay.opacity = params.opacity;\n\n\tbaseOverlay.color.set( params.baseColor );\n\tbaseOverlay.opacity = params.baseOpacity;\n\n\tcontrols.update();\n\n\t// update options\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.setCamera( camera );\n\n\t// update tiles\n\tcamera.updateMatrixWorld();\n\ttiles.errorTarget = params.errorTarget;\n\ttiles.update();\n\n\trenderer.render( scene, camera );\n\tstats.update();\n\n\tupdateHtml();\n\n}\n\nfunction updateHtml() {\n\n\t// render html text updates\n\tlet str = '';\n\n\tif ( params.enableCacheDisplay ) {\n\n\t\tconst lruCache = tiles.lruCache;\n\t\tconst cacheFullness = lruCache.cachedBytes / lruCache.maxBytesSize;\n\t\tstr += `Downloading: ${ tiles.stats.downloading } Parsing: ${ tiles.stats.parsing } Visible: ${ tiles.visibleTiles.size }<br/>`;\n\t\tstr += `Cache: ${ ( 100 * cacheFullness ).toFixed( 2 ) }% ~${ ( lruCache.cachedBytes / 1000 / 1000 ).toFixed( 2 ) }mb<br/>`;\n\n\t}\n\n\tif ( params.enableRendererStats ) {\n\n\t\tconst memory = renderer.info.memory;\n\t\tconst render = renderer.info.render;\n\t\tconst programCount = renderer.info.programs.length;\n\t\tstr += `Geometries: ${ memory.geometries } Textures: ${ memory.textures } Programs: ${ programCount } Draw Calls: ${ render.calls }`;\n\n\t}\n\n\tif ( statsContainer.innerHTML !== str ) {\n\n\t\tstatsContainer.innerHTML = str;\n\n\t}\n\n}\n"],"names":["controls","scene","renderer","tiles","camera","washingtonOverlay","baseOverlay","statsContainer","stats","params","reinstantiateTiles","init","animate","CesiumIonOverlay","TilesRenderer","CesiumIonAuthPlugin","TilesFadePlugin","ImageOverlayPlugin","updateBaseOverlay","WebGLRenderer","Scene","PerspectiveCamera","ambientLight","AmbientLight","dirLight","DirectionalLight","GlobeControls","onWindowResize","gui","GUI","washingtonFolder","baseFolder","Stats","plugin","XYZTilesOverlay","aspect","updateHtml","str","lruCache","cacheFullness","memory","render","programCount"],"mappings":"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"}