{"version":3,"file":"cesiumCompare-CVkeZnoY.js","sources":["../../three/cesiumCompare.js"],"sourcesContent":["\nimport { GlobeControls, TilesRenderer, CAMERA_FRAME, EnvironmentControls } from '3d-tiles-renderer';\nimport { Scene, WebGLRenderer, PerspectiveCamera, MathUtils, Sphere, TextureUtils, DirectionalLight, DataTexture, EquirectangularReflectionMapping } from 'three';\nimport { estimateBytesUsed } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\nimport { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader.js';\nimport { GLTFExtensionsPlugin } from '3d-tiles-renderer/plugins';\n\nconst url = new URLSearchParams( location.search ).get( 'url' ) || '../../data/tileset.json';\nconst threeContainer = document.getElementById( 'three-container' );\nconst cesiumContainer = document.getElementById( 'cesium-container' );\nconst threeStats = threeContainer.getElementsByClassName( 'stats' )[ 0 ];\nconst cesiumStats = cesiumContainer.getElementsByClassName( 'stats' )[ 0 ];\nlet cesiumViewer, threeViewer;\nlet cameraInitialized = false;\n\n( async () => {\n\n\tawait initThree();\n\tawait initCesium();\n\n\twindow.addEventListener( 'keydown', e => {\n\n\t\tif ( e.key === ' ' ) {\n\n\t\t\tdocument.body.classList.toggle( 'fullscreen' );\n\n\t\t}\n\n\t} );\n\n\tupdateFromHash();\n\tsetInterval( () => {\n\n\t\tconst { camera } = threeViewer;\n\t\tconst { position, rotation } = camera;\n\t\tconst data = [ ...position, rotation.x, rotation.y, rotation.z ].map( v => parseFloat( v.toFixed( 4 ) ) );\n\t\twindow.history.replaceState( undefined, undefined, `#${ JSON.stringify( data ) }` );\n\n\t}, 100 );\n\n\trender();\n\n} )();\n\nfunction updateFromHash() {\n\n\tconst hash = window.location.hash.replace( /^#/, '' );\n\tif ( ! hash ) return;\n\n\tconst [ x, y, z, ex, ey, ez ] = JSON.parse( unescape( hash ) );\n\n\tconst { camera } = threeViewer;\n\tcamera.position.set( x, y, z );\n\tcamera.rotation.set( ex, ey, ez );\n\tcameraInitialized = true;\n\n}\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\twindow.THREE_DATA = threeViewer;\n\twindow.CESIUM_DATA = cesiumViewer;\n\n\t// update three\n\tthreeViewer.update();\n\n\t// update cesium\n\tconst ellipsoid = threeViewer.tiles.ellipsoid;\n\tconst frame = ellipsoid.getCartographicFromObjectFrame( threeViewer.camera.matrixWorld, {}, CAMERA_FRAME );\n\n\t// update frustum\n\tcesiumViewer.camera.frustum.near = threeViewer.camera.near;\n\tcesiumViewer.camera.frustum.far = threeViewer.camera.far;\n\tcesiumViewer.camera.frustum.fov = vertFovToCesiumFov( threeViewer.camera.fov, threeViewer.camera.aspect ) * MathUtils.DEG2RAD;\n\n\t// set position\n\tcesiumViewer.camera.position.x = threeViewer.camera.position.x;\n\tcesiumViewer.camera.position.y = threeViewer.camera.position.y;\n\tcesiumViewer.camera.position.z = threeViewer.camera.position.z;\n\n\t// set rotation\n\tcesiumViewer.camera.setView( {\n\t\tdestination: cesiumViewer.position,\n\t\torientation: {\n\t\t\troll: frame.roll,\n\t\t\tpitch: frame.elevation,\n\t\t\theading: frame.azimuth,\n\t\t}\n\t} );\n\n\tcesiumViewer.update();\n\n\tupdateThreeStats();\n\tupdateCesiumStats();\n\n}\n\nfunction updateThreeStats() {\n\n\tlet shallowTilesLoaded, loadedGeometryTiles, allLoadedTiles;\n\tlet textureBytes, geometryBytes;\n\n\tloadedGeometryTiles = 0;\n\ttextureBytes = 0;\n\tgeometryBytes = 0;\n\tthreeViewer.tiles.forEachLoadedModel( ( scene, tile ) => {\n\n\t\tloadedGeometryTiles ++;\n\n\t\tscene.traverse( c => {\n\n\t\t\tconst { geometry, material } = c;\n\t\t\tif ( geometry ) {\n\n\t\t\t\tgeometryBytes += estimateBytesUsed( c.geometry );\n\t\t\t\tfor ( const key in material ) {\n\n\t\t\t\t\tconst value = material[ key ];\n\t\t\t\t\tif ( value && value.isTexture ) {\n\n\t\t\t\t\t\tconst { format, type, image } = value;\n\t\t\t\t\t\tconst { width, height } = image;\n\n\t\t\t\t\t\tlet bytes = TextureUtils.getByteLength( width, height, format, type );\n\t\t\t\t\t\tbytes *= value.generateMipmaps ? 4 / 3 : 1;\n\t\t\t\t\t\ttextureBytes += bytes;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t} );\n\n\tshallowTilesLoaded = 0;\n\ttraverse( threeViewer.root, t => {\n\n\t\tif ( t.internal && t.internal.hasRenderableContent && t.internal.loadingState !== 0 ) {\n\n\t\t\tshallowTilesLoaded ++;\n\t\t\treturn true;\n\n\t\t}\n\n\t} );\n\n\tallLoadedTiles = 0;\n\ttraverse( threeViewer.root, ( t, d ) => {\n\n\t\tif ( t.internal && t.internal.hasContent && t.internal.loadingState !== 0 ) {\n\n\t\t\tallLoadedTiles ++;\n\n\t\t}\n\n\t} );\n\n\tconst { loadStart, loadEnd } = threeViewer;\n\tconst loadDelta = loadEnd - loadStart;\n\tclearStats( threeStats );\n\twriteStats( threeStats, 'visible tiles', threeViewer.tiles.visibleTiles.size );\n\twriteStats( threeStats, 'loaded tiles', allLoadedTiles );\n\twriteStats( threeStats, 'loaded geom tiles', loadedGeometryTiles );\n\twriteStats( threeStats, 'loaded subtree tiles', allLoadedTiles - loadedGeometryTiles );\n\twriteStats( threeStats, 'loaded layer 1 tiles', shallowTilesLoaded );\n\twriteStats( threeStats, 'total memory', ( threeViewer.tiles.lruCache.cachedBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( threeStats, 'geometry memory', ( geometryBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( threeStats, 'texture memory', ( textureBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( threeStats, 'load start', loadStart.toFixed( 0 ) + ' ms' );\n\twriteStats( threeStats, 'load end', ( loadDelta < 0 ? '--' : loadEnd.toFixed( 0 ) + ' ms' ) );\n\twriteStats( threeStats, 'load delta', ( loadDelta < 0 ? '--' : loadDelta.toFixed( 0 ) + ' ms' ) );\n\twriteStats( threeStats, 'total load time', threeViewer.totalLoadTime.toFixed( 0 ) + ' ms' );\n\twriteStats( threeStats, 'perf', ( 100 * threeViewer.totalLoadTime / cesiumViewer.totalLoadTime ).toFixed( 2 ) + '%' );\n\n}\n\nfunction updateCesiumStats() {\n\n\tlet shallowTilesLoaded, allLoadedTiles;\n\tlet textureBytes, geometryBytes;\n\n\tshallowTilesLoaded = 0;\n\ttraverse( cesiumViewer.root, t => {\n\n\t\tif ( t._content && t._content.ready && t._content._model ) {\n\n\t\t\tshallowTilesLoaded ++;\n\t\t\treturn true;\n\n\t\t}\n\n\t} );\n\n\tallLoadedTiles = 0;\n\tgeometryBytes = 0;\n\ttextureBytes = 0;\n\ttraverse( cesiumViewer.root, ( t, d ) => {\n\n\t\tif ( t._content && t._content.ready ) {\n\n\t\t\t// cesium treats the root node has having content\n\t\t\tif ( d !== 0 ) {\n\n\t\t\t\tallLoadedTiles ++;\n\n\t\t\t}\n\n\t\t\tif ( t._content._model ) {\n\n\t\t\t\tgeometryBytes += t._content._model.statistics.geometryByteLength;\n\t\t\t\ttextureBytes += t._content._model.statistics.texturesByteLength;\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\tconst { loadStart, loadEnd } = cesiumViewer;\n\tconst loadDelta = loadEnd - loadStart;\n\tclearStats( cesiumStats );\n\twriteStats( cesiumStats, 'visible tiles', cesiumViewer.tiles.statistics.selected );\n\twriteStats( cesiumStats, 'loaded tiles', allLoadedTiles );\n\twriteStats( cesiumStats, 'loaded geom tiles', cesiumViewer.tiles.statistics.numberOfTilesWithContentReady );\n\twriteStats( cesiumStats, 'loaded subtree tiles', allLoadedTiles - cesiumViewer.tiles.statistics.numberOfTilesWithContentReady );\n\twriteStats( cesiumStats, 'loaded layer 1 tiles', shallowTilesLoaded );\n\twriteStats( cesiumStats, 'total memory', ( cesiumViewer.tiles.totalMemoryUsageInBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( cesiumStats, 'geometry memory', ( geometryBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( cesiumStats, 'texture memory', ( textureBytes * 1e-6 ).toFixed( 3 ) + ' MB' );\n\twriteStats( cesiumStats, 'load start', loadStart.toFixed( 0 ) + ' ms' );\n\twriteStats( cesiumStats, 'load end', ( loadDelta < 0 ? '--' : loadEnd.toFixed( 0 ) + ' ms' ) );\n\twriteStats( cesiumStats, 'load delta', ( loadDelta < 0 ? '--' : loadDelta.toFixed( 0 ) + ' ms' ) );\n\twriteStats( cesiumStats, 'total load time', cesiumViewer.totalLoadTime.toFixed( 0 ) + ' ms' );\n\n}\n\nasync function initThree() {\n\n\t// renderer\n\tconst renderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setClearColor( 0 );\n\tthreeContainer.appendChild( renderer.domElement );\n\n\t// adjustments to match cesium defaults\n\trenderer.domElement.style.imageRendering = 'pixelated';\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\n\t// scene\n\tconst scene = new Scene();\n\n\t// camera\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tconst cesiumFov = 60;\n\tconst camera = new PerspectiveCamera( horizFovToVert( cesiumFov, aspect ), aspect, 0.1, 1e10 );\n\tcamera.position.set( - 1356736.6495227425, 5298502.86925096, 3271193.9085458643 );\n\tcamera.quaternion.set(\n\t\t0.27330445532852865,\n\t\t- 0.4460582045331912,\n\t\t- 0.821679716911258,\n\t\t0.2262281938283491,\n\t);\n\n\tconst dracoLoader = new DRACOLoader();\n\tdracoLoader.setDecoderPath( 'https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/' );\n\n\tconst ktx2loader = new KTX2Loader();\n\tktx2loader.setTranscoderPath( 'https://unpkg.com/three@0.153.0/examples/jsm/libs/basis/' );\n\tktx2loader.detectSupport( renderer );\n\n\t// initialize tiles\n\tconst tiles = new TilesRenderer( url );\n\ttiles.registerPlugin( new GLTFExtensionsPlugin( {\n\t\trtc: true,\n\t\tdracoLoader: dracoLoader,\n\t\tktxLoader: ktx2loader,\n\t} ) );\n\n\ttiles.preprocessURL = url => unescape( url );\n\ttiles.lruCache.maxBytesSize = Infinity;\n\ttiles.lruCache.minBytesSize = 0;\n\ttiles.setResolutionFromRenderer( camera, renderer );\n\ttiles.setCamera( camera );\n\n\tlet controls;\n\ttiles.addEventListener( 'load-root-tileset', () => {\n\n\t\t// position the camera based on the model\n\t\tconst sphere = new Sphere();\n\t\ttiles.getBoundingSphere( sphere );\n\n\t\tif ( sphere.center.distanceTo( camera.position ) > sphere.radius * 20 ) {\n\n\t\t\tcameraInitialized = false;\n\n\t\t}\n\n\t\tif ( ! cameraInitialized ) {\n\n\t\t\tcameraInitialized = true;\n\t\t\tcamera.position.copy( sphere.center );\n\n\t\t\tif ( camera.position.length() > 1e5 ) {\n\n\t\t\t\tconst offset = sphere.center.clone().normalize();\n\t\t\t\tcamera.position.addScaledVector( offset, sphere.radius );\n\n\t\t\t} else {\n\n\t\t\t\tcamera.position.x += sphere.radius;\n\t\t\t\tcamera.position.y += sphere.radius;\n\t\t\t\tcamera.position.z += sphere.radius;\n\n\t\t\t}\n\n\t\t\tcamera.lookAt( sphere.center );\n\n\t\t}\n\n\t\tif ( ! controls ) {\n\n\t\t\tif ( camera.position.length() > 1e5 ) {\n\n\t\t\t\t// controls\n\t\t\t\tcontrols = new GlobeControls( scene, camera, renderer.domElement, null );\n\t\t\t\tcontrols.enableDamping = true;\n\t\t\t\tcontrols.adjustHeight = false;\n\t\t\t\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\n\t\t\t} else {\n\n\t\t\t\tcontrols = new EnvironmentControls( scene, camera, renderer.domElement, null );\n\t\t\t\tcontrols.enableDamping = true;\n\t\t\t\tcontrols.adjustHeight = false;\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\tlet start = 0;\n\ttiles.addEventListener( 'tiles-load-start', e => {\n\n\t\tstart = performance.now();\n\t\tif ( performance.now() - threeViewer.loadEnd > 100 ) {\n\n\t\t\tthreeViewer.loadStart = start;\n\n\t\t}\n\n\t} );\n\n\ttiles.addEventListener( 'tiles-load-end', e => {\n\n\t\tthreeViewer.loadEnd = performance.now();\n\t\tthreeViewer.totalLoadTime += performance.now() - start;\n\n\t} );\n\n\tscene.add( tiles.group );\n\n\t// lights\n\tconst dirLight = new DirectionalLight( 0xffffff, 2 );\n\tdirLight.position.set( 1, 2, 3 );\n\tscene.add( dirLight );\n\n\t// use environment rather than ambient light since it works for metallic materials\n\tscene.environment = new DataTexture( new Uint8Array( 64 * 64 * 4 ).fill( 255 ), 64, 64 );\n\tscene.environment.mapping = EquirectangularReflectionMapping;\n\tscene.environmentIntensity = 1 / Math.PI;\n\tscene.environment.needsUpdate = true;\n\n\t// position the camera\n\tconst lat = 0.5419733570174874;\n\tconst lon = 1.821470691863346;\n\tconst height = 553.1228538149635;\n\n\tconst roll = 0;\n\tconst pitch = - 0.5000321680050197;\n\tconst heading = 0;\n\n\ttiles.ellipsoid\n\t\t.getObjectFrame(\n\t\t\tlat, lon, height,\n\t\t\troll, pitch, heading,\n\t\t\tcamera.matrixWorld,\n\t\t\tCAMERA_FRAME,\n\t\t).decompose(\n\t\t\tcamera.position,\n\t\t\tcamera.quaternion,\n\t\t\tcamera.scale,\n\t\t);\n\n\t// resize listeners\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\tthreeViewer = {\n\t\ttotalLoadTime: 0,\n\t\tloadStart: 0,\n\t\tloadEnd: 0,\n\t\ttiles,\n\t\tcamera,\n\t\trenderer,\n\t\tscene,\n\t\tupdate,\n\t\tget root() {\n\n\t\t\treturn tiles.root;\n\n\t\t},\n\t};\n\n\tfunction onWindowResize() {\n\n\t\tconst cesiumFov = 60;\n\t\tconst element = renderer.domElement;\n\t\tconst aspect = element.clientWidth / element.clientHeight;\n\t\tcamera.aspect = aspect;\n\t\tcamera.fov = horizFovToVert( cesiumFov, aspect );\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( element.clientWidth, element.clientHeight, false );\n\n\t}\n\n\tfunction update() {\n\n\t\tonWindowResize();\n\n\t\tif ( controls ) {\n\n\t\t\tcontrols.update();\n\n\t\t}\n\n\t\t// update options\n\t\ttiles.setResolutionFromRenderer( camera, renderer );\n\t\ttiles.setCamera( camera );\n\n\t\t// update tiles\n\t\tcamera.updateMatrixWorld();\n\t\ttiles.update();\n\n\t\trenderer.render( scene, camera );\n\n\t}\n\n}\n\nasync function initCesium() {\n\n\t// initialize the viewer\n\tconst viewer = new Cesium.CesiumWidget( cesiumContainer );\n\tviewer.scene.terrainProvider = false;\n\tviewer.scene.skyBox.destroy();\n\tviewer.scene.skyBox = undefined;\n\tviewer.scene.sun.destroy();\n\tviewer.scene.sun = undefined;\n\tviewer.scene.backgroundColor = Cesium.Color.BLACK.clone();\n\tviewer.creditDisplay.container.style.display = 'none';\n\n\t// initialize the tileset\n\tconst tileset = await Cesium.Cesium3DTileset.fromUrl( url, {\n\t\t// loadSiblings: true,\n\t\tmaximumCacheOverflowBytes: 1e20,\n\t\tcacheBytes: 0,\n\t} );\n\tviewer.scene.primitives.add( tileset );\n\n\t// extract the quaternion\n\tconst camera = viewer.camera;\n\n\t// log the camera information for debugging\n\t// const { latitude, longitude, height } = camera.positionCartographic;\n\t// console.log( {\n\t// \tfov: camera.frustum.fov,\n\t// \tnear: camera.frustum.near,\n\t// \tfar: camera.frustum.far,\n\n\t// \troll: camera.roll,\n\t// \tpitch: camera.pitch,\n\t// \theading: camera.heading,\n\n\t// \tlatitude,\n\t// \tlongitude,\n\t// \theight,\n\t// } );\n\n\tlet loading = false;\n\tlet start = 0;\n\ttileset.loadProgress.addEventListener( ( pending, processing ) => {\n\n\t\tconst total = pending + processing;\n\t\tif ( total !== 0 && ! loading ) {\n\n\t\t\tloading = true;\n\t\t\tstart = performance.now();\n\t\t\tif ( start - threeViewer.loadEnd > 100 ) {\n\n\t\t\t\tcesiumViewer.loadStart = start;\n\n\t\t\t}\n\n\t\t} else if ( total === 0 && loading ) {\n\n\t\t\tloading = false;\n\t\t\tcesiumViewer.loadEnd = performance.now();\n\t\t\tcesiumViewer.totalLoadTime += performance.now() - start;\n\n\t\t}\n\n\t} );\n\n\tcesiumViewer = {\n\t\ttotalLoadTime: 0,\n\t\tloadStart: 0,\n\t\tloadEnd: 0,\n\t\ttiles: tileset,\n\t\tviewer,\n\t\tcamera,\n\t\tscene: viewer.scene,\n\t\tupdate: () => {},\n\t\tget root() {\n\n\t\t\tlet node = tileset._selectedTiles[ 0 ];\n\t\t\twhile ( node && node.parent ) node = node.parent;\n\t\t\treturn node || null;\n\n\t\t},\n\t};\n\n}\n\nfunction clearStats( target ) {\n\n\ttarget.innerHTML = '';\n\n}\n\nfunction writeStats( target, key, value ) {\n\n\ttarget.innerHTML += `<div name=\"${ key }\">${ value }</div>`;\n\n}\n\nfunction horizFovToVert( fov, aspect ) {\n\n\treturn MathUtils.RAD2DEG * 2 * Math.atan( Math.tan( MathUtils.DEG2RAD * fov / 2 ) / aspect );\n\n}\n\nfunction vertFovToCesiumFov( fov, aspect ) {\n\n\tif ( aspect < 1 ) return fov;\n\n\treturn MathUtils.RAD2DEG * 2 * Math.atan( Math.tan( MathUtils.DEG2RAD * fov / 2 ) * aspect );\n\n}\n\nfunction traverse( root, callback, depth = 0 ) {\n\n\tif ( root ) {\n\n\t\tif ( ! callback( root, depth ) && root.children ) {\n\n\t\t\troot.children.forEach( c => {\n\n\t\t\t\ttraverse( c, callback, depth + 1 );\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n}\n"],"names":["url","threeContainer","cesiumContainer","threeStats","cesiumStats","cesiumViewer","threeViewer","cameraInitialized","initThree","initCesium","updateFromHash","camera","position","rotation","data","v","render","hash","x","y","z","ex","ey","ez","frame","CAMERA_FRAME","vertFovToCesiumFov","MathUtils","updateThreeStats","updateCesiumStats","shallowTilesLoaded","loadedGeometryTiles","allLoadedTiles","textureBytes","geometryBytes","scene","tile","c","geometry","material","estimateBytesUsed","key","value","format","type","image","width","height","bytes","TextureUtils","traverse","t","d","loadStart","loadEnd","loadDelta","clearStats","writeStats","renderer","WebGLRenderer","Scene","aspect","cesiumFov","PerspectiveCamera","horizFovToVert","dracoLoader","DRACOLoader","ktx2loader","KTX2Loader","tiles","TilesRenderer","GLTFExtensionsPlugin","controls","sphere","Sphere","offset","GlobeControls","EnvironmentControls","start","e","dirLight","DirectionalLight","DataTexture","EquirectangularReflectionMapping","onWindowResize","update","element","viewer","tileset","loading","pending","processing","total","node","target","fov","root","callback","depth"],"mappings":"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"}