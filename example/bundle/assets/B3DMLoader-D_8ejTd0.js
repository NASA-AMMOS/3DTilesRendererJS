import{L as B,r as m,F as L,B as y}from"./BatchTable-CRr3zuRk.js";import{aY as w,l as x}from"./three.module-DBfedTbk.js";import{G as C}from"./GLTFLoader-BjagHNWe.js";class U extends B{parse(s){const t=new DataView(s),T=m(t);console.assert(T==="b3dm");const b=t.getUint32(4,!0);console.assert(b===1);const h=t.getUint32(8,!0);console.assert(h===s.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),n=t.getUint32(20,!0),r=t.getUint32(24,!0),g=28,e=s.slice(g,g+o+a),u=new L(e,0,o,a),c=g+o+a,i=s.slice(c,c+n+r),l=new y(i,u.getData("BATCH_LENGTH"),0,n,r),f=c+n+r,p=new Uint8Array(s,f,h-f);return{version:b,featureTable:u,batchTable:l,glbBytes:p}}}class S extends U{constructor(s=w){super(),this.manager=s,this.adjustmentTransform=new x}parse(s){const t=super.parse(s),T=t.glbBytes.slice().buffer;return new Promise((b,h)=>{const o=this.manager,a=this.fetchOptions,n=o.getHandler("path.gltf")||new C(o);a.credentials==="include"&&a.mode==="cors"&&n.setCrossOrigin("use-credentials"),"credentials"in a&&n.setWithCredentials(a.credentials==="include"),a.headers&&n.setRequestHeader(a.headers);let r=this.workingPath;!/[\\/]$/.test(r)&&r.length&&(r+="/");const g=this.adjustmentTransform;n.parse(T,r,e=>{const{batchTable:u,featureTable:c}=t,{scene:i}=e,l=c.getData("RTC_CENTER",1,"FLOAT","VEC3");l&&(i.position.x+=l[0],i.position.y+=l[1],i.position.z+=l[2]),e.scene.updateMatrix(),e.scene.matrix.multiply(g),e.scene.matrix.decompose(e.scene.position,e.scene.quaternion,e.scene.scale),e.batchTable=u,e.featureTable=c,i.batchTable=u,i.featureTable=c,b(e)},h)})}}export{S as B};
//# sourceMappingURL=B3DMLoader-D_8ejTd0.js.map
