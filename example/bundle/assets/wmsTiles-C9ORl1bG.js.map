{"version":3,"file":"wmsTiles-C9ORl1bG.js","sources":["../../../src/three/plugins/loaders/WMSCapabilitiesLoader.js","../../three/wmsTiles.js"],"sourcesContent":["import { LoaderBase, WGS84_RADIUS } from '3d-tiles-renderer/core';\nimport { ProjectionScheme } from '../images/utils/ProjectionScheme';\nimport { MathUtils } from 'three';\n\nconst EQUATOR_CIRCUMFERENCE = WGS84_RADIUS * Math.PI * 2;\nconst mercatorProjection = /* @__PURE__ */ new ProjectionScheme( 'EPSG:3857' );\n\n// helper CRS checks (same logic used in WMTSCapabilitiesLoader)\n// TODO: Share these helpers with the WMTSCapabilitiesLoader\nfunction isEPSG4326( crs ) {\n\n\treturn /:4326$/i.test( crs );\n\n}\n\nfunction isWebMercator( crs ) {\n\n\treturn /:3857$/i.test( crs );\n\n}\n\n// convert from meters (web mercator) to degrees using the mercator projection helper\nfunction correctTupleUnits( tuple, crs ) {\n\n\t// TODO: consolidate this Mercator-units with WMTSLoader / move a helper onto ProjectionScheme?\n\tif ( isWebMercator( crs ) ) {\n\n\t\ttuple[ 0 ] = mercatorProjection.convertNormalizedToLongitude( 0.5 + tuple[ 0 ] / ( Math.PI * 2 * EQUATOR_CIRCUMFERENCE ) );\n\t\ttuple[ 1 ] = mercatorProjection.convertNormalizedToLatitude( 0.5 + tuple[ 1 ] / ( Math.PI * 2 * EQUATOR_CIRCUMFERENCE ) );\n\n\t\t// to degrees\n\t\ttuple[ 0 ] *= MathUtils.RAD2DEG;\n\t\ttuple[ 1 ] *= MathUtils.RAD2DEG;\n\n\t}\n\n\treturn tuple;\n\n}\n\n// swap order when CRS is EPSG:4326 (WMS 1.3 axis order)\nfunction correctTupleOrder( tuple, crs, version ) {\n\n\t// Before WMS 1.3.0 the latitude, longitude order for EPSG:4326 was declared to be in reverse and has\n\t// been fixed in later versions. Correct the tuple order for consistency if loading a file from a prior version.\n\t// See https://gis.stackexchange.com/questions/23347/getmap-wms-1-1-1-vs-1-3-0\n\tconst [ major, minor ] = version.split( '.' ).map( v => parseInt( v ) );\n\tconst shouldFixTupleOrder = major === 1 && minor < 3 || major < 1;\n\tif ( isEPSG4326( crs ) && shouldFixTupleOrder ) {\n\n\t\t[ tuple[ 0 ], tuple[ 1 ] ] = [ tuple[ 1 ], tuple[ 0 ] ];\n\n\t}\n\n}\n\n// convert degrees to radians in-place\nfunction tupleToRadians( tuple ) {\n\n\ttuple[ 0 ] *= MathUtils.DEG2RAD;\n\ttuple[ 1 ] *= MathUtils.DEG2RAD;\n\n}\n\n// parse \"BoundingBox\" tag for WMS using same normalization as WMTS (lower/upper corners, unit & order correction)\nfunction parseBoundingBox( el, version ) {\n\n\tif ( ! el ) {\n\n\t\treturn null;\n\n\t}\n\n\t// WMS may use CRS / crs / SRS attribute\n\tconst crs = el.getAttribute( 'CRS' ) || el.getAttribute( 'crs' ) || el.getAttribute( 'SRS' ) || '';\n\n\tconst minx = parseFloat( el.getAttribute( 'minx' ) );\n\tconst miny = parseFloat( el.getAttribute( 'miny' ) );\n\tconst maxx = parseFloat( el.getAttribute( 'maxx' ) );\n\tconst maxy = parseFloat( el.getAttribute( 'maxy' ) );\n\n\tconst lowerCorner = [ minx, miny ];\n\tconst upperCorner = [ maxx, maxy ];\n\n\tcorrectTupleOrder( lowerCorner, crs, version );\n\tcorrectTupleOrder( upperCorner, crs, version );\n\n\t// correct units if web mercator meters were provided\n\tcorrectTupleUnits( lowerCorner, crs );\n\tcorrectTupleUnits( upperCorner, crs );\n\n\t// convert degrees to radians for internal consistency with other loaders\n\ttupleToRadians( lowerCorner );\n\ttupleToRadians( upperCorner );\n\n\t// bounds in order [minLon, minLat, maxLon, maxLat] (in radians)\n\treturn { crs, bounds: [ ...lowerCorner, ...upperCorner ] };\n\n}\n\n// EX_GeographicBoundingBox (>= 1.3.0) and LatLonBoundingBox (<= 1.1.1) define the bounds of content\nfunction parseEXGeographicBoundingBox( el ) {\n\n\tconst west = parseFloat( el.querySelector( 'westBoundLongitude' ).textContent );\n\tconst east = parseFloat( el.querySelector( 'eastBoundLongitude' ).textContent );\n\tconst south = parseFloat( el.querySelector( 'southBoundLatitude' ).textContent );\n\tconst north = parseFloat( el.querySelector( 'northBoundLatitude' ).textContent );\n\n\tconst lowerCorner = [ west, south ];\n\tconst upperCorner = [ east, north ];\n\n\ttupleToRadians( lowerCorner );\n\ttupleToRadians( upperCorner );\n\n\treturn [ ...lowerCorner, ...upperCorner ];\n\n}\n\nfunction parseLatLonBoundingBox( el ) {\n\n\tconst west = parseFloat( el.getAttribute( 'minx' ).textContent );\n\tconst east = parseFloat( el.getAttribute( 'maxx' ).textContent );\n\tconst south = parseFloat( el.getAttribute( 'miny' ).textContent );\n\tconst north = parseFloat( el.getAttribute( 'maxy' ).textContent );\n\n\tconst lowerCorner = [ west, south ];\n\tconst upperCorner = [ east, north ];\n\n\ttupleToRadians( lowerCorner );\n\ttupleToRadians( upperCorner );\n\n\treturn [ ...lowerCorner, ...upperCorner ];\n\n}\n\n// Parse the \"Style\" tag along with the associated legend elements\nfunction parseStyle( el ) {\n\n\tconst name = el.querySelector( 'Name' ).textContent;\n\tconst title = el.querySelector( 'Title' ).textContent;\n\tconst legends = [ ...el.querySelectorAll( 'LegendURL' ) ].map( legendEl => {\n\n\t\t// width/height attrs on LegendURL\n\t\tconst width = parseInt( legendEl.getAttribute( 'width' ) );\n\t\tconst height = parseInt( legendEl.getAttribute( 'height' ) );\n\n\t\t// collect Format elements inside LegendURL\n\t\tconst format = legendEl.querySelector( 'Format' ).textContent;\n\n\t\t// OnlineResource may use xlink namespace\n\t\tconst online = legendEl.querySelector( 'OnlineResource' );\n\t\tconst url = readOnlineResourceHref( online );\n\n\t\treturn {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tformat,\n\t\t\turl,\n\t\t};\n\n\t} );\n\n\treturn {\n\t\tname,\n\t\ttitle,\n\t\tlegends,\n\t};\n\n}\n\n// Parse a <Layer> element in addition to the child layers\nfunction parseLayer( el, version, inheritedProperties = {} ) {\n\n\t// TODO:\n\t// - Dimension\n\t// - Attribution\n\t// - AuthorityURL\n\t// - MinScaleDenominator\n\t// - MaxScaleDenominator\n\t// - cascaded, noSubsets, fixedWidth, fixedHeight attributes\n\n\tlet {\n\t\tstyles = [],\n\t\tcrs = [],\n\t\tcontentBoundingBox = null,\n\t\tqueryable = false,\n\t\topaque = false,\n\t} = inheritedProperties;\n\n\tconst name = el.querySelector( ':scope > Name' )?.textContent || null;\n\tconst title = el.querySelector( ':scope > Title' )?.textContent || '';\n\tconst abstract = el.querySelector( ':scope > Abstract' )?.textContent || '';\n\tconst keywords = [ ...el.querySelectorAll( ':scope > Keyword' ) ].map( k => k.textContent );\n\tconst boundingBoxEl = [ ...el.querySelectorAll( ':scope > BoundingBox' ) ];\n\tconst boundingBoxes = boundingBoxEl.map( el => parseBoundingBox( el, version ) );\n\n\t// See section 7.2.4.8 in the specification\n\t// Handle added inherited properties\n\tcrs = [\n\t\t...crs,\n\t\t...Array.from( el.querySelectorAll( 'CRS' ) ).map( c => c.textContent ),\n\t];\n\tstyles = [\n\t\t...styles,\n\t\t...Array.from( el.querySelectorAll( ':scope > Style' ) ).map( el => parseStyle( el ) ),\n\t];\n\n\t// Handle replaced inherited properties\n\tif ( el.hasAttribute( 'queryable' ) ) {\n\n\t\tqueryable = el.getAttribute( 'queryable' ) === '1';\n\n\t}\n\n\tif ( el.hasAttribute( 'opaque' ) ) {\n\n\t\topaque = el.getAttribute( 'opaque' ) === '1';\n\n\t}\n\n\t// These bounding boxes define the range of data present in the data set in a cartographic range\n\tif ( el.querySelector( 'EX_GeographicBoundingBox' ) ) {\n\n\t\tcontentBoundingBox = parseEXGeographicBoundingBox( el.querySelector( 'EX_GeographicBoundingBox' ) );\n\n\t} else if ( el.querySelector( 'LatLonBoundingBox' ) ) {\n\n\t\tcontentBoundingBox = parseLatLonBoundingBox( el.querySelector( 'LatLonBoundingBox' ) );\n\n\t}\n\n\t// Recursively parse sublayers\n\tconst subLayers = Array.from( el.querySelectorAll( ':scope > Layer' ) ).map( el => {\n\n\t\treturn parseLayer( el, version, {\n\t\t\t// add\n\t\t\tstyles,\n\t\t\tcrs,\n\n\t\t\t// replace\n\t\t\tcontentBoundingBox,\n\t\t\tqueryable,\n\t\t\topaque,\n\t\t} );\n\n\t} );\n\n\treturn {\n\t\tname,\n\t\ttitle,\n\t\tabstract,\n\t\tqueryable,\n\t\topaque,\n\t\tkeywords,\n\t\tcrs,\n\t\tboundingBoxes,\n\t\tcontentBoundingBox,\n\t\tstyles,\n\t\tsubLayers,\n\t};\n\n}\n\n// Parse the \"Service\" tag\nfunction parseService( el ) {\n\n\treturn {\n\t\tname: el.querySelector( 'Name' )?.textContent || '',\n\t\ttitle: el.querySelector( 'Title' )?.textContent || '',\n\t\tabstract: el.querySelector( 'Abstract' )?.textContent || '',\n\t\tkeywords: Array.from( el.querySelectorAll( 'Keyword' ) ).map( k => k.textContent ),\n\n\t\tmaxWidth: parseFloat( el.querySelector( 'MaxWidth' ) ) || null,\n\t\tmaxHeight: parseFloat( el.querySelector( 'MaxHeight' ) ) || null,\n\t\tlayerLimit: parseFloat( el.querySelector( 'LayerLimit' ) ) || null,\n\t};\n\n}\n\n// helper: read OnlineResource href (handles xlink namespace)\nfunction readOnlineResourceHref( el ) {\n\n\tif ( ! el ) {\n\n\t\treturn '';\n\n\t}\n\n\treturn (\n\t\tel.getAttribute( 'xlink:href' ) ||\n\t\tel.getAttributeNS( 'http://www.w3.org/1999/xlink', 'href' ) ||\n\t\t''\n\t).trim();\n\n}\n\n// parse a single operation (e.g. GetMap, GetCapabilities, GetFeatureInfo)\nfunction parseRequestOperation( opEl ) {\n\n\tconst formats = Array.from( opEl.querySelectorAll( 'Format' ) ).map( f => f.textContent.trim() );\n\tconst dcp = Array.from( opEl.querySelectorAll( 'DCPType' ) ).map( dcp => {\n\n\t\tconst httpEl = dcp.querySelector( 'HTTP' );\n\n\t\tconst getEl = httpEl.querySelector( 'Get OnlineResource' ) || httpEl.querySelector( 'Get > OnlineResource' ) || httpEl.querySelector( 'Get' );\n\t\tconst postEl = httpEl.querySelector( 'Post OnlineResource' ) || httpEl.querySelector( 'Post > OnlineResource' ) || httpEl.querySelector( 'Post' );\n\t\tconst getHref = readOnlineResourceHref( getEl );\n\t\tconst postHref = readOnlineResourceHref( postEl );\n\t\treturn { type: 'HTTP', get: getHref, post: postHref };\n\n\t} );\n\n\treturn { formats, dcp, href: dcp[ 0 ].get };\n\n}\n\n// parse the whole Request section, returning an object keyed by operation local name\nfunction parseRequest( el ) {\n\n\tconst ops = {};\n\tArray\n\t\t.from( el.querySelectorAll( ':scope > *' ) )\n\t\t.forEach( ( child ) => {\n\n\t\t\tconst requestType = child.localName;\n\t\t\tops[ requestType ] = parseRequestOperation( child );\n\n\t\t} );\n\treturn ops;\n\n}\n\n// Collect all sub layers with a valid name into a flat array for easier access\nfunction collectLayers( layers, target = [] ) {\n\n\tlayers.forEach( l => {\n\n\t\tif ( l.name !== null ) {\n\n\t\t\ttarget.push( l );\n\n\t\t}\n\n\t\tcollectLayers( l.subLayers, target );\n\n\t} );\n\n\treturn target;\n\n}\n\nexport class WMSCapabilitiesLoader extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\tconst str = new TextDecoder( 'utf-8' ).decode( new Uint8Array( buffer ) );\n\t\tconst xml = new DOMParser().parseFromString( str, 'text/xml' );\n\t\tconst rootEl = xml.querySelector( 'WMS_Capabilities' ) || xml.querySelector( 'WMT_MS_Capabilities' );\n\t\tconst version = rootEl.getAttribute( 'version' );\n\n\t\tconst capabilityEl = xml.querySelector( 'Capability' );\n\t\tconst service = parseService( xml.querySelector( ':scope > Service' ) );\n\t\tconst request = parseRequest( capabilityEl.querySelector( ':scope > Request' ) );\n\t\tconst rootLayers = Array.from( capabilityEl.querySelectorAll( ':scope > Layer' ) ).map( el => parseLayer( el, version ) );\n\t\tconst layers = collectLayers( rootLayers );\n\n\t\treturn { version, service, layers, request };\n\n\t}\n\n}\n","import { Scene, WebGLRenderer, PerspectiveCamera } from 'three';\nimport { TilesRenderer, GlobeControls } from '3d-tiles-renderer';\nimport { TilesFadePlugin, UpdateOnChangePlugin, WMSCapabilitiesLoader, WMSTilesPlugin } from '3d-tiles-renderer/plugins';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nconst url =\n\twindow.location.hash.replace( /^#/, '' ) ||\n\t'https://basemap.nationalmap.gov/arcgis/services/USGSHydroCached/MapServer/WMSServer?SERVICE=WMS';\n\nif ( ! window.location.hash ) {\n\n\tdocument.getElementById( 'info' ).innerHTML = 'Hydrography data set courtesy of the <a href=\"https://basemap.nationalmap.gov/arcgis/rest/services\">USGS National Map Service</a>.';\n\n}\n\nlet controls, scene, renderer;\nlet tiles, camera, gui;\nlet params, capabilities;\n\ninit();\n\nfunction init() {\n\n\t// renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x111111 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// set up\n\tscene = new Scene();\n\tcamera = new PerspectiveCamera( 60, window.innerWidth / window.innerHeight );\n\n\t// load the tiles\n\tupdateCapabilities();\n\n\tonWindowResize();\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\twindow.addEventListener( 'hashchange', () => location.reload() );\n\n}\n\nasync function updateCapabilities() {\n\n\tcapabilities = await new WMSCapabilitiesLoader().loadAsync( url + '&request=GetCapabilities' );\n\n\tconst defaultLayer = capabilities.layers[ 0 ];\n\tparams = {\n\t\tlayer: defaultLayer.name,\n\t\tstyles: defaultLayer.styles[ 0 ]?.name || '',\n\t\tcrs: 'EPSG:4326',\n\t\tformat: 'image/png',\n\t\ttileDimension: 256,\n\t};\n\n\trebuildGUI();\n\trebuildTiles();\n\n}\n\nfunction rebuildGUI() {\n\n\tif ( gui ) {\n\n\t\tgui.destroy();\n\n\t}\n\n\tconst layer = capabilities.layers.find( l => l.name === params.layer );\n\n\tgui = new GUI();\n\tgui.add( params, 'layer', capabilities.layers.map( l => l.name ) )\n\t\t.onChange( v => {\n\n\t\t\tconst selectedLayer = capabilities.layers.find( l => l.name === v );\n\t\t\tparams.crs = selectedLayer.crs[ 0 ];\n\t\t\tparams.styles = selectedLayer.styles[ 0 ]?.name || '';\n\t\t\trebuildGUI();\n\t\t\trebuildTiles();\n\n\t\t} );\n\tgui.add( params, 'styles', layer.styles.map( s => s.name ) ).onChange( rebuildTiles );\n\tgui.add( params, 'crs', layer.crs ).onChange( rebuildTiles );\n\tgui.add( params, 'format', capabilities.request.GetMap.formats ).onChange( rebuildTiles );\n\tgui.add( params, 'tileDimension', [ 256, 512 ] ).onChange( rebuildTiles );\n\n}\n\nfunction rebuildTiles() {\n\n\tif ( tiles ) {\n\n\t\ttiles.dispose();\n\t\ttiles = null;\n\n\t}\n\n\tif ( controls ) {\n\n\t\tcontrols.dispose();\n\t\tcontrols = null;\n\n\t}\n\n\tconst layer = capabilities.layers.find( l => l.name === params.layer );\n\n\t// WMS overlay layer\n\ttiles = new TilesRenderer();\n\ttiles.registerPlugin( new TilesFadePlugin() );\n\ttiles.registerPlugin( new UpdateOnChangePlugin() );\n\ttiles.registerPlugin(\n\t\tnew WMSTilesPlugin( {\n\t\t\tshape: 'ellipsoid',\n\t\t\turl: capabilities.request.GetMap.href,\n\t\t\tlayer: params.layer,\n\t\t\tcontentBoundingBox: layer.contentBoundingBox,\n\t\t\tcrs: params.crs,\n\t\t\tformat: params.format,\n\t\t\ttileDimension: params.tileDimension,\n\t\t\tstyles: params.styles,\n\t\t\tversion: capabilities.version,\n\t\t} ),\n\t);\n\n\ttiles.group.rotation.x = - Math.PI / 2;\n\tscene.add( tiles.group );\n\n\t// init controls\n\tcontrols = new GlobeControls( scene, camera, renderer.domElement );\n\tcontrols.setEllipsoid( tiles.ellipsoid, tiles.group );\n\tcontrols.enableDamping = true;\n\tcontrols.camera.position.set( 0, 0, 1.75 * 1e7 );\n\tcontrols.camera.quaternion.identity();\n\tcontrols.minDistance = 150;\n\n}\n\nfunction onWindowResize() {\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\tif ( controls ) {\n\n\t\tcontrols.update();\n\t\tcamera.updateMatrixWorld();\n\n\t}\n\n\tif ( tiles ) {\n\n\t\ttiles.setCamera( camera );\n\t\ttiles.setResolutionFromRenderer( camera, renderer );\n\t\ttiles.update();\n\n\t}\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["EQUATOR_CIRCUMFERENCE","WGS84_RADIUS","mercatorProjection","ProjectionScheme","isEPSG4326","crs","isWebMercator","correctTupleUnits","tuple","MathUtils","correctTupleOrder","version","major","minor","v","shouldFixTupleOrder","tupleToRadians","parseBoundingBox","el","minx","miny","maxx","maxy","lowerCorner","upperCorner","parseEXGeographicBoundingBox","west","east","south","north","parseLatLonBoundingBox","parseStyle","name","title","legends","legendEl","width","height","format","online","url","readOnlineResourceHref","parseLayer","inheritedProperties","styles","contentBoundingBox","queryable","opaque","_a","_b","abstract","_c","keywords","k","boundingBoxes","c","subLayers","parseService","parseRequestOperation","opEl","formats","f","dcp","httpEl","getEl","postEl","getHref","postHref","parseRequest","ops","child","requestType","collectLayers","layers","target","l","WMSCapabilitiesLoader","LoaderBase","buffer","str","xml","capabilityEl","service","request","rootLayers","controls","scene","renderer","tiles","camera","gui","params","capabilities","init","WebGLRenderer","render","Scene","PerspectiveCamera","updateCapabilities","onWindowResize","defaultLayer","rebuildGUI","rebuildTiles","layer","GUI","selectedLayer","s","TilesRenderer","TilesFadePlugin","UpdateOnChangePlugin","WMSTilesPlugin","GlobeControls","aspect"],"mappings":"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"}