import{M as T,W as O,S as j,a as k}from"./three.module-DBfedTbk.js";/* empty css               */import{T as V}from"./TilesRenderer-UmkQDoLb.js";import{G as _}from"./GlobeControls-CXYtrMsa.js";import{E as z}from"./EnvironmentControls-BBSDix_Q.js";import{U as N}from"./UpdateOnChangePlugin-CSUQNJGT.js";import{T as $}from"./TilesFadePlugin-BEWaci6K.js";import{a as Q}from"./EPSGTilesPlugin-C-ZW09X4.js";import{L as J}from"./BatchTable-CRr3zuRk.js";import{a as K}from"./I3DMLoader-Co8j1K3i.js";import{P as X}from"./TMSImageSource-CIsRgZv6.js";import{g as Y}from"./lil-gui.module.min-BH_YJbPT.js";import"./B3DMLoader-D_8ejTd0.js";import"./GLTFLoader-BjagHNWe.js";import"./PNTSLoader-C47qgwy1.js";import"./CMPTLoader-CdR2x6K5.js";import"./EllipsoidRegion-By3sIuka.js";import"./Ellipsoid-CLPX16sm.js";import"./ImageFormatPlugin-Cwk6ueKg.js";import"./TiledImageSource-DLt2EM25.js";const b=K*Math.PI*2,v=new X("EPSG:3857");function A(e){return/(:84|:crs84)$/i.test(e)}function Z(e){return/:4326$/i.test(e)}function M(e){return/:3857$/i.test(e)}function E(e){return e.trim().split(/\s+/).map(t=>parseFloat(t))}function L(e,t){Z(t)&&([e[1],e[0]]=[e[0],e[1]])}function q(e,t){if(M(t))return e[0]=v.convertProjectionToLongitude(.5+e[0]/b),e[1]=v.convertProjectionToLatitude(.5+e[1]/b),e[0]*=T.RAD2DEG,e[1]*=T.RAD2DEG,e}function R(e){e[0]*=T.DEG2RAD,e[1]*=T.DEG2RAD}class ee extends J{parse(t){const i=new TextDecoder("utf-8").decode(new Uint8Array(t)),r=new DOMParser().parseFromString(i,"text/xml"),n=r.querySelector("Contents"),s=x(n,"TileMatrixSet").map(d=>se(d)),l=x(n,"Layer").map(d=>ne(d)),p=te(r.querySelector("ServiceIdentification"));return l.forEach(d=>{d.tileMatrixSets=d.tileMatrixSetLinks.map(S=>s.find(o=>o.identifier===S))}),{serviceIdentification:p,tileMatrixSets:s,layers:l}}}function te(e){var s;const t=e.querySelector("Title").textContent,i=((s=e.querySelector("Abstract"))==null?void 0:s.textContent)||"",r=e.querySelector("ServiceType").textContent,n=e.querySelector("ServiceTypeVersion").textContent;return{title:t,abstract:i,serviceType:r,serviceTypeVersion:n}}function ne(e){const t=e.querySelector("Title").textContent,i=e.querySelector("Identifier").textContent,r=e.querySelector("Format").textContent,n=x(e,"ResourceURL").map(S=>ie(S)),s=x(e,"TileMatrixSetLink").map(S=>x(S,"TileMatrixSet")[0].textContent),l=x(e,"Style").map(S=>oe(S)),p=x(e,"Dimension").map(S=>re(S));let d=G(e.querySelector("WGS84BoundingBox"));return d||(d=G(e.querySelector("BoundingBox"))),{title:t,identifier:i,format:r,dimensions:p,tileMatrixSetLinks:s,styles:l,boundingBox:d,resourceUrls:n}}function ie(e){const t=e.getAttribute("template"),i=e.getAttribute("format"),r=e.getAttribute("resourceType");return{template:t,format:i,resourceType:r}}function re(e){var l,p;const t=e.querySelector("Identifier").textContent,i=((l=e.querySelector("UOM"))==null?void 0:l.textContent)||"",r=e.querySelector("Default").textContent,n=((p=e.querySelector("Current"))==null?void 0:p.textContent)==="true",s=x(e,"Value").map(d=>d.textContent);return{identifier:t,uom:i,defaultValue:r,current:n,values:s}}function G(e){if(!e)return null;let t=e.nodeName.endsWith("WGS84BoundingBox")?"urn:ogc:def:crs:CRS::84":e.getAttribute("crs");const i=E(e.querySelector("LowerCorner").textContent),r=E(e.querySelector("UpperCorner").textContent);return L(i,t),L(r,t),q(i,t),q(r,t),R(i),R(r),A(t)?t="EPSG:4326":M(t)&&(t="EPSG:3857"),{crs:t,lowerCorner:i,upperCorner:r,bounds:[...i,...r]}}function oe(e){var n;const t=((n=e.querySelector("Title"))==null?void 0:n.textContent)||null,i=e.querySelector("Identifier").textContent,r=e.getAttribute("isDefault")==="true";return{title:t,identifier:i,isDefault:r}}function se(e){var l,p;let t=e.querySelector("SupportedCRS").textContent;const i=((l=e.querySelector("Title"))==null?void 0:l.textContent)||"",r=e.querySelector("Identifier").textContent,n=((p=e.querySelector("Abstract"))==null?void 0:p.textContent)||"",s=[];return e.querySelectorAll("TileMatrix").forEach((d,S)=>{const o=ae(d),P=28e-5*o.scaleDenominator,D=o.tileWidth*o.matrixWidth*P,W=o.tileHeight*o.matrixHeight*P;let h;L(o.topLeftCorner,t),M(t)?h=[o.topLeftCorner[0]+D,o.topLeftCorner[1]-W]:h=[o.topLeftCorner[0]+360*D/b,o.topLeftCorner[1]-360*W/b],q(h,t),q(o.topLeftCorner,t),R(h),R(o.topLeftCorner),o.bounds=[...o.topLeftCorner,...h],[o.bounds[1],o.bounds[3]]=[o.bounds[3],o.bounds[1]],s.push(o)}),A(t)?t="EPSG:4326":M(t)&&(t="EPSG:3857"),{title:i,identifier:r,abstract:n,supportedCRS:t,tileMatrices:s}}function ae(e){const t=e.querySelector("Identifier").textContent,i=parseFloat(e.querySelector("TileWidth").textContent),r=parseFloat(e.querySelector("TileHeight").textContent),n=parseFloat(e.querySelector("MatrixWidth").textContent),s=parseFloat(e.querySelector("MatrixHeight").textContent),l=parseFloat(e.querySelector("ScaleDenominator").textContent),p=E(e.querySelector("TopLeftCorner").textContent);return{identifier:t,tileWidth:i,tileHeight:r,matrixWidth:n,matrixHeight:s,scaleDenominator:l,topLeftCorner:p,bounds:null}}function x(e,t){return[...e.children].filter(i=>i.tagName===t)}const U=window.location.hash.replace(/^#/,"")||"https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/wmts.cgi?SERVICE=WMTS&request=GetCapabilities",B=["EPSG:4326","EPSG:3857"];let a,w,m,u,f,C,c,y;ce();F();function ce(){m=new O({antialias:!0}),m.setPixelRatio(window.devicePixelRatio),m.setSize(window.innerWidth,window.innerHeight),m.setClearColor(1118481),m.setAnimationLoop(F),document.body.appendChild(m.domElement),w=new j,f=new k(60,window.innerWidth/window.innerHeight,.001,1e4),le(),I(),window.addEventListener("resize",I,!1),window.addEventListener("hashchange",()=>location.reload())}async function le(){y=await new ee().loadAsync(U);let e="MODIS_Terra_CorrectedReflectance_TrueColor";y.layers.find(t=>t.identifier===e)||(e=y.layers.find(t=>t.tileMatrixSets.some(i=>B.includes(i.supportedCRS))).identifier),c={layer:e,style:null,tileMatrixSet:null,planar:!1,dimensions:{}},H(),g()}function H(){var r;C&&C.destroy(),c.style=null,c.tileMatrixSet=null,c.dimensions={};const e=y.layers.find(n=>n.identifier===c.layer);c.style=((r=e.styles.find(n=>n.isDefault))==null?void 0:r.identifier)||e.styles[0].identifier;const t=e.tileMatrixSets.find(n=>B.includes(n.supportedCRS));c.tileMatrixSet=t?t.identifier:e.tileMatrixSets[0].identifier;const i=y.serviceIdentification.abstract;document.getElementById("info").innerHTML="<b>"+y.serviceIdentification.title+"</b>"+(i?"<br/>"+i:"")+"<br/>"+e.title,C=new Y,C.add(c,"planar").onChange(g),C.add(c,"layer",y.layers.map(n=>n.identifier)).onChange(()=>{H(),g()}),C.add(c,"tileMatrixSet",e.tileMatrixSets.map(n=>n.identifier)).onChange(g),C.add(c,"style",e.styles.map(n=>n.identifier)).onChange(g);for(const n in e.dimensions){const s=e.dimensions[n];c.dimensions[s.identifier]=e.dimensions[n].defaultValue;let l=s.values;s.identifier==="Time"&&/gibs.earthdata/.test(U)&&(l=l.flatMap(p=>{const d=p.split(/\//g);return d.pop(),d}),/^MODIS_Terra/.test(c.layer)&&(l.push("2013-06-16"),c.dimensions[s.identifier]="2013-06-16")),C.add(c.dimensions,s.identifier,l).onChange(g)}}function g(){u&&u.dispose(),a&&(a.dispose(),a=null),u=new V,u.registerPlugin(new $),u.registerPlugin(new N),u.registerPlugin(new Q({shape:c.planar?"planar":"ellipsoid",center:!0,capabilities:y,...c})),u.setCamera(f),w.add(u.group),c.planar?(a=new z(w,f,m.domElement),a.enableDamping=!0,a.minDistance=1e-4,a.maxDistance=5,a.cameraRadius=0,a.fallbackPlane.normal.set(0,0,1),a.up.set(0,0,1),a.camera.position.set(0,0,2),a.camera.quaternion.identity(),f.near=1e-4,f.far=10,f.updateProjectionMatrix()):(u.group.rotation.x=-Math.PI/2,a=new _(w,f,m.domElement),a.setEllipsoid(u.ellipsoid,u.group),a.enableDamping=!0,a.camera.position.set(0,0,1.75*1e7),a.camera.quaternion.identity(),a.minDistance=150)}function I(){const e=window.innerWidth/window.innerHeight;f.aspect=e,f.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)}function F(){a&&(a.update(),f.updateMatrixWorld()),u&&(u.setCamera(f),u.setResolutionFromRenderer(f,m),u.update()),m.render(w,f)}
//# sourceMappingURL=wmtsTiles-DQmK71Db.js.map
