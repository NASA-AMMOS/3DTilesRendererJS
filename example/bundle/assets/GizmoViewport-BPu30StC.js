import{_ as v}from"./constants-C0SaZ5SG.js";import{g as y,r as e,u as F,h as D}from"./CameraControls-CQWLZjoh.js";import{aG as Q,a3 as X,J as I,aH as Y,a4 as V,S as Z,o as P,aw as J,Q as O,n as K,aI as N}from"./three.module-D-uF--xd.js";function U(n,g,l){const o=y(u=>u.size),s=y(u=>u.viewport),f=typeof n=="number"?n:o.width*s.dpr,i=o.height*s.dpr,r=(typeof n=="number"?l:n)||{},{samples:c=0,depth:m,...d}=r,h=m??r.depthBuffer,p=e.useMemo(()=>{const u=new Q(f,i,{minFilter:I,magFilter:I,type:X,...d});return h&&(u.depthTexture=new Y(f,i,V)),u.samples=c,u},[]);return e.useLayoutEffect(()=>{p.setSize(f,i),c&&(p.samples=c)},[c,p,f,i]),e.useEffect(()=>()=>p.dispose(),[]),p}const $=n=>typeof n=="function",ee=e.forwardRef(({envMap:n,resolution:g=256,frames:l=1/0,children:o,makeDefault:s,...f},i)=>{const r=y(({set:t})=>t),c=y(({camera:t})=>t),m=y(({size:t})=>t),d=e.useRef(null);e.useImperativeHandle(i,()=>d.current,[]);const h=e.useRef(null),p=U(g);e.useLayoutEffect(()=>{f.manual||d.current.updateProjectionMatrix()},[m,f]),e.useLayoutEffect(()=>{d.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const t=c;return r(()=>({camera:d.current})),()=>r(()=>({camera:t}))}},[d,s,r]);let u=0,E=null;const a=$(o);return F(t=>{a&&(l===1/0||u<l)&&(h.current.visible=!1,t.gl.setRenderTarget(p),E=t.scene.background,n&&(t.scene.background=n),t.gl.render(t.scene,d.current),t.scene.background=E,t.gl.setRenderTarget(null),h.current.visible=!0,u++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",v({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:d},f),!a&&o),e.createElement("group",{ref:h},a&&o(p.texture)))});function te({defaultScene:n,defaultCamera:g,renderPriority:l=1}){const{gl:o,scene:s,camera:f}=y();let i;return F(()=>{i=o.autoClear,l===1&&(o.autoClear=!0,o.render(n,g)),o.autoClear=!1,o.clearDepth(),o.render(s,f),o.autoClear=i},l),e.createElement("group",{onPointerOver:()=>null})}function ne({children:n,renderPriority:g=1}){const{scene:l,camera:o}=y(),[s]=e.useState(()=>new Z);return e.createElement(e.Fragment,null,D(e.createElement(e.Fragment,null,n,e.createElement(te,{defaultScene:l,defaultCamera:o,renderPriority:g})),s,{events:{priority:g+1}}))}const k=e.createContext({}),re=()=>e.useContext(k),oe=2*Math.PI,R=new J,A=new K,[w,M]=[new O,new O],G=new P,L=new P,ae=n=>"minPolarAngle"in n,q=n=>"getTarget"in n,ue=({alignment:n="bottom-right",margin:g=[80,80],renderPriority:l=1,onUpdate:o,onTarget:s,children:f})=>{const i=y(x=>x.size),r=y(x=>x.camera),c=y(x=>x.controls),m=y(x=>x.invalidate),d=e.useRef(null),h=e.useRef(null),p=e.useRef(!1),u=e.useRef(0),E=e.useRef(new P(0,0,0)),a=e.useRef(new P(0,0,0));e.useEffect(()=>{a.current.copy(r.up),R.up.copy(r.up)},[r]);const t=e.useCallback(x=>{p.current=!0,(c||s)&&(E.current=(s==null?void 0:s())||(q(c)?c.getTarget(E.current):c==null?void 0:c.target)),u.current=r.position.distanceTo(G),w.copy(r.quaternion),L.copy(x).multiplyScalar(u.current).add(G),R.lookAt(L),M.copy(R.quaternion),m()},[c,r,s,m]);F((x,z)=>{if(h.current&&d.current){var H;if(p.current)if(w.angleTo(M)<.01)p.current=!1,ae(c)&&r.up.copy(a.current);else{const B=z*oe;w.rotateTowards(M,B),r.position.set(0,0,1).applyQuaternion(w).multiplyScalar(u.current).add(E.current),r.up.set(0,1,0).applyQuaternion(w).normalize(),r.quaternion.copy(w),q(c)&&c.setPosition(r.position.x,r.position.y,r.position.z),o?o():c&&c.update(z),m()}A.copy(r.matrix).invert(),(H=d.current)==null||H.quaternion.setFromRotationMatrix(A)}});const W=e.useMemo(()=>({tweenCamera:t}),[t]),[T,b]=g,_=n.endsWith("-center")?0:n.endsWith("-left")?-i.width/2+T:i.width/2-T,j=n.startsWith("center-")?0:n.startsWith("top-")?i.height/2-b:-i.height/2+b;return e.createElement(ne,{renderPriority:l},e.createElement(k.Provider,{value:W},e.createElement(ee,{makeDefault:!0,ref:h,position:[0,0,200]}),e.createElement("group",{ref:d,position:[_,j,0]},f)))};function S({scale:n=[.8,.05,.05],color:g,rotation:l}){return e.createElement("group",{rotation:l},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:n}),e.createElement("meshBasicMaterial",{color:g,toneMapped:!1})))}function C({onClick:n,font:g,disabled:l,arcStyle:o,label:s,labelColor:f,axisHeadScale:i=1,...r}){const c=y(a=>a.gl),m=e.useMemo(()=>{const a=document.createElement("canvas");a.width=64,a.height=64;const t=a.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=o,t.fill(),s&&(t.font=g,t.textAlign="center",t.fillStyle=f,t.fillText(s,32,41)),new N(a)},[o,s,f,g]),[d,h]=e.useState(!1),p=(s?1:.75)*(d?1.2:1)*i,u=a=>{a.stopPropagation(),h(!0)},E=a=>{a.stopPropagation(),h(!1)};return e.createElement("sprite",v({scale:p,onPointerOver:l?void 0:u,onPointerOut:l?void 0:n||E},r),e.createElement("spriteMaterial",{map:m,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const le=({hideNegativeAxes:n,hideAxisHeads:g,disabled:l,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:f=1,axisScale:i,labels:r=["X","Y","Z"],labelColor:c="#000",onClick:m,...d})=>{const[h,p,u]=s,{tweenCamera:E}=re(),a={font:o,disabled:l,labelColor:c,onClick:m,axisHeadScale:f,onPointerDown:l?void 0:t=>{E(t.object.position),t.stopPropagation()}};return e.createElement("group",v({scale:40},d),e.createElement(S,{color:h,rotation:[0,0,0],scale:i}),e.createElement(S,{color:p,rotation:[0,0,Math.PI/2],scale:i}),e.createElement(S,{color:u,rotation:[0,-Math.PI/2,0],scale:i}),!g&&e.createElement(e.Fragment,null,e.createElement(C,v({arcStyle:h,position:[1,0,0],label:r[0]},a)),e.createElement(C,v({arcStyle:p,position:[0,1,0],label:r[1]},a)),e.createElement(C,v({arcStyle:u,position:[0,0,1],label:r[2]},a)),!n&&e.createElement(e.Fragment,null,e.createElement(C,v({arcStyle:h,position:[-1,0,0]},a)),e.createElement(C,v({arcStyle:p,position:[0,-1,0]},a)),e.createElement(C,v({arcStyle:u,position:[0,0,-1]},a)))))};export{ue as G,le as a,U as u};
//# sourceMappingURL=GizmoViewport-BPu30StC.js.map
