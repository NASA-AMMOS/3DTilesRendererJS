import { Scene, WebGLRenderer, PerspectiveCamera, MathUtils } from 'three';
import { TilesRenderer, GlobeControls, CAMERA_FRAME } from '3d-tiles-renderer';
import {
	GeoJSONOverlay,
	ImageOverlayPlugin,
	TilesFadePlugin,
	UpdateOnChangePlugin,
	XYZTilesPlugin,
} from '3d-tiles-renderer/plugins';
import GUI from 'three/examples/jsm/libs/lil-gui.module.min.js';

const geojson = {
	type: 'FeatureCollection',
	features: [
		{

			type: 'Feature',
			geometry: { type: 'Point', coordinates: [ 8.9463, 44.4056 ] },
			properties: { name: 'Genoa' },

		},
		{

			type: 'Feature',
			geometry: { type: 'Point', coordinates: [ 12.4964, 41.9028 ] },
			properties: { name: 'Rome' },

		},
		{

			type: 'Feature',
			geometry: { type: 'Point', coordinates: [ 13.4050, 52.5200 ] },
			properties: { name: 'Berlin' },

		},
		{

			type: 'Feature',
			geometry: { type: 'Point', coordinates: [ 2.3522, 48.8566 ] },
			properties: { name: 'Paris' },

		},
		{

			type: 'Feature',
			geometry: { type: 'Point', coordinates: [ 0.1276, 51.5074 ] },
			properties: { name: 'London' },

		},
		//set a little polygon
		{

			type: 'Feature',
			geometry: {
				type: 'Polygon',
				coordinates: [
					[
						[ 8.851613286878727, 44.49153006321899 ], [ 8.851649549484305, 44.491464390916875 ], [ 8.851709487146868, 44.49143638045494 ], [ 8.85236862586341, 44.49079750535949 ], [ 8.852709926848695, 44.49061186101394 ], [ 8.853191705663788, 44.489976173236165 ], [ 8.852841879576914, 44.489853016793646 ], [ 8.852654112135296, 44.4896521954316 ], [ 8.852672830906132, 44.48951042765954 ], [ 8.85275662306107, 44.48914781846217 ], [ 8.852688248130756, 44.488881521571365 ], [ 8.852601910291925, 44.48855704424451 ], [ 8.852441465003695, 44.488345724626605 ], [ 8.8522993985964, 44.48812794662537 ], [ 8.852016864365792, 44.48775775148269 ], [ 8.851856364815372, 44.48756956779132 ], [ 8.851576760762095, 44.48718668156636 ], [ 8.851397863690448, 44.48706356257526 ], [ 8.851319841684022, 44.48698432761038 ], [ 8.85124236480903, 44.48674016446303 ], [ 8.851068687552786, 44.48644456065872 ], [ 8.850775577280316, 44.48608542182655 ], [ 8.849710509938536, 44.48584680510233 ], [ 8.849297742931867, 44.48566242676943 ], [ 8.848664373255902, 44.48553699241861 ], [ 8.847971286698018, 44.48545414773048 ], [ 8.848041346035043, 44.48506181464897 ], [ 8.848152519288908, 44.4847207613506 ], [ 8.848260062062922, 44.484033280360755 ], [ 8.848510948126403, 44.48301045982195 ], [ 8.848737723088597, 44.48245817634232 ], [ 8.848812422934616, 44.48201849466396 ], [ 8.84883179667543, 44.48147962024992 ], [ 8.848832103061024, 44.48136096540721 ], [ 8.849100113821251, 44.48080864558794 ], [ 8.84951034897734, 44.48039902492391 ], [ 8.849695161722346, 44.47997173117419 ], [ 8.849746032921164, 44.47984648084491 ], [ 8.84973708205482, 44.47975743259491 ], [ 8.849696160858795, 44.47958254676318 ], [ 8.849694347305002, 44.47956280354205 ], [ 8.849683316654607, 44.479442718280595 ], [ 8.84928389660702, 44.479122326793394 ], [ 8.849109597722135, 44.47893412074871 ], [ 8.848821188675062, 44.47872136619635 ], [ 8.848777779880052, 44.47868331742926 ], [ 8.848794936421703, 44.478661823740346 ], [ 8.848802126988005, 44.47865283058028 ], [ 8.848652886203707, 44.478549372200206 ], [ 8.84855098430222, 44.47842301956993 ], [ 8.84843671821228, 44.478312855262836 ], [ 8.848293533890036, 44.47820193221959 ], [ 8.848371872587997, 44.47800712822808 ], [ 8.848418358422279, 44.47787629096361 ], [ 8.848428061759227, 44.47772235801081 ], [ 8.848420659148987, 44.47752185849509 ], [ 8.84842117468852, 44.477419858807814 ], [ 8.848431585895163, 44.47733245659352 ], [ 8.848486509447714, 44.477293457828104 ], [ 8.84865396448368, 44.47720797431245 ], [ 8.848798175861635, 44.47716396214299 ], [ 8.848976218273137, 44.4771171136701 ], [ 8.849215397143153, 44.47705963245261 ], [ 8.849363648981916, 44.477008782864004 ], [ 8.849501332259958, 44.476960349881644 ], [ 8.849538557753657, 44.47690881355976 ], [ 8.849556205998994, 44.47679351245487 ], [ 8.849608445861955, 44.47662397072428 ], [ 8.849708158542471, 44.476427213312476 ], [ 8.849854235103932, 44.47619414592507 ], [ 8.849910005675758, 44.476118236581414 ], [ 8.849907842101098, 44.47607934214864 ], [ 8.849904112258972, 44.476013797715915 ], [ 8.849902188165014, 44.475979584992196 ], [ 8.8498866671233, 44.47580500256882 ], [ 8.849840740475912, 44.47562164756636 ], [ 8.849786204054517, 44.47546168819489 ], [ 8.849734196495632, 44.475296330509394 ], [ 8.849652665592398, 44.475072596543065 ], [ 8.849587151989944, 44.47492792717537 ], [ 8.849523509802102, 44.47474013737113 ], [ 8.849510944268648, 44.47473705990343 ], [ 8.849485059496066, 44.474730633890104 ], [ 8.849473231476686, 44.47473412935012 ], [ 8.849460522855061, 44.47473780370202 ], [ 8.849442462436016, 44.474622365475064 ], [ 8.84905940016537, 44.47411527879018 ], [ 8.849053886957682, 44.474107889301926 ], [ 8.84904007725498, 44.47409976863372 ], [ 8.848444136240694, 44.47374670433737 ], [ 8.847943026737603, 44.47348171944702 ], [ 8.84782504255148, 44.473410171676676 ], [ 8.8473999694852, 44.473152397122895 ], [ 8.847339415928017, 44.473133680643365 ], [ 8.847147955801281, 44.473074727065196 ], [ 8.846474306919836, 44.47306824192125 ], [ 8.845304895335259, 44.47301651913672 ], [ 8.845067472071516, 44.472985498169116 ], [ 8.844710893416888, 44.472940540659124 ], [ 8.844543672592074, 44.47289286902567 ], [ 8.844368560723998, 44.4728340230623 ], [ 8.844060847700893, 44.47285313920475 ], [ 8.843823083392422, 44.47295049351271 ], [ 8.84364635014477, 44.47302821499854 ], [ 8.843459462715884, 44.4730474948517 ], [ 8.843237475253533, 44.47302765456698 ], [ 8.842883414410746, 44.472935070589756 ], [ 8.842700426374336, 44.47290691040055 ], [ 8.842223169178945, 44.472714404864085 ], [ 8.841915719781781, 44.47263583642566 ], [ 8.841853395665519, 44.47262179598349 ], [ 8.84157049855131, 44.47253065684273 ], [ 8.841313361535873, 44.47263076989246 ], [ 8.841352665804108, 44.47246328446088 ], [ 8.841081551510591, 44.47192256618378 ], [ 8.840685759585353, 44.471413812984004 ], [ 8.840407666403465, 44.471131280445874 ], [ 8.840354410251237, 44.47065100248582 ], [ 8.840207876743015, 44.470167263009344 ], [ 8.84006821282539, 44.46997720075707 ], [ 8.839796529600793, 44.46965299316709 ], [ 8.839392901555449, 44.469398190279136 ], [ 8.839268816329854, 44.46921373059835 ], [ 8.839074766256552, 44.46900684554388 ], [ 8.838880622541222, 44.46878879667929 ], [ 8.838532299276952, 44.46849652747451 ], [ 8.838439705436448, 44.46820038793086 ], [ 8.838253546573997, 44.46791527918139 ], [ 8.837942554978484, 44.46771938984026 ], [ 8.837803290650822, 44.46738978351047 ], [ 8.837741586140567, 44.46719982899933 ], [ 8.837697739205682, 44.46664502049977 ], [ 8.837729997816453, 44.46620951580307 ], [ 8.837598926445208, 44.46573785818587 ], [ 8.837521434240736, 44.4656205328362 ], [ 8.837148523957904, 44.46531841132975 ], [ 8.836370211221142, 44.46514417707116 ], [ 8.8366077514667, 44.46489487224075 ], [ 8.836693939105757, 44.464733036916094 ], [ 8.83683443522445, 44.46461593251138 ], [ 8.837022059866571, 44.464277608790844 ], [ 8.837186107171673, 44.4640991391208 ], [ 8.837264418778942, 44.463920547090176 ], [ 8.837032418828738, 44.463536431115344 ], [ 8.836931594123547, 44.46335758356739 ], [ 8.836534852342712, 44.46286240794945 ], [ 8.83623918436624, 44.46277267760608 ], [ 8.83595145212222, 44.46263263277868 ], [ 8.835702690618918, 44.46249264328589 ], [ 8.835432063300438, 44.46235046109703 ], [ 8.835331277086745, 44.46220510221651 ], [ 8.835183649965785, 44.46208758404857 ], [ 8.835082691974351, 44.46195896972562 ], [ 8.834935521941542, 44.4617242366683 ], [ 8.834633171800428, 44.46124359500365 ], [ 8.834533399681051, 44.461096616372075 ], [ 8.83448711089009, 44.460929008937185 ], [ 8.834409931261938, 44.46070553991586 ], [ 8.834332531815548, 44.46051556058625 ], [ 8.834224352985455, 44.46023055796364 ], [ 8.833976175479297, 44.45988953502637 ], [ 8.833597281172645, 44.459456403511616 ], [ 8.832608550148176, 44.459399142005864 ], [ 8.832391459352891, 44.459224891309766 ], [ 8.83203813325447, 44.45899876438977 ], [ 8.831999615683669, 44.45875428416891 ], [ 8.831817389506678, 44.45830280015021 ], [ 8.831805450352089, 44.45790792365938 ], [ 8.831965151540487, 44.457052721006285 ], [ 8.832201896544039, 44.45654945726774 ], [ 8.83246457993565, 44.4563805918454 ], [ 8.832683824343327, 44.45619320662677 ], [ 8.833053427022431, 44.456039620969506 ], [ 8.833434039923196, 44.45563793534665 ], [ 8.834057425474198, 44.45499118735327 ], [ 8.834066123427643, 44.45498228730051 ], [ 8.833617891539227, 44.45507580366669 ], [ 8.83333113445294, 44.45513867469097 ], [ 8.832768478478497, 44.455378854990315 ], [ 8.832603034877128, 44.455433979344335 ], [ 8.832531412816055, 44.45542595196672 ], [ 8.832350249583587, 44.45522015420983 ], [ 8.831853723819732, 44.45435813447171 ], [ 8.831514085958476, 44.45397222765214 ], [ 8.831109402426648, 44.453435788212516 ], [ 8.830913639712573, 44.45315353343406 ], [ 8.830769964846825, 44.4529840695372 ], [ 8.830482508490032, 44.45268286242376 ], [ 8.830275825230233, 44.45239761940963 ], [ 8.830171548167915, 44.45220939758722 ], [ 8.830001598660582, 44.452086977856155 ], [ 8.829779113793782, 44.45196438956267 ], [ 8.829635390158522, 44.451813829845236 ], [ 8.829637887821901, 44.45108434303437 ], [ 8.829744783087774, 44.45037004633741 ], [ 8.829851402599727, 44.44974982751 ], [ 8.82985143004269, 44.44974037469031 ], [ 8.830089375688592, 44.44903572550534 ], [ 8.830076544701589, 44.44886636514896 ], [ 8.830361987121206, 44.448466708287654 ], [ 8.830184531036448, 44.44794572688033 ], [ 8.830133185275203, 44.447492723308066 ], [ 8.830134541459692, 44.44702476350785 ], [ 8.83010415657267, 44.44662472706788 ], [ 8.83026311731, 44.44624000668039 ], [ 8.830023238465028, 44.445492423330116 ], [ 8.829782736020475, 44.4449184111245 ], [ 8.82965768803184, 44.444487984126894 ], [ 8.8294479610193, 44.44422353097994 ], [ 8.829196513593525, 44.44382982582871 ], [ 8.829071390642786, 44.443384273401335 ], [ 8.829031229511516, 44.44271999151012 ], [ 8.829126420854484, 44.442569248105144 ], [ 8.829201549522917, 44.44210139824927 ], [ 8.829655074020533, 44.441754839956154 ], [ 8.830045138475821, 44.441536564470475 ], [ 8.830530036753874, 44.44128817918839 ], [ 8.83068906210419, 44.440918582542196 ], [ 8.830890426108374, 44.44042075931069 ], [ 8.830996817301019, 44.44004352193937 ], [ 8.831188117018653, 44.4393731907035 ], [ 8.831176833720383, 44.43936417128628 ], [ 8.830915060876784, 44.439155370626715 ], [ 8.830694656131984, 44.43898147129412 ], [ 8.830474716366652, 44.438603750145695 ], [ 8.830181303837906, 44.438127789442575 ], [ 8.829981911435231, 44.43794635763735 ], [ 8.829751008762345, 44.43771203241292 ], [ 8.829415964591764, 44.43716704658943 ], [ 8.829247677292663, 44.43713654591826 ], [ 8.829110994966628, 44.43708349539935 ], [ 8.829048269097273, 44.436962674733834 ], [ 8.828955354427864, 44.436336034604075 ], [ 8.82855620015291, 44.43606373331766 ], [ 8.82803318139241, 44.43569770567138 ], [ 8.827937426029923, 44.43531557491713 ], [ 8.82793824547518, 44.4350363109268 ], [ 8.828054941769567, 44.434704375285285 ], [ 8.827803120554869, 44.434454979909184 ], [ 8.827320023442839, 44.43410701457034 ], [ 8.826794840668558, 44.4337589833572 ], [ 8.82656358749965, 44.43365303020087 ], [ 8.826197142802341, 44.433461344819825 ], [ 8.825997509840427, 44.43337047321434 ], [ 8.825850419533396, 44.43327211906938 ], [ 8.825840111875822, 44.433189097994024 ], [ 8.825777576360403, 44.4330078672829 ], [ 8.825684433579989, 44.432471791393816 ], [ 8.825528264911103, 44.431920584529 ], [ 8.825360655371751, 44.431626028399606 ], [ 8.825099025605594, 44.431134978025085 ], [ 8.824889907855455, 44.43068929138037 ], [ 8.824753763152184, 44.430462663302016 ], [ 8.824319989453649, 44.42981370854925 ], [ 8.824241020826902, 44.42958482703356 ], [ 8.824199588445568, 44.42936590626449 ], [ 8.82420056125168, 44.429041358378015 ], [ 8.824274771866417, 44.42884521246277 ], [ 8.824392583752287, 44.428143448610754 ], [ 8.82443505511868, 44.42801522458844 ], [ 8.824551002437135, 44.42797759115801 ], [ 8.824698357707105, 44.42794009584427 ], [ 8.82487714715278, 44.42797809165734 ], [ 8.824971874856818, 44.427978236851274 ], [ 8.825003431174652, 44.42797081291199 ], [ 8.82503520362127, 44.42793304999782 ], [ 8.8250354286702, 44.42785760722286 ], [ 8.824920969045468, 44.427397030726326 ], [ 8.824889750874322, 44.42729129047162 ], [ 8.824753230721203, 44.42719295101388 ], [ 8.824690308579394, 44.42710228669178 ], [ 8.824553779381096, 44.42704923086278 ], [ 8.824332861131593, 44.42702629439149 ], [ 8.824112101794622, 44.42695042150666 ], [ 8.823985887401708, 44.426935192474275 ], [ 8.82393349730749, 44.42685201625159 ], [ 8.82373596470314, 44.426029039280486 ], [ 8.82369412835107, 44.425945969248005 ], [ 8.823589498728131, 44.425772234448466 ], [ 8.823495410661877, 44.425560704235 ], [ 8.823433213905487, 44.425313752352345 ], [ 8.823461053981172, 44.424954495102305 ], [ 8.823444451092133, 44.424543763352354 ], [ 8.823392258097599, 44.42435435453117 ], [ 8.823389772686548, 44.42434534792379 ], [ 8.823001758264583, 44.42445521124271 ], [ 8.822659237401586, 44.42443442374563 ], [ 8.822583975746811, 44.42443817805982 ], [ 8.822467970943997, 44.42445519309772 ], [ 8.82240026371017, 44.424453377318194 ], [ 8.822306834241896, 44.42444125833491 ], [ 8.82225956408905, 44.42441120558327 ], [ 8.822183739259629, 44.42439353217812 ], [ 8.822129727235856, 44.424391107363796 ], [ 8.822114991335923, 44.42440350823077 ], [ 8.822094574443673, 44.42446649578333 ], [ 8.822069042869645, 44.424476178999896 ], [ 8.822024435519229, 44.42447944052704 ], [ 8.821925619747049, 44.424462181263614 ], [ 8.821886789399864, 44.424424669220734 ], [ 8.821849045729419, 44.42431891790453 ], [ 8.821815822737179, 44.424296539226596 ], [ 8.821778551031402, 44.42428360712467 ], [ 8.821656445119276, 44.42424137362803 ], [ 8.821521975224822, 44.424216496017955 ], [ 8.821448046487353, 44.424195133953006 ], [ 8.821297747715922, 44.42417032136188 ], [ 8.821151518951428, 44.424170362576504 ], [ 8.821047590511169, 44.42418208344974 ], [ 8.82089771968102, 44.424181758522806 ], [ 8.820814266190025, 44.42419414148016 ], [ 8.820542148333162, 44.424239088210165 ], [ 8.820540487659498, 44.42424808836569 ], [ 8.820470996766737, 44.42462393460422 ], [ 8.820423319126999, 44.42505554217695 ], [ 8.820433426902154, 44.42557024602534 ], [ 8.820558365118094, 44.42632991536574 ], [ 8.820762930397102, 44.42755065074598 ], [ 8.821014851728274, 44.42844763051835 ], [ 8.820898635384697, 44.42861345920558 ], [ 8.820874124018774, 44.429070040622896 ], [ 8.820732379392169, 44.42998305784657 ], [ 8.819654333627732, 44.430904053157704 ], [ 8.81909029427096, 44.4298986338179 ], [ 8.81883508812698, 44.43007261270437 ], [ 8.818660968718474, 44.4302300646794 ], [ 8.818572799288754, 44.430220651830766 ], [ 8.818145244717114, 44.42997923824166 ], [ 8.817925046948316, 44.43004523775963 ], [ 8.817217253874722, 44.430592105018384 ], [ 8.816694560885226, 44.431165012912764 ], [ 8.816403470017612, 44.43172073549043 ], [ 8.816019904864099, 44.432234895700695 ], [ 8.815752677067486, 44.43254992138007 ], [ 8.81527671013867, 44.43299748963253 ], [ 8.815263220923008, 44.433570222789136 ], [ 8.815273467555372, 44.434026858813546 ], [ 8.815225822096243, 44.434433615966164 ], [ 8.815235236587727, 44.43511441899259 ], [ 8.815106226753358, 44.43566211741417 ], [ 8.815047568933508, 44.43589447335883 ], [ 8.815070289216328, 44.43633987597994 ], [ 8.814953359059253, 44.43672158305502 ], [ 8.814835829778197, 44.43725273456558 ], [ 8.814834872807614, 44.43755576536874 ], [ 8.814847432807174, 44.43755749625025 ], [ 8.815993797032453, 44.43771230534446 ], [ 8.816454181154704, 44.437918038531535 ], [ 8.816997896430745, 44.438077719325776 ], [ 8.81743960955144, 44.43834958876892 ], [ 8.817983085579641, 44.43858848860879 ], [ 8.818517451360641, 44.4387679532841 ], [ 8.819061422074833, 44.43880851836883 ], [ 8.819559665274827, 44.4388454975656 ], [ 8.819590045527193, 44.43901821813377 ], [ 8.81939167775267, 44.43937045198298 ], [ 8.818900519154493, 44.440130225788636 ], [ 8.818539264250044, 44.44065217142234 ], [ 8.818307570100794, 44.44100894173392 ], [ 8.818048350662282, 44.44132596563694 ], [ 8.81790946259527, 44.44149769659403 ], [ 8.817511530879566, 44.441927842489896 ], [ 8.817372454429401, 44.44215908056157 ], [ 8.81717717500582, 44.442641584890396 ], [ 8.816880894686541, 44.44303137885213 ], [ 8.816686519966781, 44.44326252737661 ], [ 8.816491873189293, 44.44353994917691 ], [ 8.816260963566295, 44.44363878809447 ], [ 8.816011290660617, 44.44386984647807 ], [ 8.815854187478287, 44.443955569412864 ], [ 8.815724440428214, 44.444173676444656 ], [ 8.815640895531834, 44.44432559778918 ], [ 8.815465088009022, 44.4444841220974 ], [ 8.815196851521083, 44.444741616706 ], [ 8.81497498418634, 44.44491978170003 ], [ 8.814863663175922, 44.44511144953233 ], [ 8.814817228791293, 44.445210584360574 ], [ 8.81463197081732, 44.44545497809387 ], [ 8.81469520236464, 44.445727323272216 ], [ 8.814796201661439, 44.44589943923228 ], [ 8.814804874248399, 44.44605817142694 ], [ 8.8146845229864, 44.44620346034608 ], [ 8.814600742120785, 44.44642821257412 ], [ 8.81455390890633, 44.44665293469724 ], [ 8.814571127498358, 44.447049802936256 ], [ 8.814800527887265, 44.447433781364225 ], [ 8.815030599212424, 44.447606106270385 ], [ 8.815454213490119, 44.44781844560276 ], [ 8.815674843491356, 44.44807672998745 ], [ 8.815821369355028, 44.44840106450703 ], [ 8.815912702588392, 44.44869217985031 ], [ 8.816155961196506, 44.44911038813611 ], [ 8.816160466464886, 44.449196641494446 ], [ 8.815952844396216, 44.44959665830908 ], [ 8.815913690164942, 44.44989827650098 ], [ 8.816088398433802, 44.450255065795865 ], [ 8.816166302222694, 44.45038131935813 ], [ 8.816364253939824, 44.45066135238296 ], [ 8.816553360722027, 44.45091688344116 ], [ 8.816660219298114, 44.45098835657314 ], [ 8.81681252384294, 44.45119701395578 ], [ 8.816811786840146, 44.451432794056196 ], [ 8.816634788466272, 44.45176525062847 ], [ 8.816687266160011, 44.45210545765164 ], [ 8.816701947889939, 44.45231389418875 ], [ 8.81651734809536, 44.452664523822214 ], [ 8.816288146898613, 44.45300877950475 ], [ 8.816128132158877, 44.453093417667674 ], [ 8.816041457629776, 44.453237591689934 ], [ 8.816021050785134, 44.45361234198874 ], [ 8.816125657914439, 44.45388196178017 ], [ 8.816062841420438, 44.45403310629534 ], [ 8.815995161890802, 44.454211791252455 ], [ 8.816028127505211, 44.45440090141062 ], [ 8.816008569199925, 44.45454527348358 ], [ 8.815898022854281, 44.45468562776313 ], [ 8.815830471935845, 44.45482299034228 ], [ 8.81559038956607, 44.454946390329184 ], [ 8.81552307130044, 44.45504945274861 ], [ 8.815560866269596, 44.45522137562674 ], [ 8.815416468149834, 44.45541371045044 ], [ 8.815195336137078, 44.45558521471457 ], [ 8.814909723723824, 44.455676579941866 ], [ 8.81466010488207, 44.45579312043756 ], [ 8.814448669288907, 44.45595779691491 ], [ 8.814189043039546, 44.45617740119429 ], [ 8.814102162651553, 44.45638351200174 ], [ 8.813947767562778, 44.45671330008984 ], [ 8.813861546320839, 44.45690923870289 ], [ 8.813861022090592, 44.45707425757282 ], [ 8.813668423198813, 44.45732142810804 ], [ 8.81361950480405, 44.45764454565465 ], [ 8.813781878399734, 44.45785106261364 ], [ 8.813550632167276, 44.458194498908384 ], [ 8.813360073290342, 44.45843104900632 ], [ 8.813340572714283, 44.45855480440746 ], [ 8.81332094635569, 44.45867855959698 ], [ 8.813282060374021, 44.45885035776864 ], [ 8.813291103784433, 44.45904978256965 ], [ 8.813306484674786, 44.45915387903104 ], [ 8.813255741433, 44.459338531672024 ], [ 8.813176758255722, 44.459430770305744 ], [ 8.813168939038716, 44.459635929247256 ], [ 8.813110877368851, 44.45990780607933 ], [ 8.813052815156007, 44.460179682867974 ], [ 8.81297277321575, 44.46040624000863 ], [ 8.812761760060733, 44.460550027639584 ], [ 8.812473395655926, 44.460981864547705 ], [ 8.812549334827349, 44.46117410694969 ], [ 8.812395185331782, 44.46177379416927 ], [ 8.812279234873042, 44.46210292260919 ], [ 8.812134621544253, 44.46243209379946 ], [ 8.812105519930084, 44.46256933716644 ], [ 8.812200457597799, 44.46279591129844 ], [ 8.811902444562463, 44.462939284123024 ], [ 8.811935451766042, 44.463151982321826 ], [ 8.811793111350427, 44.463398331898034 ], [ 8.811873197448943, 44.46363046347181 ], [ 8.812028561890456, 44.4638698310237 ], [ 8.812385257994123, 44.464049301158695 ], [ 8.812222863888383, 44.464237550867715 ], [ 8.811622068468417, 44.46451690569849 ], [ 8.811405662105823, 44.46472928240192 ], [ 8.81131142199302, 44.46494960288911 ], [ 8.811054595690116, 44.465142556327045 ], [ 8.811020125014972, 44.46538413175719 ], [ 8.810952537369598, 44.4655644340056 ], [ 8.810992330863181, 44.46577723363743 ], [ 8.81101211864841, 44.465917438398115 ], [ 8.811011744239527, 44.466033482561926 ], [ 8.810997871812553, 44.4661639087059 ], [ 8.810969657352246, 44.466531262116156 ], [ 8.810995746121678, 44.4667447592449 ], [ 8.811035603294417, 44.46693811309756 ], [ 8.811109059219554, 44.46716060120833 ], [ 8.811169094018291, 44.46733472259699 ], [ 8.811269782862647, 44.4674944167893 ], [ 8.8113298184783, 44.467668538084666 ], [ 8.811503972192913, 44.467853740988744 ], [ 8.811651666228062, 44.46801837384757 ], [ 8.811664295856886, 44.46831323293456 ], [ 8.811724038004186, 44.468579271024 ], [ 8.811783782587817, 44.46888384060369 ], [ 8.811850501364974, 44.46909182272337 ], [ 8.812172787766592, 44.46926907602631 ], [ 8.81241450423107, 44.46959816157759 ], [ 8.812345937994714, 44.46992673725266 ], [ 8.81229091996588, 44.47030367958766 ], [ 8.812222506914035, 44.47058400097494 ], [ 8.812072602108797, 44.47110582047197 ], [ 8.811978375547755, 44.47135864099499 ], [ 8.811774715758677, 44.471822394210974 ], [ 8.811719908331588, 44.47209301473828 ], [ 8.811691757657854, 44.47244101226947 ], [ 8.811542185476016, 44.47285650970831 ], [ 8.811433313335037, 44.47316566235952 ], [ 8.81117635783901, 44.473387604228115 ], [ 8.811155693042755, 44.47349688876871 ], [ 8.812375277175915, 44.47411402722474 ], [ 8.812703739194252, 44.474099261738004 ], [ 8.812996493349203, 44.47408434682376 ], [ 8.813403472633949, 44.474090143944224 ], [ 8.813571844614422, 44.474085287351365 ], [ 8.814014434461678, 44.4741218395703 ], [ 8.814449906893138, 44.47414298391974 ], [ 8.814856890523247, 44.47410781364902 ], [ 8.815042548681504, 44.47412350902984 ], [ 8.815427802624907, 44.4742008351054 ], [ 8.815613445359556, 44.47422157103697 ], [ 8.815891881739171, 44.474201584083744 ], [ 8.816220519982686, 44.47413054198328 ], [ 8.816392005694398, 44.474094987085024 ], [ 8.816706467117111, 44.47401365773316 ], [ 8.817224985892429, 44.47389394267927 ], [ 8.817660856167114, 44.47378714725503 ], [ 8.818239493287043, 44.4736602313707 ], [ 8.818646818709636, 44.473553476778704 ], [ 8.818997108347824, 44.47343123576825 ], [ 8.819475893603535, 44.473268324640486 ], [ 8.819704598143916, 44.47318685145162 ], [ 8.820233483041413, 44.473003490084466 ], [ 8.820702197757008, 44.472842268464184 ], [ 8.820995334419218, 44.472699495477684 ], [ 8.821267283091052, 44.47249529024847 ], [ 8.821403365851202, 44.47235740187125 ], [ 8.821568019589426, 44.472209294899784 ], [ 8.821732438732905, 44.47213798025709 ], [ 8.821946959661451, 44.47204621735857 ], [ 8.822239949670122, 44.47194944467033 ], [ 8.82254722501475, 44.47186808802217 ], [ 8.82285426539747, 44.4718225608855 ], [ 8.823061369709517, 44.47181261883258 ], [ 8.823726591473411, 44.47177277518034 ], [ 8.824075314033902, 44.471788437341104 ], [ 8.824568692926805, 44.47190704139189 ], [ 8.824932372344986, 44.47205083217276 ], [ 8.825146135931819, 44.47216882475617 ], [ 8.825445738776448, 44.47225624898277 ], [ 8.82575249405316, 44.472348724839314 ], [ 8.82620939221462, 44.472349420941455 ], [ 8.827665927425624, 44.472277085567775 ], [ 8.827979912904706, 44.472349130247764 ], [ 8.828365073060922, 44.47250320550187 ], [ 8.82887774392417, 44.472995161377355 ], [ 8.829417891529184, 44.47385545585155 ], [ 8.829623842372456, 44.47415762330262 ], [ 8.829722633784117, 44.47438580864601 ], [ 8.829690489885722, 44.474413939127004 ], [ 8.829633687334537, 44.47453359012985 ], [ 8.829454542543802, 44.47474047456456 ], [ 8.829336513701005, 44.474814480393306 ], [ 8.829104281511283, 44.47485770615815 ], [ 8.828918445169087, 44.47490091092579 ], [ 8.828811005630657, 44.47500815197503 ], [ 8.828678514470935, 44.47512561840845 ], [ 8.828595990184642, 44.47526881732851 ], [ 8.828520782418371, 44.475360801899356 ], [ 8.828420277499724, 44.47550388366384 ], [ 8.828343046938352, 44.475642318921416 ], [ 8.82819622504298, 44.475800725452316 ], [ 8.828017522126391, 44.47585411250797 ], [ 8.82783162147039, 44.47591784151979 ], [ 8.827710180424576, 44.475953489080176 ], [ 8.827560026228076, 44.47600439772685 ], [ 8.827391624924921, 44.47618833825063 ], [ 8.827237556622332, 44.47637230020023 ], [ 8.827136986229963, 44.47653590682552 ], [ 8.827058193519939, 44.47664832107459 ], [ 8.82702573998142, 44.476737848614256 ], [ 8.827004311685336, 44.4768408068378 ], [ 8.826982573311696, 44.47696357048443 ], [ 8.826957279144748, 44.47705562959497 ], [ 8.826846122069554, 44.47722687218379 ], [ 8.826752360647962, 44.47751067455176 ], [ 8.826730424612796, 44.47769996764224 ], [ 8.826723258700476, 44.47786947723454 ], [ 8.826679896676513, 44.47803308016044 ], [ 8.82666857252933, 44.478247956932826 ], [ 8.826653783563087, 44.47840143016748 ], [ 8.826631612013706, 44.47867003645023 ], [ 8.826606112055172, 44.478831145685724 ], [ 8.826566501401864, 44.478959013603884 ], [ 8.826460734920284, 44.47904932987101 ], [ 8.826188769403856, 44.479212675047215 ], [ 8.825913228541827, 44.47939383942305 ], [ 8.825776934233843, 44.47960087323984 ], [ 8.825694601448244, 44.47984418000753 ], [ 8.825693824430576, 44.48010516641205 ], [ 8.82570739771537, 44.48036104317802 ], [ 8.825613816103706, 44.48058092573304 ], [ 8.82542608589475, 44.48078842070639 ], [ 8.8260260657554, 44.480563729097724 ], [ 8.827126291640303, 44.48037103184023 ], [ 8.828412296642808, 44.48015807711521 ], [ 8.829040384136531, 44.48029207849058 ], [ 8.830039498988015, 44.48048793732671 ], [ 8.83056735901717, 44.48071378845683 ], [ 8.831095097376561, 44.48093963695883 ], [ 8.831680084258922, 44.481155394369935 ], [ 8.832464312430426, 44.48161694411767 ], [ 8.8330494279552, 44.481791732514345 ], [ 8.833485070569662, 44.48186393970044 ], [ 8.833999200855308, 44.48188521416226 ], [ 8.83451338954423, 44.48188596029884 ], [ 8.835099292157157, 44.48178444727876 ], [ 8.835456494846992, 44.48171339116275 ], [ 8.835942280616376, 44.4816628647321 ], [ 8.83605042053685, 44.481664460433855 ], [ 8.836137279687197, 44.48167646860682 ], [ 8.836159900260808, 44.48195117262923 ], [ 8.836216286335349, 44.48224789157855 ], [ 8.836201177768997, 44.48252416193897 ], [ 8.8361436863258, 44.48266722196901 ], [ 8.83598618236446, 44.48277952931221 ], [ 8.835728773570864, 44.4829122188881 ], [ 8.835227195237913, 44.483521247349195 ], [ 8.834855039161503, 44.483807174853574 ], [ 8.834239710785464, 44.48425641702634 ], [ 8.833924463767993, 44.48460382224012 ], [ 8.833466509333721, 44.48494075554014 ], [ 8.833008433026302, 44.485318558918586 ], [ 8.832579541214413, 44.48547142655208 ], [ 8.832107676142995, 44.48565483848179 ], [ 8.831492741046453, 44.485909698706045 ], [ 8.831091797837374, 44.486267142553025 ], [ 8.83076207387705, 44.486696351737635 ], [ 8.830517751008305, 44.48720752091615 ], [ 8.830302453563336, 44.48759593631165 ], [ 8.830172589471136, 44.48805613953687 ], [ 8.830107775829756, 44.48841849037894 ], [ 8.830098101005396, 44.4884587178921 ], [ 8.830075384585294, 44.48891908026918 ], [ 8.830195213455587, 44.489447894783694 ], [ 8.830266396035512, 44.489534966294876 ], [ 8.83040853223835, 44.489744939431255 ], [ 8.830486632290627, 44.48991898677496 ], [ 8.83052873373554, 44.49019011935891 ], [ 8.830542071653374, 44.49049190831397 ], [ 8.830505509125302, 44.49078345020809 ], [ 8.830447550897505, 44.491080001805734 ], [ 8.830382758757164, 44.49126076902145 ], [ 8.830346565797104, 44.491424383599984 ], [ 8.830296145734822, 44.491593108540144 ], [ 8.830295789649373, 44.491715904266215 ], [ 8.830331108043891, 44.49185405750657 ], [ 8.830394783794716, 44.4920587824826 ], [ 8.83035841238717, 44.492283794898114 ], [ 8.830250706105055, 44.492472870725905 ], [ 8.830028946326264, 44.49261064168944 ], [ 8.83007529532645, 44.49262898491399 ], [ 8.829876905589847, 44.49273131987835 ], [ 8.829715830602195, 44.49280391134132 ], [ 8.829488652865011, 44.4929009811652 ], [ 8.829340230649256, 44.492990515977304 ], [ 8.829120744620326, 44.493123517154636 ], [ 8.828991263625372, 44.49323000483778 ], [ 8.828857270517874, 44.49324492860598 ], [ 8.828791038789438, 44.493270396888455 ], [ 8.828711207629588, 44.49330124633203 ], [ 8.82864039469173, 44.493387835685986 ], [ 8.828526878490944, 44.49345383484009 ], [ 8.82831638678788, 44.49360656377745 ], [ 8.828076597063106, 44.493713514741074 ], [ 8.827923434628788, 44.49383103881958 ], [ 8.82783862286401, 44.49388708757905 ], [ 8.827651343818461, 44.4939722403314 ], [ 8.827578119441426, 44.493994163430976 ], [ 8.827501537454047, 44.494276124971165 ], [ 8.827483307833903, 44.49440141437838 ], [ 8.827450872838227, 44.494524161577985 ], [ 8.827446878355236, 44.494641820222654 ], [ 8.827436009731997, 44.49470203155245 ], [ 8.82739281819217, 44.494804236428614 ], [ 8.827345976175865, 44.49495000860808 ], [ 8.827306507297878, 44.49502665154086 ], [ 8.827281334093342, 44.49507522780142 ], [ 8.82725968030118, 44.49516720216352 ], [ 8.827209318497928, 44.49526948614416 ], [ 8.82717338616808, 44.49534100286492 ], [ 8.827148210047893, 44.49543306189833 ], [ 8.82711202804056, 44.49558902309385 ], [ 8.827083272235399, 44.495658029902216 ], [ 8.82705804562289, 44.49572452130387 ], [ 8.827036485972457, 44.49578444631664 ], [ 8.827000492427022, 44.49587648892876 ], [ 8.826993058425833, 44.495965964021806 ], [ 8.82698554108303, 44.4960836172843 ], [ 8.826999713613036, 44.496139905319644 ], [ 8.827042085716394, 44.49627293864196 ], [ 8.827098854656652, 44.49642904052494 ], [ 8.827112724972798, 44.49654510568318 ], [ 8.827105041533281, 44.496719025252546 ], [ 8.8271081449261, 44.49690322416517 ], [ 8.827125620748237, 44.4970336089824 ], [ 8.827161017797584, 44.49714367492689 ], [ 8.827239113155057, 44.49727676220447 ], [ 8.827289038444727, 44.49732293127076 ], [ 8.827410063929054, 44.497443299572794 ], [ 8.82755626398537, 44.49751509145177 ], [ 8.8276132075769, 44.49757009356596 ], [ 8.827634369826704, 44.49768779011962 ], [ 8.827641298400895, 44.49776963464868 ], [ 8.827597969121511, 44.49791793289756 ], [ 8.82757275723385, 44.49797929289933 ], [ 8.827525800312564, 44.49816332615027 ], [ 8.82751838194073, 44.498247669756054 ], [ 8.827471650542856, 44.49835509078806 ], [ 8.827457092012855, 44.498472013184404 ], [ 8.827453202916272, 44.49855384137159 ], [ 8.82745651881729, 44.498666379467785 ], [ 8.827541703587457, 44.498827655496214 ], [ 8.827627039743692, 44.49893770662719 ], [ 8.827675118913602, 44.49918418160336 ], [ 8.828197109513237, 44.49948612053003 ], [ 8.828712933833534, 44.49984680692952 ], [ 8.829368573101164, 44.50056962030302 ], [ 8.830342920307826, 44.501140939054864 ], [ 8.830910269209, 44.50160901752114 ], [ 8.831291400074775, 44.501921072526095 ], [ 8.831841557901173, 44.502423330945156 ], [ 8.832329243999615, 44.502560888041515 ], [ 8.832795673472646, 44.502698321910415 ], [ 8.833708424412139, 44.50257046654448 ], [ 8.834652696357171, 44.5025490607319 ], [ 8.835766917164666, 44.50248224821661 ], [ 8.836418763093912, 44.50235399573699 ], [ 8.837077086120908, 44.50215741872537 ], [ 8.837491979638932, 44.5017401071508 ], [ 8.837895816347777, 44.50149760966607 ], [ 8.838203943611674, 44.50133842970501 ], [ 8.838960548886584, 44.50116691830181 ], [ 8.8391163104525, 44.50110952089173 ], [ 8.83942345890001, 44.50093836273512 ], [ 8.83981479462004, 44.50084618500403 ], [ 8.84015435574512, 44.50068884437116 ], [ 8.840595486866352, 44.50055586163378 ], [ 8.840967770666207, 44.50043700552858 ], [ 8.841358827621365, 44.50039910805578 ], [ 8.843178453757899, 44.50060382027114 ], [ 8.843721244267716, 44.49998914345606 ], [ 8.844231810553334, 44.49947317907708 ], [ 8.844681458475137, 44.49911017453536 ], [ 8.84550503022932, 44.49818779995185 ], [ 8.845759102985, 44.497906270424615 ], [ 8.845864802809873, 44.49774742634247 ], [ 8.845819382189225, 44.49775222646978 ], [ 8.845769495916993, 44.49735154124754 ], [ 8.845803969193069, 44.49715731062067 ], [ 8.845839463128634, 44.496909785667675 ], [ 8.845721529800784, 44.49650909852883 ], [ 8.845735759457046, 44.49631204972664 ], [ 8.845786666445346, 44.49613413606205 ], [ 8.845947066262177, 44.49550173619028 ], [ 8.84657751685231, 44.49452471662146 ], [ 8.847966424812132, 44.49376810018305 ], [ 8.84913656989082, 44.49330673520414 ], [ 8.849594947571243, 44.493040230924386 ], [ 8.850256757800581, 44.49274968450474 ], [ 8.850375609812215, 44.49265270159606 ], [ 8.850591110114067, 44.49248481406526 ], [ 8.850775866747108, 44.492239463109605 ], [ 8.851190437667324, 44.491882868557894 ], [ 8.851381023637924, 44.491767072441746 ], [ 8.851576991348491, 44.49155909464678 ], [ 8.851613286878727, 44.49153006321899 ]
					],
				],
			},

			properties: { name: 'Berlin Polygon' },

		}

	],

};

let scene, renderer, camera, controls, tiles, gui, overlay;
const params = {
	mode: 'overlay',
};

init();
render();

function init() {

	renderer = new WebGLRenderer( { antialias: true } );
	renderer.setPixelRatio( window.devicePixelRatio );
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.setClearColor( 0x111111 );
	renderer.setAnimationLoop( render );

	document.body.appendChild( renderer.domElement );

	scene = new Scene();
	camera = new PerspectiveCamera(
		60,
		window.innerWidth / window.innerHeight,
		0.001,
		10000,
	);

	// XYZ base layer
	tiles = new TilesRenderer();
	tiles.registerPlugin( new UpdateOnChangePlugin() );
	tiles.registerPlugin( new TilesFadePlugin() );
	tiles.registerPlugin(
		new XYZTilesPlugin( {
			center: true,
			shape: 'ellipsoid',
			url: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
		} ),
	);

	tiles.setCamera( camera );
	tiles.group.rotation.x = - Math.PI / 2;
	tiles.group.updateMatrixWorld();
	scene.add( tiles.group );

	// ImageOverlayPlugin must use same resolution as tileDimension for best results
	overlay = new GeoJSONOverlay( {
		geojson: geojson, // pass the feature collection directly
		color: '#e91e63',

		// TODO: it is slow as it is heavy, could this be used to reference for optimization?
		// url: "https://raw.githubusercontent.com/openpolis/geojson-italy/refs/heads/master/geojson/limits_IT_municipalities.geojson",
	} );

	tiles.registerPlugin( new ImageOverlayPlugin( {
		overlays: [ overlay ],
		renderer,
	} ) );

	// Controls
	controls = new GlobeControls( scene, camera, renderer.domElement );
	controls.setEllipsoid( tiles.ellipsoid, tiles.group );
	controls.enableDamping = true;

	tiles.ellipsoid
		.getObjectFrame( 44.36 * MathUtils.DEG2RAD, 8.85 * MathUtils.DEG2RAD, 2 * 1e4, 0, 0.5 + - Math.PI / 2, 0, camera.matrixWorld, CAMERA_FRAME );

	camera.matrixWorld
		.premultiply( tiles.group.matrixWorld )
		.decompose( camera.position, camera.quaternion, camera.scale );

	window.addEventListener( 'resize', onWindowResize, false );

	gui = new GUI();
	gui.add( params, 'mode', [ 'overlay', 'mask', 'invertMask' ] ).onChange( updateOverlay );

	updateOverlay();

}

function updateOverlay() {

	overlay.alphaInvert = false;
	overlay.alphaMask = false;
	overlay.fillStyle = 'rgba( 255, 255, 255, 0.5 )';

	if ( params.mode === 'mask' ) {

		overlay.alphaMask = true;
		overlay.fillStyle = 'white';

	} else if ( params.mode === 'invertMask' ) {

		overlay.alphaInvert = true;
		overlay.alphaMask = true;
		overlay.fillStyle = 'white';

	}

	overlay.redraw();

}

function onWindowResize() {

	const aspect = window.innerWidth / window.innerHeight;
	camera.aspect = aspect;
	camera.updateProjectionMatrix();
	renderer.setSize( window.innerWidth, window.innerHeight );

}

function render() {

	if ( controls ) {

		controls.update();
		camera.updateMatrixWorld();

	}

	if ( tiles ) {

		tiles.setCamera( camera );
		tiles.setResolutionFromRenderer( camera, renderer );
		tiles.update();

	}

	renderer.render( scene, camera );

}
